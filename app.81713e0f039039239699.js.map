{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/_packages/@lunit/is-touch-device/index.ts","webpack:///./src/_packages/@lunit/insight-viewer/context/frame.tsx","webpack:///./src/_packages/@lunit/insight-viewer/index.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/ParallelImageLoader.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/types.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/animation/dashStroke.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/ContourDrawer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useImageProgress.tsx","webpack:///./src/_packages/@lunit/insight-viewer/interactions/adjust.ts","webpack:///./src/_packages/@lunit/insight-viewer/interactions/pan.ts","webpack:///./src/_packages/@lunit/insight-viewer/interactions/zoom.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/CornerstoneSingleImage.ts","webpack:///./src/_packages/@lunit/insight-viewer/theme/style.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/interactions/startAdjustInteraction.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/interactions/startPanInteraction.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/interactions/startZoomInteraction.ts","webpack:///./src/_packages/@lunit/insight-viewer/geom/hitTestContours.ts","webpack:///./src/_packages/@lunit/insight-viewer/geom/hitTestCircles.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/wadoImageLoaderXHRLoader.ts","webpack:///./src/_packages/@lunit/insight-viewer/loaders/installWADOImageLoader.ts","webpack:///./src/_packages/@lunit/insight-viewer/loaders/unloadImage.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/InsightViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/ContourViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/ContourHover.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/InsightViewerContainer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/ProgressViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/CircleViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/CircleDrawer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/CircleHover.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/DCMImage.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/ThumbnailImage.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/InsightViewerTestController.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/StrokeText.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/CornerstoneViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/LineDrawer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/LineViewer.tsx","webpack:///./src/_packages/@lunit/insight-viewer/interactions/useViewerInteractions.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useSeriesImagePosition.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useSeriesImageScroll.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useInsightViewerSync.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useViewportMirroring.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useImageLoadedTime.ts","webpack:///./src/_packages/@lunit/insight-viewer/hooks/useImageStore.tsx","webpack:///./src/_packages/@lunit/insight-viewer/image/CornerstoneSeriesImage.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/fetchBuffer.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/fileToBuffer.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/CornerstoneFileSingleImage.ts","webpack:///./src/_packages/@lunit/insight-viewer/image/CornerstoneStaticSeriesImage.ts","webpack:///./src/_packages/@lunit/insight-viewer/theme/withInsightViewerStorybookGlobalStyle.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/HeatmapViewer.tsx","webpack:///./src/_packages/@lunit/insight-draw/measure/radToDirection.ts","webpack:///./src/_packages/@lunit/insight-draw/measure/rad360.ts","webpack:///./src/_packages/@lunit/insight-draw/measure/getAngledTextPosition.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/ArrowedContourViewer.tsx","webpack:///./src/_packages/@lunit/insight-draw/shapes/drawArrow.ts","webpack:///./src/_packages/@lunit/insight-viewer/components/PointPin.tsx","webpack:///./src/_packages/@lunit/insight-viewer/components/PointViewer.tsx","webpack:///./src/_packages/@lunit/opt-components/theme/style.ts","webpack:///./src/_packages/@lunit/opt-components/theme/theme.ts","webpack:///./src/_packages/@lunit/opt-components/theme/withOPTComponentsStorybookGlobalStyle.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Button.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Panel.tsx","webpack:///./src/_packages/@lunit/opt-components/components/PanelDescription.tsx","webpack:///./src/_packages/@lunit/opt-components/components/PanelToolbar.tsx","webpack:///./src/_packages/@lunit/opt-components/components/PanelToolbarBadge.tsx","webpack:///./src/_packages/@lunit/opt-components/components/ButtonLayout.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Slider.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Tooltip.tsx","webpack:///./src/_packages/@lunit/opt-components/components/ScrollContainer.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Switch.tsx","webpack:///./src/_packages/@lunit/opt-components/theme/lighten.ts","webpack:///./src/_packages/@lunit/opt-components/components/DialogPaper.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Dialog.tsx","webpack:///./src/_packages/@lunit/opt-components/components/QuarterView.tsx","webpack:///./src/_packages/@lunit/opt-components/components/SwitchRow.tsx","webpack:///./src/_packages/@lunit/opt-components/components/Snackbar.tsx","webpack:///./src/_packages/@lunit/opt-components/components/VideoBackgroundContainer.tsx","webpack:///./src/handbook-insight-viewer-sample/components/GlobalStyle.tsx","webpack:///./src/handbook-insight-viewer-sample/index.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","isTouchDevice","document","documentElement","navigator","maxTouchPoints","msMaxTouchPoints","error","console","FrameContext","createContext","contentWindow","FrameConsumer","stateRef","Consumer","state","async","delay","ms","Promise","resolve","setTimeout","ParallelImageLoader","constructor","options","loadImage","imageId","this","timeout","race","cornerstone","then","Error","getProgressEventDetail","event","detail","dash","keyframes","dashStroke","css","toLocal","element","polygon","map","x","y","pixelToCanvas","join","ContourDrawerBase","Component","props","super","svg","focused","preventClickEvent","startX","startY","svgRef","deactivateInitialEvents","deactivateMouseDrawEvents","canActivate","getElement","activateInitialEvents","draw","device","addEventListener","onMouseMoveToFindFocus","onMouseDownToStartDraw","onTouchStartToStartDraw","onMouseClickToRemove","removeEventListener","stopPropagation","findFocus","pageX","pageY","contours","cornerstoneRenderData","pageToPixel","hitTestContours","onFocus","onRemove","targetTouches","touchType","deactivateTouchDrawEvents","setState","prevState","preventDefault","stopImmediatePropagation","activateTouchDrawEvents","onTouchMoveToDraw","onTouchEndToEndDraw","onKeyDownToCancelTouchDraw","changedTouches","Math","max","abs","onAdd","toLowerCase","cancelTouchDraw","activateMouseDrawEvents","onMouseMoveToDraw","onMouseUpToEndDraw","onMouseLeaveToCancelDraw","onKeyDownToCancelMouseDraw","cancelMouseDraw","render","ref","role","width","height","className","style","points","animateStroke","data-highlight","componentDidMount","componentDidUpdate","prevProps","componentWillUnmount","defaultProps","styled","useImageProgress","image","progress","setProgress","useState","useEffect","subscription","subscribe","nextProgress","unsubscribe","adjust","getCurrentViewport","updateViewport","getContentWindow","startAdjustInteraction","onMove","voi","onEnd","pan","startPanInteraction","translation","zoom","getMinScale","getMaxScale","startZoomInteraction","getMinMaxScale","onZoom","patch","defaultLoader","CornerstoneSingleImage","_imageSubject","_progressSubject","_cancel","_loader","_destoyed","destroy","unload","events","onProgress","forEach","cancel","eventDetail","next","min","loaded","total","loader","wadoImageLoaderXHRLoader","warn","BehaviorSubject","asObservable","blockStyle","globalStyle","startPageX","startPageY","startWindowCenter","startWindowWidth","startTrigger","mouseStart","touchStart","stopTrigger","touchMove","touchEnd","viewport","windowCenter","windowWidth","dx","dy","button","mouseMove","mouseEnd","startTranslationX","startTranslationY","scale","wheel","minScale","maxScale","currentViewport","delta","deltaY","nextScale","top","left","getBoundingClientRect","distanceX","scrollX","distanceY","scrollY","startPagePoints","startPixelDistance","startViewportPoint","startViewportScale","pinchStart","a","b","sqrt","pow","pinchMove","pinchEnd","pagePoints","pixelDistance","nextViewportScale","timer","elapsed","easeQuadInOut","stop","cursor","find","contour","pointInPolygon","hitTestCircles","cx","cy","x1","y1","x2","y2","r1","getCancel","url","headers","params","cornerstoneWADOImageLoader","external","xhr","XMLHttpRequest","reject","open","responseType","keys","setRequestHeader","deferred","abort","onreadystatechange","readyState","status","response","onloadstart","eventData","triggerEvent","onloadend","onprogress","lengthComputable","percentComplete","round","send","installed","installWADOImageLoader","dicomParser","unloadImage","id","test","wadouri","dataSetCacheManager","Array","isArray","InsightViewer","currentImage","teardownPanInteraction","teardownAdjustInteraction","teardownZoomInteraction","imageSubscription","needImageInitialize","elementRef","initImage","disable","enable","renderer","defaultViewport","getDefaultViewport","defaultViewportTransforms","transform","hflip","flip","invert","displayImage","setImage","setViewport","subscribeImage","voiLUT","undefined","onImageRenderered","canvasContext","enabledElement","renderTimeInMs","updateCornerstoneRenderData","updateCurrentViewport","getDefaultViewportForImage","getViewportTransformParams","setCornerstoneImage","update","EVENTS","IMAGE_RENDERED","resetTime","resize","getViewport","ContourViewerBase","createRef","focusedContour","labelCenter","polylabel","dataAttrs","border","data-border","data-id","data-focused","fontSize","label","ContourHoverBase","hover","div","inProgress","unsetProgress","CircleViewerBase","CircleDrawerBase","p1","p2","CircleHoverBase","LineViewerBase","useViewerInteractions","interactions","useMemo","interactionName","ImageStoreContext","createGlobalStyle","canvas","radToDirection","rad","deg","atan2","PI","dominantBaselineMap","east","south","west","north","textAnchorMap","ArrowedContourViewerBase","arrowPolygon","start","end","lineWidth","arrowWidth","arrowDepth","angle","arrowEnd","cos","sin","drawArrow","arrowStart","floor","baseFontSize","labelPosition","direction","textAnchor","dominantBaseline","getAngledTextPosition","data-polygon","onEnter","onLeave","gProps","onClick","useCallback","nativeEvent","onMouseEnter","onMouseLeave","createMuiTheme","palette","type","typography","fontFamily","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","overrides","MuiTooltip","tooltip","backgroundColor","checkIcon","buttonClasses","ButtonBase","icon","check","selected","onChange","hideCheck","disabled","muiButtonProps","click","aria-selected","attrs","layout","panelClasses","Arrow","panelStyle","panelIconHoverStyle","Panel","expanded","title","children","expand","content","iconElement","getIcon","aria-expanded","aria-disabled","sessionId","defaultExpanded","setExpanded","sessionValue","localStorage","getItem","updateExpanded","nextExpanded","setItem","h3","span","verticalLayout","gap","horizontalLayout","valueLabelDisplay","Tooltip","arrow","popper","classes","useTooltipStyle","arrowRef","setArrowRef","React","PopperProps","popperOptions","modifiers","enabled","Boolean","makeStyles","position","borderRadius","color","margin","display","borderStyle","marginTop","borderWidth","borderColor","bottom","marginBottom","marginLeft","right","marginRight","blinkAnimation","ErrorIcon","lighten","Paper","soloEnabled","soloContainerStyle","gridContainerStyle","verticalContainerStyle","IconButton","SnackbarContent","enter","source","divProps","autoPlay","loop","muted","GlobalStyle","componentsGlobalStyle","insightViewerGlobalStyle","App","Date","now","querySelector"],"mappings":"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","file":"app.81713e0f039039239699.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([187,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export function isTouchDevice(): boolean {\n  try {\n    return 'ontouchstart' in document.documentElement || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\n  } catch (error) {\n    console.error(error);\n    return false;\n  }\n}\n","import React, { Context, createContext, ReactNode, useContext } from 'react';\n\nexport interface FrameProviderProps {\n  children: ReactNode;\n  frame?: HTMLIFrameElement;\n  contentWindow?: Window;\n}\n\nexport interface FrameState {\n  frame?: HTMLIFrameElement;\n  contentWindow: Window;\n}\n\nconst FrameContext: Context<FrameState> = createContext<FrameState>({\n  contentWindow: window,\n});\n\n/**\n * `<iframe>` + `React.createPortal()` 이라는 매우 특수한 상황을 위한 기능.\n * 사용할 일은 거의 없다.\n */\nexport function FrameProvider({ children, contentWindow = window }: FrameProviderProps) {\n  return (\n    <FrameContext.Provider\n      value={{\n        contentWindow,\n      }}\n    >\n      {children}\n    </FrameContext.Provider>\n  );\n}\n\nexport function useFrame(): FrameState {\n  return useContext(FrameContext);\n}\n\nexport function FrameConsumer({ stateRef }: { stateRef: (state: FrameState) => void }) {\n  return <FrameContext.Consumer>{state => void stateRef(state)}</FrameContext.Consumer>;\n}\n\n//export const InsightViewerConsumer: Consumer<InsightViewerState> = InsightViewerContext.Consumer;\n","/// <reference types=\"@lunit/cornerstone-declarations\"/>\n\nexport * from './types';\n\nexport * from './loaders/installWADOImageLoader';\nexport * from './loaders/installWebImageLoader';\nexport * from './loaders/unloadImage';\n\nexport * from './components/InsightViewer';\nexport * from './components/ContourViewer';\nexport * from './components/ContourDrawer';\nexport * from './components/ContourHover';\nexport * from './components/ArrowedContourViewer';\nexport * from './components/HeatmapViewer';\nexport * from './components/InsightViewerContainer';\nexport * from './components/ProgressViewer';\nexport * from './components/PointViewer';\nexport * from './components/CircleViewer';\nexport * from './components/CircleDrawer';\nexport * from './components/CircleHover';\nexport * from './components/DCMImage';\nexport * from './components/ThumbnailImage';\nexport * from './components/InsightViewerTestController';\nexport * from './components/StrokeText';\nexport * from './components/CornerstoneViewer';\nexport * from './components/LineDrawer';\nexport * from './components/LineViewer';\n\nexport * from './interactions/adjust';\nexport * from './interactions/pan';\nexport * from './interactions/zoom';\nexport * from './interactions/useViewerInteractions';\n\nexport * from './hooks/useSeriesImagePosition';\nexport * from './hooks/useSeriesImageScroll';\nexport * from './hooks/useImageProgress';\nexport * from './hooks/useInsightViewerSync';\nexport * from './hooks/useContour';\nexport * from './hooks/useViewportMirroring';\nexport * from './hooks/useImageLoadedTime';\nexport * from './hooks/useImageStore';\n\nexport * from './image/types';\nexport * from './image/CornerstoneSingleImage';\nexport * from './image/CornerstoneSeriesImage';\nexport * from './image/ParallelImageLoader';\nexport * from './image/QueueImageLoader';\n\nexport * from './image/fetchBuffer';\nexport * from './image/fileToBuffer';\nexport * from './image/CornerstoneFileSingleImage';\nexport * from './image/CornerstoneStaticSeriesImage';\nexport * from './image/mapNpyBufferToImages';\n\nexport * from './behaviors/updateViewport';\n\nexport * from './theme/style';\nexport * from './theme/withInsightViewerStorybookGlobalStyle';\n\nexport * from './context/frame';\n","import { ImageLoader, LoadImageParams } from './types';\n\nasync function delay(ms: number) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms);\n  });\n}\n\ninterface Options {\n  timeout?: number;\n}\n\nexport class ParallelImageLoader implements ImageLoader {\n  constructor(private readonly options: Options = {}) {}\n\n  loadImage = ({ imageId, options }: LoadImageParams): Promise<cornerstone.Image> => {\n    return typeof this.options.timeout === 'number'\n      ? Promise.race([\n          cornerstone.loadImage(imageId, options),\n          delay(this.options.timeout).then(() => {\n            throw new Error('TIMEOUT');\n          }),\n        ])\n      : cornerstone.loadImage(imageId, options);\n  };\n}\n","import { Observable } from 'rxjs';\n\nexport interface CornerstoneImage {\n  /** cornerstoneImage.image.subscribe() 로 cornerstone.Image를 받을 수 있다 */\n  readonly image: Observable<cornerstone.Image | null>;\n  /** cornerstoneImage.progress.subscribe() 로 로딩 상태를 0 ~ 1의 값으로 얻을 수 있다 */\n  readonly progress: Observable<number>;\n  /** cornerstoneImage.destroy() 로 현재 Image를 Cache에서 삭제한다 */\n  destroy: () => void;\n}\n\nexport interface CornerstoneSequenceImage extends CornerstoneImage {\n  /** 총 이미지 갯수 */\n  length: () => number;\n  /** 현재 보여주고 있는 Image의 index number */\n  getIndex: () => number;\n  /** cornerstoneImage.index.subscribe() 로 현재 보여주고 있는 Image의 index number를 받을 수 있다 */\n  readonly index: Observable<number>;\n  /** 다음 Image 보기 */\n  next: (delta?: number) => void;\n  /** 이전 Image 보기 */\n  prev: (delta?: number) => void;\n  /** 특정 index number의 Image 보기 */\n  goto: (index: number) => void;\n}\n\n/** @deprecated use CornerstoneSequenceImage */\nexport interface CornerstoneBulkImage extends CornerstoneSequenceImage {}\n\nexport interface ProgressEventDetail {\n  url: string;\n  imageId: string;\n  loaded: number;\n  total: number;\n  percentComplete: number; // 0 ~ 100\n}\n\nexport function getProgressEventDetail(event: Event): ProgressEventDetail | undefined {\n  const detail: object | undefined = event['detail'];\n\n  if (\n    detail &&\n    typeof detail['url'] === 'string' &&\n    typeof detail['imageId'] === 'string' &&\n    typeof detail['loaded'] === 'number' &&\n    typeof detail['total'] === 'number' &&\n    typeof detail['percentComplete'] === 'number'\n  ) {\n    return detail as ProgressEventDetail;\n  }\n\n  return undefined;\n}\n\nexport interface LoadImageParams {\n  imageId: string;\n  options?: object;\n}\n\nexport interface ImageLoader {\n  loadImage: (params: LoadImageParams) => Promise<cornerstone.Image>;\n}\n\nexport interface NpyImageInfo {\n  id: string;\n  windowCenter: number;\n  windowWidth: number;\n  sliceSpacing: number;\n  rowPixelSpacing: number;\n  columnPixelSpacing: number;\n  slope?: number;\n  intercept?: number;\n  minPixelValue?: number;\n  maxPixelValue?: number;\n}\n","import { css, keyframes } from 'styled-components';\n\nconst dash = keyframes`\n  to {\n    stroke-dashoffset: 0;\n  }\n`;\n\nexport const dashStroke = css`\n  stroke-dasharray: 10, 10;\n  stroke-dashoffset: 1000;\n  animation: ${dash} 10s linear infinite;\n`;\n","import { isTouchDevice } from '@lunit/is-touch-device';\nimport React, { Component, CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { FrameConsumer } from '../context/frame';\nimport { hitTestContours } from '../geom/hitTestContours';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\nimport { dashStroke } from './animation/dashStroke';\n\nexport interface ContourDrawerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /**\n   * 그리기 기능 활성화 여부\n   *\n   * HTMLElement로 입력할 경우 MouseEvent를 해당 HTMLElement를 사용해서 처리한다\n   */\n  draw: boolean | HTMLElement | null;\n\n  /**\n   * 특정 Contour에 Mouse Over 되었을 때\n   * focusedContour를 결정하는데 필요하다\n   */\n  onFocus: (contour: T | null) => void;\n\n  /** 그리기가 완료되어 새로운 Contour가 발생했을 때 */\n  onAdd: (polygon: Point[], event: MouseEvent | TouchEvent) => void;\n\n  /** 특정 Contour를 Click 해서 지울때 필요하다 */\n  onRemove: (contour: T) => void;\n\n  className?: string;\n  style?: CSSProperties;\n\n  /** 그리는 과정에서 Line에 표현되는 Animation을 비활성 시킬 수 있다 */\n  animateStroke?: boolean;\n\n  /**\n   * 접근 Device 설정\n   */\n  device?: 'all' | 'mouse-only' | 'touch-only' | 'stylus-only' | 'mouse-and-stylus';\n}\n\ninterface ContourDrawerState {\n  polygon: Point[];\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): string {\n  return polygon\n    .map(([x, y]) => {\n      const p = cornerstone.pixelToCanvas(element, { x, y });\n      return p.x + ',' + p.y;\n    })\n    .join(' ');\n}\n\nexport class ContourDrawerBase<T extends Contour> extends Component<ContourDrawerProps<T>, ContourDrawerState> {\n  static defaultProps: Partial<ContourDrawerProps<Contour>> = {\n    device: 'all',\n  };\n\n  private svg: SVGSVGElement | null = null;\n  private element: HTMLElement | null = null;\n  private focused: T | null = null;\n  private preventClickEvent: boolean = false;\n  private startX: number = 0;\n  private startY: number = 0;\n\n  private contentWindow: Window = window;\n\n  constructor(props: ContourDrawerProps<T>) {\n    super(props);\n\n    this.state = {\n      polygon: [],\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <svg\n          ref={this.svgRef}\n          role=\"figure\"\n          width={this.props.width}\n          height={this.props.height}\n          className={this.props.className}\n          style={this.props.style}\n        >\n          {this.props.cornerstoneRenderData && this.state.polygon && this.state.polygon.length > 0 && (\n            <>\n              <polyline points={toLocal(this.props.cornerstoneRenderData.element, this.state.polygon)} />\n              {this.props.animateStroke !== false && (\n                <polyline\n                  points={toLocal(this.props.cornerstoneRenderData.element, this.state.polygon)}\n                  data-highlight=\"highlight\"\n                />\n              )}\n            </>\n          )}\n        </svg>\n      </>\n    );\n  }\n\n  svgRef = (svg: SVGSVGElement) => {\n    if (svg && this.svg && this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n\n      if (this.canActivate(this.props)) {\n        this.svg = svg;\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n\n    this.svg = svg;\n  };\n\n  componentDidMount() {\n    if (!this.svg) throw new Error('<svg> is not initialized');\n\n    if (this.canActivate(this.props)) {\n      this.element = this.getElement(this.props);\n      this.activateInitialEvents();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<ContourDrawerProps<T>>) {\n    if (prevProps.draw !== this.props.draw) {\n      if (this.element) {\n        this.deactivateInitialEvents();\n        this.deactivateMouseDrawEvents();\n      }\n\n      if (this.canActivate(this.props)) {\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n    }\n  }\n\n  getElement = ({ draw }: Readonly<ContourDrawerProps<T>>): HTMLElement => {\n    //@ts-ignore\n    return draw instanceof this.contentWindow['HTMLElement'] ? (draw as HTMLElement) : (this.svg as HTMLElement);\n  };\n\n  canActivate = ({ draw }: Readonly<ContourDrawerProps<T>>) => {\n    return draw instanceof this.contentWindow['HTMLElement'] || draw === true;\n  };\n\n  // ---------------------------------------------\n  // initial events\n  // ---------------------------------------------\n  activateInitialEvents = () => {\n    if (!this.element) return;\n    if (this.props.device !== 'touch-only' && this.props.device !== 'stylus-only') {\n      this.element.addEventListener('mousemove', this.onMouseMoveToFindFocus);\n      this.element.addEventListener('mousedown', this.onMouseDownToStartDraw);\n    }\n    if (isTouchDevice() && this.props.device !== 'mouse-only') {\n      this.element.addEventListener('touchstart', this.onTouchStartToStartDraw);\n    }\n    this.element.addEventListener('click', this.onMouseClickToRemove);\n  };\n\n  deactivateInitialEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToFindFocus);\n    this.element.removeEventListener('mousedown', this.onMouseDownToStartDraw);\n    this.element.removeEventListener('touchstart', this.onTouchStartToStartDraw);\n    this.element.removeEventListener('click', this.onMouseClickToRemove);\n  };\n\n  onMouseMoveToFindFocus = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    this.findFocus(event.pageX, event.pageY);\n  };\n\n  findFocus = (pageX: number, pageY: number) => {\n    if (!this.props.contours || this.props.contours.length === 0 || !this.props.cornerstoneRenderData) return;\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, pageX, pageY);\n\n    this.focused = hitTestContours<T>(this.props.contours, [x, y]);\n\n    this.props.onFocus(this.focused);\n  };\n\n  onMouseClickToRemove = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    if (!this.focused || this.preventClickEvent) return;\n\n    this.props.onRemove(this.focused);\n  };\n\n  // ---------------------------------------------\n  // touch draw events\n  // ---------------------------------------------\n  onTouchStartToStartDraw = (event: TouchEvent) => {\n    if (\n      (this.props.device === 'stylus-only' || this.props.device === 'mouse-and-stylus') &&\n      event.targetTouches[0].touchType !== 'stylus'\n    ) {\n      return;\n    } else if (event.targetTouches.length > 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        polygon: [],\n      }));\n      return;\n    } else if (event.targetTouches.length !== 1) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.targetTouches[0].pageX;\n    this.startY = event.targetTouches[0].pageY;\n\n    this.deactivateInitialEvents();\n    this.activateTouchDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [[x, y]],\n    }));\n  };\n\n  activateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.addEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.addEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  deactivateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.removeEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.removeEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  onTouchMoveToDraw = (event: TouchEvent) => {\n    if (event.targetTouches.length !== 1 || event.changedTouches.length !== 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        polygon: [],\n      }));\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(\n        Math.abs(event.targetTouches[0].pageX - this.startX),\n        Math.abs(event.targetTouches[0].pageY - this.startY),\n      ) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [...prevState.polygon, [x, y]],\n    }));\n  };\n\n  onTouchEndToEndDraw = (event: TouchEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    this.props.onAdd(this.state.polygon, event);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  onKeyDownToCancelTouchDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelTouchDraw();\n    }\n  };\n\n  cancelTouchDraw = () => {\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  // ---------------------------------------------\n  // mouse draw events\n  // ---------------------------------------------\n  onMouseDownToStartDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.pageX;\n    this.startY = event.pageY;\n\n    this.deactivateInitialEvents();\n    this.activateMouseDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [[x, y]],\n    }));\n  };\n\n  activateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.addEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.addEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  deactivateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.removeEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.removeEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  onMouseMoveToDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(Math.abs(event.pageX - this.startX), Math.abs(event.pageY - this.startY)) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [...prevState.polygon, [x, y]],\n    }));\n  };\n\n  onMouseUpToEndDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    this.props.onAdd(this.state.polygon, event);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  onMouseLeaveToCancelDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.cancelMouseDraw();\n  };\n\n  onKeyDownToCancelMouseDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelMouseDraw();\n    }\n  };\n\n  cancelMouseDraw = () => {\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const ContourDrawer: new <T extends Contour>() => ContourDrawerBase<T> = styled(ContourDrawerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  --color: rgb(255, 224, 0);\n  --stroke-width: 4px;\n  --fill-color: rgba(255, 224, 0, 0.2);\n\n  > polyline:first-child {\n    stroke: var(--contour-drawer-color, var(--color));\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: var(--contour-drawer-fill-color, var(--fill-color));\n  }\n\n  > polyline[data-highlight] {\n    stroke: #ffffff;\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: transparent;\n    ${dashStroke}\n  }\n` as any;\n\n/**\n * @deprecated use ContourDrawer instead\n */\nexport const UserContourDrawer = ContourDrawer;\n","import { useEffect, useState } from 'react';\nimport { CornerstoneImage } from '../image/types';\n\n/**\n * CornerstoneImage의 Loading 상태를 확인하기 위해 사용한다.\n *\n * @return `number`는 loading이 진행중이고, `null`은 loading이 진행중이 아니다. `null`이 오는 경우 Progress UI를 감추면 된다.\n */\nexport function useImageProgress(image: CornerstoneImage | null | undefined): number | null {\n  const [progress, setProgress] = useState<number | null>(null);\n\n  useEffect(() => {\n    if (image) {\n      const subscription = image.progress.subscribe(nextProgress => {\n        setProgress(nextProgress < 1 ? nextProgress : null);\n      });\n\n      return () => {\n        subscription.unsubscribe();\n      };\n    } else {\n      setProgress(null);\n    }\n  }, [image]);\n\n  return progress;\n}\n","import { CornerstoneViewerLike } from '@lunit/insight-viewer';\nimport { startAdjustInteraction } from '../components/interactions/startAdjustInteraction';\n\nexport const adjust = ({ element }: { element?: HTMLElement | null } = {}) => ({\n  getElement,\n  getCurrentViewport,\n  updateViewport,\n  getContentWindow,\n}: CornerstoneViewerLike) => {\n  if (!element) element = getElement();\n\n  return startAdjustInteraction({\n    element,\n    getCurrentViewport,\n    onMove: (voi: cornerstone.VOI) => updateViewport({ voi }),\n    onEnd: () => {},\n    contentWindow: getContentWindow(),\n  });\n};\n","import { CornerstoneViewerLike } from '@lunit/insight-viewer';\nimport { startPanInteraction } from '../components/interactions/startPanInteraction';\n\nexport const pan = ({ element }: { element?: HTMLElement | null } = {}) => ({\n  getElement,\n  getCurrentViewport,\n  getContentWindow,\n  updateViewport,\n}: CornerstoneViewerLike) => {\n  if (!element) element = getElement();\n\n  return startPanInteraction({\n    element,\n    getCurrentViewport,\n    onMove: (translation: cornerstone.Vec2) => updateViewport({ translation }),\n    onEnd: () => {},\n    contentWindow: getContentWindow(),\n  });\n};\n","import { CornerstoneViewerLike } from '@lunit/insight-viewer';\nimport { startZoomInteraction } from '../components/interactions/startZoomInteraction';\n\nexport const zoom = ({ element }: { element?: HTMLElement | null } = {}) => ({\n  getElement,\n  updateViewport,\n  getCurrentViewport,\n  getContentWindow,\n  getMinScale,\n  getMaxScale,\n}: CornerstoneViewerLike) => {\n  if (!element) element = getElement();\n\n  return startZoomInteraction({\n    element,\n    getMinMaxScale: () => [getMinScale(), getMaxScale()],\n    getCurrentViewport,\n    onZoom: (patch) => updateViewport(patch),\n    contentWindow: getContentWindow(),\n  });\n};\n","import { BehaviorSubject, Observable } from 'rxjs';\nimport { ParallelImageLoader } from './ParallelImageLoader';\nimport { CornerstoneImage, getProgressEventDetail, ImageLoader, ProgressEventDetail } from './types';\nimport { wadoImageLoaderXHRLoader } from './wadoImageLoaderXHRLoader';\n\ninterface Options {\n  timeout?: number;\n  unload?: (imageId: string) => void;\n  cancelTokenName?: string;\n  loader?: ImageLoader;\n}\n\nconst defaultLoader: ImageLoader = new ParallelImageLoader();\n\nexport class CornerstoneSingleImage implements CornerstoneImage {\n  private readonly _imageSubject: BehaviorSubject<cornerstone.Image | null>;\n  private readonly _progressSubject: BehaviorSubject<number>;\n  private readonly _cancel: (() => void)[] = [];\n  private readonly _loader: ImageLoader;\n  private _destoyed: boolean = false;\n\n  constructor(private readonly imageId: string, private readonly options: Options = {}) {\n    this._imageSubject = new BehaviorSubject<cornerstone.Image | null>(null);\n    this._progressSubject = new BehaviorSubject(0);\n    this._loader = options.loader || defaultLoader;\n\n    cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onProgress);\n    this.loadImage(imageId);\n  }\n\n  get image(): Observable<cornerstone.Image | null> {\n    return this._imageSubject.asObservable();\n  }\n\n  get progress(): Observable<number> {\n    return this._progressSubject.asObservable();\n  }\n\n  destroy = () => {\n    if (this.options && typeof this.options.unload === 'function') {\n      this.options.unload(this.imageId);\n    }\n\n    cornerstone.events.removeEventListener('cornerstoneimageloadprogress', this.onProgress);\n\n    this._cancel.forEach(cancel => cancel());\n\n    this._destoyed = true;\n  };\n\n  private onProgress = (event: Event) => {\n    const eventDetail: ProgressEventDetail | undefined = getProgressEventDetail(event);\n\n    if (eventDetail && eventDetail.imageId === this.imageId) {\n      this._progressSubject.next(Math.min(eventDetail.loaded / eventDetail.total, 0.99));\n    }\n  };\n\n  private loadImage = async (imageId: string) => {\n    try {\n      const image = await this._loader.loadImage({\n        imageId,\n        options: { loader: wadoImageLoaderXHRLoader(cancel => this._cancel.push(cancel)) },\n      });\n\n      cornerstone.events.removeEventListener('cornerstoneimageloadprogress', this.onProgress);\n\n      if (!this._destoyed) {\n        this._imageSubject.next(image);\n        this._progressSubject.next(1);\n      }\n    } catch (error) {\n      if (!this._destoyed) {\n        console.warn(`It will retry loadImage(${imageId}):`, error);\n        this.loadImage(imageId);\n      }\n    }\n  };\n}\n","import { ColorProperty } from 'csstype';\nimport { css } from 'styled-components';\n\nexport interface InsightViewerCSSProperties {\n  '--contour-viewer-color'?: ColorProperty;\n  '--contour-viewer-focused-color'?: ColorProperty;\n  '--contour-viewer-stroke-width'?: ColorProperty;\n  '--contour-viewer-focused-stroke-width'?: ColorProperty;\n  '--contour-viewer-fill-color'?: ColorProperty;\n  '--contour-viewer-focused-fill-color'?: ColorProperty;\n\n  '--contour-drawer-color'?: ColorProperty;\n  '--contour-drawer-stroke-width'?: ColorProperty;\n  '--contour-drawer-fill-color'?: ColorProperty;\n\n  '--pin-color'?: ColorProperty;\n  '--pin-focused-color'?: ColorProperty;\n}\n\nexport const blockStyle = css`\n  --contour-viewer-color: #ffffff;\n  --contour-viewer-focused-color: rgb(255, 194, 17);\n  --contour-viewer-stroke-width: 3px;\n  --contour-viewer-focused-stroke-width: 6px;\n  --contour-viewer-fill-color: rgba(0, 0, 0, 0.2);\n  --contour-viewer-focused-fill-color: rgba(0, 0, 0, 0.4);\n\n  --contour-drawer-color: rgb(255, 224, 0);\n  --contour-drawer-stroke-width: 4px;\n  --contour-drawer-fill-color: rgba(255, 224, 0, 0.2);\n\n  --pin-color: #ffffff;\n  --pin-focused-color: rgb(255, 194, 17);\n`;\n\nexport const globalStyle = css`\n  :root {\n    ${blockStyle};\n  }\n`;\n","import { isTouchDevice } from '@lunit/is-touch-device';\n\ninterface AdjustInteractionParams {\n  element: HTMLElement;\n  getCurrentViewport: () => cornerstone.Viewport | null;\n  onMove: (voi: cornerstone.VOI) => void;\n  onEnd: () => void;\n  contentWindow: Window;\n}\n\nexport function startAdjustInteraction({\n  element,\n  getCurrentViewport,\n  onMove,\n  onEnd,\n  contentWindow,\n}: AdjustInteractionParams): () => void {\n  let startPageX: number;\n  let startPageY: number;\n  let startWindowCenter: number;\n  let startWindowWidth: number;\n\n  function startTrigger() {\n    element.addEventListener('mousedown', mouseStart);\n    if (isTouchDevice()) {\n      element.addEventListener('touchstart', touchStart);\n    }\n  }\n\n  function stopTrigger() {\n    element.removeEventListener('mousedown', mouseStart);\n    element.removeEventListener('touchstart', touchStart);\n  }\n\n  // ---------------------------------------------\n  // touch handler\n  // ---------------------------------------------\n  function touchStart(event: TouchEvent) {\n    if (event.targetTouches.length > 1) {\n      contentWindow.removeEventListener('touchmove', touchMove);\n      contentWindow.removeEventListener('touchend', touchEnd);\n      contentWindow.removeEventListener('touchcancel', touchEnd);\n\n      startTrigger();\n\n      return;\n    }\n\n    if (event.targetTouches.length !== 1) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    stopTrigger();\n\n    startPageX = event.targetTouches[0].pageX;\n    startPageY = event.targetTouches[0].pageY;\n    startWindowCenter = viewport.voi.windowCenter;\n    startWindowWidth = viewport.voi.windowWidth;\n\n    contentWindow.addEventListener('touchmove', touchMove);\n    contentWindow.addEventListener('touchend', touchEnd);\n    contentWindow.addEventListener('touchcancel', touchEnd);\n  }\n\n  function touchMove(event: TouchEvent) {\n    if (event.targetTouches.length !== 1 || event.changedTouches.length !== 1) {\n      contentWindow.removeEventListener('touchmove', touchMove);\n      contentWindow.removeEventListener('touchend', touchEnd);\n      contentWindow.removeEventListener('touchcancel', touchEnd);\n\n      startTrigger();\n\n      return;\n    }\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    const dx: number = event.targetTouches[0].pageX - startPageX;\n    const dy: number = event.targetTouches[0].pageY - startPageY;\n\n    onMove({\n      windowWidth: Math.max(startWindowWidth + dx, 1),\n      windowCenter: Math.max(startWindowCenter + dy, 1),\n    });\n  }\n\n  function touchEnd(event: TouchEvent) {\n    contentWindow.removeEventListener('touchmove', touchMove);\n    contentWindow.removeEventListener('touchend', touchEnd);\n    contentWindow.removeEventListener('touchcancel', touchEnd);\n\n    startTrigger();\n\n    onEnd();\n  }\n\n  // ---------------------------------------------\n  // mouse handler\n  // ---------------------------------------------\n  function mouseStart(event: MouseEvent) {\n    if (event.button !== 0) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    stopTrigger();\n\n    startPageX = event.pageX;\n    startPageY = event.pageY;\n    startWindowCenter = viewport.voi.windowCenter;\n    startWindowWidth = viewport.voi.windowWidth;\n\n    contentWindow.addEventListener('mousemove', mouseMove);\n    contentWindow.addEventListener('mouseup', mouseEnd);\n    element.addEventListener('mouseleave', mouseEnd);\n  }\n\n  function mouseMove(event: MouseEvent) {\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const dx: number = event.pageX - startPageX;\n    const dy: number = event.pageY - startPageY;\n\n    onMove({\n      windowWidth: Math.max(startWindowWidth + dx, 1),\n      windowCenter: Math.max(startWindowCenter + dy, 1),\n    });\n  }\n\n  function mouseEnd(event: MouseEvent) {\n    if (event.button !== 0) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    contentWindow.removeEventListener('mousemove', mouseMove);\n    contentWindow.removeEventListener('mouseup', mouseEnd);\n    element.removeEventListener('mouseleave', mouseEnd);\n\n    startTrigger();\n\n    onEnd();\n  }\n\n  // ---------------------------------------------\n  // start\n  // ---------------------------------------------\n  startTrigger();\n\n  // ---------------------------------------------\n  // end\n  // ---------------------------------------------\n  return () => {\n    element.removeEventListener('mousedown', mouseStart);\n    element.removeEventListener('touchstart', touchStart);\n\n    contentWindow.removeEventListener('mousemove', mouseMove);\n    contentWindow.removeEventListener('mouseup', mouseEnd);\n    element.removeEventListener('mouseleave', mouseEnd);\n\n    contentWindow.removeEventListener('touchmove', touchMove);\n    contentWindow.removeEventListener('touchend', touchEnd);\n    contentWindow.removeEventListener('touchcancel', touchEnd);\n  };\n}\n","import { isTouchDevice } from '@lunit/is-touch-device';\n\ninterface PanInteractionParams {\n  element: HTMLElement;\n  getCurrentViewport: () => cornerstone.Viewport | null;\n  onMove: (translation: cornerstone.Vec2) => void;\n  onEnd: () => void;\n  contentWindow: Window;\n}\n\nexport function startPanInteraction({\n  element,\n  getCurrentViewport,\n  onMove,\n  onEnd,\n  contentWindow,\n}: PanInteractionParams): () => void {\n  let startPageX: number;\n  let startPageY: number;\n  let startTranslationX: number;\n  let startTranslationY: number;\n\n  function startTrigger() {\n    element.addEventListener('mousedown', mouseStart);\n    if (isTouchDevice()) {\n      element.addEventListener('touchstart', touchStart);\n    }\n  }\n\n  function stopTrigger() {\n    element.removeEventListener('mousedown', mouseStart);\n    element.removeEventListener('touchstart', touchStart);\n  }\n\n  // ---------------------------------------------\n  // touch handler\n  // ---------------------------------------------\n  function touchStart(event: TouchEvent) {\n    if (event.targetTouches.length > 1) {\n      contentWindow.removeEventListener('touchmove', touchMove);\n      contentWindow.removeEventListener('touchend', touchEnd);\n      contentWindow.removeEventListener('touchcancel', touchEnd);\n\n      startTrigger();\n\n      return;\n    }\n\n    if (event.targetTouches.length !== 1) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    stopTrigger();\n\n    startPageX = event.targetTouches[0].pageX;\n    startPageY = event.targetTouches[0].pageY;\n    startTranslationX = viewport.translation.x;\n    startTranslationY = viewport.translation.y;\n\n    contentWindow.addEventListener('touchmove', touchMove);\n    contentWindow.addEventListener('touchend', touchEnd);\n    contentWindow.addEventListener('touchcancel', touchEnd);\n  }\n\n  function touchMove(event: TouchEvent) {\n    if (event.targetTouches.length !== 1 || event.changedTouches.length !== 1) {\n      contentWindow.removeEventListener('touchmove', touchMove);\n      contentWindow.removeEventListener('touchend', touchEnd);\n      contentWindow.removeEventListener('touchcancel', touchEnd);\n\n      startTrigger();\n\n      return;\n    }\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    const dx: number = (event.targetTouches[0].pageX - startPageX) / viewport.scale;\n    const dy: number = (event.targetTouches[0].pageY - startPageY) / viewport.scale;\n\n    onMove({\n      x: startTranslationX + dx,\n      y: startTranslationY + dy,\n    });\n  }\n\n  function touchEnd(event: TouchEvent) {\n    contentWindow.removeEventListener('touchmove', touchMove);\n    contentWindow.removeEventListener('touchend', touchEnd);\n    contentWindow.removeEventListener('touchcancel', touchEnd);\n\n    startTrigger();\n\n    onEnd();\n  }\n\n  // ---------------------------------------------\n  // mouse handler\n  // ---------------------------------------------\n  function mouseStart(event: MouseEvent) {\n    if (event.button !== 0) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    stopTrigger();\n\n    startPageX = event.pageX;\n    startPageY = event.pageY;\n    startTranslationX = viewport.translation.x;\n    startTranslationY = viewport.translation.y;\n\n    contentWindow.addEventListener('mousemove', mouseMove);\n    contentWindow.addEventListener('mouseup', mouseEnd);\n    element.addEventListener('mouseleave', mouseEnd);\n  }\n\n  function mouseMove(event: MouseEvent) {\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const viewport = getCurrentViewport();\n    if (!viewport) return;\n\n    const dx: number = (event.pageX - startPageX) / viewport.scale;\n    const dy: number = (event.pageY - startPageY) / viewport.scale;\n\n    onMove({\n      x: startTranslationX + dx,\n      y: startTranslationY + dy,\n    });\n  }\n\n  function mouseEnd(event: MouseEvent) {\n    if (event.button !== 0) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    contentWindow.removeEventListener('mousemove', mouseMove);\n    contentWindow.removeEventListener('mouseup', mouseEnd);\n    element.removeEventListener('mouseleave', mouseEnd);\n\n    startTrigger();\n\n    onEnd();\n  }\n\n  // ---------------------------------------------\n  // start\n  // ---------------------------------------------\n  startTrigger();\n\n  // ---------------------------------------------\n  // end\n  // ---------------------------------------------\n  return () => {\n    element.removeEventListener('mousedown', mouseStart);\n    contentWindow.removeEventListener('mousemove', mouseMove);\n    contentWindow.removeEventListener('mouseup', mouseEnd);\n    element.removeEventListener('mouseleave', mouseEnd);\n\n    element.removeEventListener('touchstart', touchStart);\n    contentWindow.removeEventListener('touchmove', touchMove);\n    contentWindow.removeEventListener('touchend', touchEnd);\n    contentWindow.removeEventListener('touchcancel', touchEnd);\n  };\n}\n","import { isTouchDevice } from '@lunit/is-touch-device';\nimport { easeQuadInOut } from 'd3-ease';\nimport { timer } from 'd3-timer';\n\ninterface ZoomInteractionParams {\n  element: HTMLElement;\n  getMinMaxScale: () => [number, number];\n  getCurrentViewport: () => cornerstone.Viewport | null;\n  onZoom: (patch: { translation: cornerstone.Vec2; scale: number }) => void;\n  contentWindow: Window;\n}\n\ntype Point = { x: number; y: number };\n\nexport function startZoomInteraction({\n  element,\n  getMinMaxScale,\n  getCurrentViewport,\n  onZoom,\n  contentWindow,\n}: ZoomInteractionParams): () => void {\n  // ---------------------------------------------\n  // wheel handler\n  // ---------------------------------------------\n  function wheel(event: WheelEvent) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    const [minScale, maxScale] = getMinMaxScale();\n    const currentViewport = getCurrentViewport();\n\n    if (!currentViewport) return;\n\n    // deltaY는 scroll up의 경우 negative 수치로 오고,\n    // scroll down의 경우 positive 수치로 온다\n    // scale의 변환을 정상적인 방향으로 연산하기 위해서는 (scale - delta)로 방향을 전환해줘야 한다\n    const delta: number = event.deltaY > 0 ? 1 : -1;\n\n    const nextScale: number = Math.max(\n      minScale, // 최소 scale 미만으로 떨어지지 않도록 방지\n      Math.min(\n        maxScale, // 최대 scale 이상으로 올라가지 않도록 방지\n        currentViewport.scale - delta * 0.03, // scale을 delta 수치로 보정\n      ),\n    );\n\n    // min, max 등에 의해서 scale 변화가 없다면 viewport 반영을 취소\n    if (currentViewport.scale === nextScale) return;\n\n    // pageX, pageY 는 screen 기준 mouse pointer의 point\n    // bounding rect는 screen 기준 element의 rect\n    const { top, left, width, height } = element.getBoundingClientRect();\n\n    // left + width / 2 는 screen 기준 element의 center\n    // mouse pointer point - window scroll position 으로 scroll 기준 위치를 찾는다\n    // screen 기준 mouse pointer point - element의 center\n    // element center 부터의 mouse 상대 위치의 차를 계산하게 된다\n    // | ------ center ==== mouse - |   = 로 표시된 거리\n    const distanceX: number = event.pageX - contentWindow.scrollX - (left + width / 2);\n    const distanceY: number = event.pageY - contentWindow.scrollY - (top + height / 2);\n\n    // nextScale / currentViewport.scale 으로 scale 변화의 비율을 계산 (확대 시 >1, 축소 시 <1)\n    // 1 - scale 변환 비율로 확대 / 축소 시 size 변화에 따른 위치 변화의 폭을 찾는다\n    // 확대 시 x 위치는 <- 으로 팽창하게 되기 때문에 - 수치가 나오게 되고\n    // 축소 시 x 위치는 -> 으로 수축하게 되기 때문에 + 수치가 나오게 된다\n    // size 변화의 비율 * distanceX 로 이동해야 할 수치를 계산\n    const dx: number = (1 - nextScale / currentViewport.scale) * distanceX;\n    const dy: number = (1 - nextScale / currentViewport.scale) * distanceY;\n\n    onZoom({\n      // dx / nextScale 로 실제적인 이동 수치를 찾고\n      // currentViewport.translation.x + 를 통해서 기존 위치에 이동 수치를 적용한 값을 찾는다\n      translation: {\n        x: currentViewport.translation.x + dx / nextScale,\n        y: currentViewport.translation.y + dy / nextScale,\n      },\n      scale: nextScale,\n    });\n  }\n\n  // ---------------------------------------------\n  // touch handler\n  // ---------------------------------------------\n  let startPagePoints: [Point, Point];\n  let startPixelDistance: number;\n\n  let startViewportPoint: Point;\n  let startViewportScale: number;\n\n  function pinchStart(event: TouchEvent) {\n    if (event.targetTouches.length !== 2) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const currentViewport = getCurrentViewport();\n\n    if (!currentViewport) return;\n\n    // 시작 시점의 viewport를 기록한다\n    startViewportScale = currentViewport.scale;\n    startViewportPoint = currentViewport.translation;\n\n    // p1 과 p2를 기록한다\n    startPagePoints = [\n      { x: event.targetTouches[0].pageX, y: event.targetTouches[0].pageY },\n      { x: event.targetTouches[1].pageX, y: event.targetTouches[1].pageY },\n    ];\n\n    // p1과  p2의 거리를 측정한다\n    const a: number = Math.abs(startPagePoints[0].x - startPagePoints[1].x);\n    const b: number = Math.abs(startPagePoints[0].y - startPagePoints[1].y);\n    startPixelDistance = Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));\n\n    element.removeEventListener('touchstart', pinchStart);\n\n    element.addEventListener('touchmove', pinchMove);\n    element.addEventListener('touchend', pinchEnd);\n    element.addEventListener('touchcancel', pinchEnd);\n  }\n\n  function pinchMove(event: TouchEvent) {\n    if (event.targetTouches.length !== 2 || event.changedTouches.length !== 2) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const pagePoints = [\n      { x: event.changedTouches[0].pageX, y: event.changedTouches[0].pageY },\n      { x: event.changedTouches[1].pageX, y: event.changedTouches[1].pageY },\n    ];\n    const a: number = Math.abs(pagePoints[0].x - pagePoints[1].x);\n    const b: number = Math.abs(pagePoints[0].y - pagePoints[1].y);\n    const pixelDistance: number = Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));\n\n    // 현재 p1, p2의 거리 / 이전 p1, p2의 거리를 구한다 = 확대비\n    // 이전 viewport scale 에 확대비를 곱해서 변동된 viewport scale을 구한다\n    const nextViewportScale: number = startViewportScale * (pixelDistance / startPixelDistance);\n\n    // 현재 center point - 이전 center point = center point의 이동량\n    // center point의 이동량 * viewport scale = image scale 내에서의 이동량\n    const dx: number =\n      ((pagePoints[0].x + pagePoints[1].x) / 2 - (startPagePoints[0].x + startPagePoints[1].x) / 2) / nextViewportScale;\n    const dy: number =\n      ((pagePoints[0].y + pagePoints[1].y) / 2 - (startPagePoints[0].y + startPagePoints[1].y) / 2) / nextViewportScale;\n\n    onZoom({\n      translation: {\n        x: startViewportPoint.x + dx,\n        y: startViewportPoint.y + dy,\n      },\n      scale: nextViewportScale,\n    });\n  }\n\n  function pinchEnd(event: TouchEvent) {\n    const currentViewport = getCurrentViewport();\n\n    if (!currentViewport) return;\n\n    const [minScale, maxScale] = getMinMaxScale();\n\n    // mili seconds\n    const duration = 500;\n\n    if (currentViewport.scale < minScale) {\n      const t = timer((elapsed) => {\n        // easing 처리된 시간점 (0~1)을 구한다\n        const d = easeQuadInOut(elapsed / duration);\n        if (elapsed > duration) {\n          // 목표 상태로 설정\n          onZoom({\n            translation: currentViewport.translation,\n            scale: minScale,\n          });\n          t.stop();\n        } else {\n          // 경과 animation 상태로 설정\n          // 시작 viewport scale + ( 목표가 되는 minimum scale - 시작 viewport scale ) * 시간점\n          onZoom({\n            // FIXME translation에 특별한 처리를 하지 않아서 마지막 이동 위치를 기준으로 움직이는데, 부자연스럽다면 scale에 따른 translation 조정이 필요할 수도 있다\n            translation: currentViewport.translation,\n            scale: currentViewport.scale + (minScale - currentViewport.scale) * d,\n          });\n        }\n      });\n    } else if (currentViewport.scale > maxScale) {\n      const t = timer((elapsed) => {\n        const d = easeQuadInOut(elapsed / duration);\n        if (elapsed > duration) {\n          onZoom({\n            translation: currentViewport.translation,\n            scale: maxScale,\n          });\n          t.stop();\n        } else {\n          onZoom({\n            translation: currentViewport.translation,\n            scale: currentViewport.scale + (maxScale - currentViewport.scale) * d,\n          });\n        }\n      });\n    }\n\n    element.removeEventListener('touchmove', pinchMove);\n    element.removeEventListener('touchend', pinchEnd);\n    element.removeEventListener('touchcancel', pinchEnd);\n\n    element.addEventListener('touchstart', pinchStart);\n  }\n\n  // ---------------------------------------------\n  // start\n  // ---------------------------------------------\n  element.addEventListener('wheel', wheel);\n  if (isTouchDevice()) {\n    element.addEventListener('touchstart', pinchStart);\n  }\n\n  // ---------------------------------------------\n  // end\n  // ---------------------------------------------\n  return () => {\n    element.removeEventListener('wheel', wheel);\n    element.removeEventListener('touchstart', pinchStart);\n\n    element.removeEventListener('touchmove', pinchMove);\n    element.removeEventListener('touchend', pinchEnd);\n    element.removeEventListener('touchcancel', pinchEnd);\n  };\n}\n","import pointInPolygon from 'point-in-polygon';\nimport { Contour, Point } from '../types';\n\nexport function hitTestContours<T extends Contour>(contours: T[], cursor: Point): T | null {\n  const result: T | undefined = contours.find(contour => {\n    return pointInPolygon(cursor, contour.polygon);\n  });\n\n  return result || null;\n}\n","import { Contour, Point } from '../types';\n\nexport function hitTestCircles<T extends Contour>(contours: T[], cursor: Point): T | null {\n  const result: T | undefined = contours.find(contour => {\n    const [[cx, cy], [x1, y1]] = contour.polygon;\n    const [x2, y2] = cursor;\n\n    const r1: number = Math.sqrt(Math.pow(Math.abs(x1 - cx), 2) + Math.pow(Math.abs(y1 - cy), 2));\n    const r2: number = Math.sqrt(Math.pow(Math.abs(x2 - cx), 2) + Math.pow(Math.abs(y2 - cy), 2));\n\n    return r2 <= r1;\n  });\n\n  return result || null;\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\ninterface Params {\n  deferred?: {\n    resolve: (xhrResponse: any) => void;\n    reject: (error: Error) => void;\n  };\n\n  url?: string;\n  imageId?: string;\n}\n\nexport const wadoImageLoaderXHRLoader = (getCancel?: (cancel: () => void) => void) => (\n  url: string,\n  imageId: string,\n  headers: { [key: string]: string } = {},\n  params: Params = {},\n) => {\n  const { cornerstone } = cornerstoneWADOImageLoader.external;\n  const xhr: XMLHttpRequest = new XMLHttpRequest();\n\n  return new Promise<any>((resolve: (xhrResponse: any) => void, reject: (error: Error) => void) => {\n    xhr.open('get', url, true);\n    xhr.responseType = 'arraybuffer';\n\n    Object.keys(headers).forEach(key => {\n      xhr.setRequestHeader(key, headers[key]);\n    });\n\n    params.deferred = {\n      resolve,\n      reject,\n    };\n    params.url = url;\n    params.imageId = imageId;\n\n    function cancel() {\n      try {\n        xhr.abort();\n      } catch (error) {}\n    }\n\n    if (typeof getCancel === 'function') {\n      getCancel(cancel);\n    }\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === 4 && xhr.status === 200) {\n        resolve(xhr.response);\n      }\n    };\n\n    // Event triggered when downloading an image starts\n    xhr.onloadstart = () => {\n      const eventData = {\n        url,\n        imageId,\n      };\n\n      if (cornerstone) {\n        cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadstart', eventData);\n      }\n    };\n\n    // Event triggered when downloading an image ends\n    xhr.onloadend = () => {\n      const eventData = {\n        url,\n        imageId,\n      };\n\n      cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadend', eventData);\n    };\n\n    // Event triggered when downloading an image progresses\n    xhr.onprogress = ({ loaded, lengthComputable, total }: ProgressEvent) => {\n      let percentComplete;\n\n      if (lengthComputable) {\n        percentComplete = Math.round((loaded / total) * 100);\n      }\n\n      // Event\n      const eventData = {\n        url,\n        imageId,\n        loaded,\n        total,\n        percentComplete,\n      };\n\n      cornerstone.triggerEvent(cornerstone.events, 'cornerstoneimageloadprogress', eventData);\n    };\n\n    xhr.send();\n  });\n};\n","let installed: boolean = false;\n\nexport function installWADOImageLoader() {\n  if (installed) return;\n  installed = true;\n\n  cornerstoneWADOImageLoader.external.dicomParser = dicomParser;\n  cornerstoneWADOImageLoader.external.cornerstone = cornerstone;\n  // TODO iPad에서 제대로 안되는 이유 확인\n  //cornerstoneWADOImageLoader.webWorkerManager.initialize({\n  //maxWebWorkers: navigator.hardwareConcurrency || 4,\n  //startWebWorkersOnDemand: false,\n  //taskConfiguration: {\n  //  decodeTask: {\n  //    initializeCodecsOnStartup: true,\n  //  },\n  //},\n  //});\n}\n","export function unloadImage(imageId: string | string[] | null) {\n  function unload(id: string) {\n    if (/^wadouri:/.test(id)) {\n      cornerstoneWADOImageLoader?.wadouri?.dataSetCacheManager?.unload(id);\n    }\n  }\n\n  if (Array.isArray(imageId)) {\n    imageId.forEach(id => unload(id));\n  } else if (typeof imageId === 'string') {\n    unload(imageId);\n  }\n}\n\n/** @deprecated use instead of unloadImage() */\nexport const unloadWADOImage = unloadImage;\n","import React, { Component } from 'react';\nimport { Unsubscribable } from 'rxjs';\nimport { FrameConsumer } from '../context/frame';\nimport { InsightViewerHostProps } from '../hooks/useInsightViewerSync';\nimport { CornerstoneImage } from '../image/types';\nimport { CornerstoneRenderData, CornerstoneViewerLike, ViewportTransform, ViewportTransformParams } from '../types';\nimport { startAdjustInteraction } from './interactions/startAdjustInteraction';\nimport { startPanInteraction } from './interactions/startPanInteraction';\nimport { startZoomInteraction } from './interactions/startZoomInteraction';\n\nexport interface InsightViewerProps extends InsightViewerHostProps {\n  width: number;\n  height: number;\n\n  image: CornerstoneImage;\n\n  /**\n   * Pan Action (Mouse Drag)\n   *\n   * - `true` 로 입력되는 경우 자체 Element를 사용해서 Event를 처리한다\n   * - `HTMLElement` 로 입력되는 경우 해당 Element를 사용해서 Event를 처리한다\n   * - `false | null` 로 입력되는 경우 Pan 기능을 끈다\n   */\n  pan: boolean | HTMLElement | null;\n\n  /**\n   * Adjust Action (Mouse Drag)\n   *\n   * - `true` 로 입력되는 경우 자체 Element를 사용해서 Event를 처리한다\n   * - `HTMLElement` 로 입력되는 경우 해당 Element를 사용해서 Event를 처리한다\n   * - `false | null` 로 입력되는 경우 Adjust 기능을 끈다\n   */\n  adjust: boolean | HTMLElement | null;\n\n  /**\n   * Zoom Action (Mouse Wheel)\n   *\n   * - `true` 로 입력되는 경우 자체 Element를 사용해서 Event를 처리한다\n   * - `HTMLElement` 로 입력되는 경우 해당 Element를 사용해서 Event를 처리한다\n   * - `false | null` 로 입력되는 경우 Wheel 기능을 끈다\n   */\n  zoom: boolean | HTMLElement | null;\n\n  /** Invert Color Image */\n  invert: boolean;\n\n  /** Flip Image */\n  flip: boolean;\n\n  /**\n   * Date.now() 로 입력하면 된다.\n   * 값이 변경되는 경우 Pan, Adjust, Zoom 으로 변경된 상태들이 초기화 된다.\n   */\n  resetTime: number;\n\n  /**\n   * Image가 최초 그려지는 순간 변경한다\n   */\n  defaultViewportTransforms?: ViewportTransform[];\n}\n\nconst maxScale: number = 3;\n\n/** @deprecated use <CornerstoneViewer> instead */\nexport class InsightViewer extends Component<InsightViewerProps, {}> implements CornerstoneViewerLike {\n  // ref={}에 의해서 componentDidMount() 이전에 반드시 들어온다\n  private element!: HTMLDivElement;\n\n  // imageLoaded 이후 지연되어 들어오게 된다\n  // setViewport, updateViewport 에 의해서만 접근한다\n  private currentViewport: cornerstone.Viewport | null = null;\n  // props.image.subscribe()를 통해서 지연되어 들어오게 된다\n  private currentImage: cornerstone.Image | null = null;\n\n  // mouse interaction에서 사용한다\n  private teardownPanInteraction: (() => void) | null = null;\n  private teardownAdjustInteraction: (() => void) | null = null;\n  private teardownZoomInteraction: (() => void) | null = null;\n\n  // rx subscriptions\n  private imageSubscription: Unsubscribable | null = null;\n\n  private needImageInitialize: boolean = true;\n\n  private contentWindow: Window = window;\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <div\n          ref={this.elementRef}\n          style={{\n            width: this.props.width,\n            height: this.props.height,\n          }}\n        />\n      </>\n    );\n  }\n\n  // ---------------------------------------------\n  // life cycle\n  // ---------------------------------------------\n  elementRef = (element: HTMLDivElement) => {\n    this.element = element;\n\n    if (!element) return;\n\n    if (this.props.pan === true) {\n      this.startPanInteraction(this.props.pan);\n    }\n\n    if (this.props.adjust === true) {\n      this.startAdjustInteraction(this.props.adjust);\n    }\n\n    if (this.props.zoom === true) {\n      this.startZoomInteraction(this.props.zoom);\n    }\n  };\n\n  componentDidMount() {\n    // cornerstone의 imagernderered event를 받는다\n    // image가 render 될때마다 context로 enabledElement를 배포해주기 위해 필요하다\n    this.element.addEventListener(cornerstone.EVENTS.IMAGE_RENDERED, this.onImageRenderered);\n\n    this.setCornerstoneImage(this.props.image);\n  }\n\n  initImage = (image: cornerstone.Image) => {\n    cornerstone.disable(this.element);\n    cornerstone.enable(this.element, { renderer: 'webgl' });\n\n    let defaultViewport = this.getDefaultViewport(image, this.element);\n\n    if (!defaultViewport) {\n      throw new Error('defaultViewport는 null일 수 없다.');\n    }\n\n    if (Array.isArray(this.props.defaultViewportTransforms)) {\n      const minScale: number = defaultViewport.scale;\n\n      for (const transform of this.props.defaultViewportTransforms) {\n        const patch = transform({\n          element: this.element,\n          currentViewport: defaultViewport,\n          minScale,\n          maxScale,\n        });\n\n        defaultViewport = {\n          ...defaultViewport,\n          ...patch,\n        };\n      }\n    }\n\n    defaultViewport = {\n      ...defaultViewport,\n      hflip: this.props.flip,\n      invert: this.props.invert,\n    };\n\n    cornerstone.displayImage(this.element, image, defaultViewport);\n\n    this.setImage(image);\n    this.setViewport(defaultViewport);\n    this.startPanInteraction(this.props.pan);\n    this.startAdjustInteraction(this.props.adjust);\n    this.startZoomInteraction(this.props.zoom);\n  };\n\n  componentWillUnmount() {\n    this.element.removeEventListener(cornerstone.EVENTS.IMAGE_RENDERED, this.onImageRenderered);\n    cornerstone.disable(this.element);\n\n    if (this.imageSubscription) {\n      this.imageSubscription.unsubscribe();\n    }\n\n    if (this.teardownPanInteraction) {\n      this.teardownPanInteraction();\n    }\n\n    if (this.teardownAdjustInteraction) {\n      this.teardownAdjustInteraction();\n    }\n\n    if (this.teardownZoomInteraction) {\n      this.teardownZoomInteraction();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<InsightViewerProps>) {\n    const { width, height, flip, invert, pan, adjust, zoom, resetTime, image } = this.props;\n\n    const defaultViewport: cornerstone.Viewport | null = this.getDefaultViewport(this.currentImage, this.element);\n\n    // 선택된 control 상태에 따라 event를 해제/등록 해준다\n    if (prevProps.pan !== pan) {\n      this.startPanInteraction(pan);\n    }\n\n    if (prevProps.adjust !== adjust) {\n      this.startAdjustInteraction(adjust);\n    }\n\n    if (prevProps.zoom !== zoom) {\n      this.startZoomInteraction(zoom);\n    }\n\n    if (defaultViewport) {\n      if (prevProps.resetTime !== resetTime) {\n        // resetTime이 새로 갱신되면 viewport를 defaultViewport를 사용해서 초기화 해준다\n        this.updateCurrentViewport({\n          ...defaultViewport,\n          //...this.defaultViewport,\n          hflip: flip,\n          invert: defaultViewport.invert ? !invert : invert,\n        });\n      } else {\n        // flip, invert는 resetTime의 부분 집합이기 때문에\n        // resetTime에 의한 갱신이 없는 경우에만 적용한다\n        if (prevProps.flip !== flip || prevProps.invert !== invert) {\n          this.updateCurrentViewport({\n            hflip: flip,\n            invert: defaultViewport.invert ? !invert : invert,\n          });\n        }\n      }\n    }\n\n    if (prevProps.width !== width || prevProps.height !== height) {\n      if (this.currentImage) {\n        // container size가 변경되는 경우 cornerstone resize() 처리를 해준다\n        cornerstone.resize(this.element);\n\n        const viewport = cornerstone.getViewport(this.element);\n\n        if (viewport) {\n          this.setViewport(viewport);\n        } else {\n          throw new Error('getViewport() is returns not a Viewport');\n        }\n      }\n    }\n\n    if (prevProps.image !== image) {\n      this.setCornerstoneImage(image);\n    }\n  }\n\n  subscribeImage = (image: cornerstone.Image | null) => {\n    if (!image) return;\n\n    image.voiLUT = undefined; // remove VOI LUT for 'adjust' functionality\n\n    // props.image의 변경 또는 초기화로 인한 완전한 초기화가 필요할때\n    if (this.needImageInitialize) {\n      this.needImageInitialize = false;\n      this.initImage(image);\n    }\n    // 단순 series image의 변경일 경우에는 화면 표시만 바꿔준다\n    else if (this.currentViewport) {\n      cornerstone.displayImage(this.element, image, this.currentViewport);\n    }\n    // 이건 실행되면 안됨\n    else {\n      throw new Error('어떤 상황인지 확인 필요!!!');\n    }\n  };\n\n  onImageRenderered = (event: cornerstone.CornerstoneEvent) => {\n    const eventData: cornerstone.CornerstoneEventData | undefined = event.detail;\n    if (\n      eventData &&\n      eventData.canvasContext &&\n      eventData.element &&\n      eventData.enabledElement &&\n      eventData.image &&\n      typeof eventData.renderTimeInMs === 'number' &&\n      eventData.viewport\n    ) {\n      this.currentViewport = eventData.viewport;\n      this.props.updateCornerstoneRenderData(eventData as CornerstoneRenderData);\n    } else {\n      console.error('CornerstoneEventData에 없는 정보가 있다???', eventData);\n    }\n  };\n\n  // ---------------------------------------------\n  // event handlers\n  // ---------------------------------------------\n  startPanInteraction = (pan: boolean | HTMLElement | null) => {\n    if (this.teardownPanInteraction) {\n      this.teardownPanInteraction();\n    }\n\n    const element: HTMLElement | null =\n      pan instanceof this.contentWindow['HTMLElement'] ? (pan as HTMLElement) : pan === true ? this.element : null;\n\n    if (element) {\n      this.teardownPanInteraction = startPanInteraction({\n        element,\n        getCurrentViewport: () => this.currentViewport!,\n        onMove: (translation: cornerstone.Vec2) => this.updateCurrentViewport({ translation }),\n        onEnd: () => {},\n        contentWindow: this.contentWindow,\n      });\n    }\n  };\n\n  startAdjustInteraction = (adjust: boolean | HTMLElement | null) => {\n    if (this.teardownAdjustInteraction) {\n      this.teardownAdjustInteraction();\n    }\n\n    const element: HTMLElement | null =\n      adjust instanceof this.contentWindow['HTMLElement']\n        ? (adjust as HTMLElement)\n        : adjust === true\n        ? this.element\n        : null;\n\n    if (element) {\n      this.teardownAdjustInteraction = startAdjustInteraction({\n        element,\n        getCurrentViewport: () => this.currentViewport!,\n        onMove: (voi: cornerstone.VOI) => this.updateCurrentViewport({ voi }),\n        onEnd: () => {},\n        contentWindow: this.contentWindow,\n      });\n    }\n  };\n\n  startZoomInteraction = (zoom: boolean | HTMLElement | null) => {\n    if (this.teardownZoomInteraction) {\n      this.teardownZoomInteraction();\n    }\n\n    const element: HTMLElement | null =\n      zoom instanceof this.contentWindow['HTMLElement'] ? (zoom as HTMLElement) : zoom === true ? this.element : null;\n\n    if (element) {\n      this.teardownZoomInteraction = startZoomInteraction({\n        element,\n        getMinMaxScale: () => [this.getMinScale(), this.getMaxScale()],\n        getCurrentViewport: () => this.currentViewport!,\n        onZoom: (patch) => this.updateCurrentViewport(patch),\n        contentWindow: this.contentWindow,\n      });\n    }\n  };\n\n  // ---------------------------------------------\n  // getters\n  // ---------------------------------------------\n  getElement = () => this.element;\n\n  getContentWindow = () => this.contentWindow;\n\n  getCurrentViewport = () => this.currentViewport!;\n\n  getDefaultViewport = (image: cornerstone.Image | null, element: HTMLElement | null): cornerstone.Viewport | null => {\n    if (!image || !element) return null;\n    return cornerstone.getDefaultViewportForImage(element, image);\n  };\n\n  getMinScale = () => {\n    const viewport = this.getDefaultViewport(this.currentImage, this.element);\n\n    if (!viewport) {\n      throw new Error('viewport가 정상적으로 와야만 한다');\n    }\n\n    return viewport.scale;\n  };\n\n  getMaxScale = () => {\n    return maxScale;\n  };\n\n  // ---------------------------------------------\n  // setters\n  // ---------------------------------------------\n  updateViewport = (patch: Partial<cornerstone.Viewport>) => {\n    if (this.currentViewport) {\n      this.updateCurrentViewport(patch);\n    }\n  };\n\n  getViewportTransformParams = (): ViewportTransformParams => {\n    return {\n      element: this.element,\n      minScale: this.getMinScale(),\n      maxScale: this.getMaxScale(),\n      currentViewport: this.currentViewport,\n    };\n  };\n\n  private setCornerstoneImage = (image: CornerstoneImage) => {\n    this.needImageInitialize = true;\n\n    this.setImage(null);\n\n    if (this.imageSubscription) {\n      this.imageSubscription.unsubscribe();\n      this.imageSubscription = null;\n    }\n\n    this.imageSubscription = image.image.subscribe(this.subscribeImage);\n  };\n\n  private setImage = (image: cornerstone.Image | null) => {\n    this.currentImage = image;\n  };\n\n  private setViewport = (viewport: cornerstone.Viewport) => {\n    this.currentViewport = viewport;\n    cornerstone.setViewport(this.element, this.currentViewport);\n  };\n\n  private updateCurrentViewport = (\n    update: Partial<cornerstone.Viewport> | ((viewport: cornerstone.Viewport) => Partial<cornerstone.Viewport>),\n  ) => {\n    if (!this.currentViewport) {\n      throw new Error('viewport가 없는 상태에서 실행되면 안된다');\n    }\n\n    const patch: Partial<cornerstone.Viewport> = typeof update === 'function' ? update(this.currentViewport) : update;\n\n    this.currentViewport = {\n      ...this.currentViewport,\n      ...patch,\n    };\n\n    cornerstone.setViewport(this.element, this.currentViewport);\n  };\n}\n","import polylabel from 'polylabel';\nimport React, { Component, createRef, CSSProperties, Fragment, RefObject } from 'react';\nimport styled from 'styled-components';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\n\nexport interface ContourViewerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /** Mouse Over 등 User Interaction에 의해서 Focus 된 Contour */\n  focusedContour: T | null;\n\n  /** <svg className={}> */\n  className?: string;\n\n  /** <svg style={}> */\n  style?: CSSProperties;\n\n  /**\n   * Line에 외곽을 그려준다\n   * Line을 두 개 그려서 border를 표현하기 때문에,성능에 민감한 상황인 경우 비활성 시킬 수 있다.\n   */\n  border?: boolean;\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): Point[] {\n  return polygon.map(([x, y]) => {\n    const p = cornerstone.pixelToCanvas(element, { x, y });\n    return [p.x, p.y];\n  });\n}\n\nexport class ContourViewerBase<T extends Contour> extends Component<ContourViewerProps<T>, {}> {\n  static defaultProps: Pick<ContourViewerProps<Contour>, 'border'> = {\n    border: true,\n  };\n\n  private svgRef: RefObject<SVGSVGElement> = createRef();\n\n  render() {\n    const { cornerstoneRenderData, contours, focusedContour } = this.props;\n\n    return (\n      <svg\n        ref={this.svgRef}\n        className={this.props.className}\n        style={this.props.style}\n        width={this.props.width}\n        height={this.props.height}\n      >\n        {contours.length > 0 &&\n          cornerstoneRenderData &&\n          cornerstoneRenderData.element &&\n          contours.map(contour => {\n            const polygon: number[][] = toLocal(cornerstoneRenderData.element, contour.polygon);\n            const labelCenter: number[] = polylabel([polygon], 1);\n            const focused: boolean = contour === focusedContour;\n            const dataAttrs: { [attr: string]: string } = contour.dataAttrs || {};\n\n            return (\n              <Fragment key={'polygon' + contour.id}>\n                {this.props.border === true && (\n                  <polygon\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                  />\n                )}\n                <polygon\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                />\n                {this.props.border === true && (\n                  <text\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                    x={labelCenter[0]}\n                    y={labelCenter[1]}\n                  >\n                    {contour.label\n                      ? typeof contour.label === 'function'\n                        ? contour.label(contour)\n                        : contour.label\n                      : contour.id}\n                  </text>\n                )}\n                <text\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                  x={labelCenter[0]}\n                  y={labelCenter[1]}\n                >\n                  {contour.label\n                    ? typeof contour.label === 'function'\n                      ? contour.label(contour)\n                      : contour.label\n                    : contour.id}\n                </text>\n              </Fragment>\n            );\n          })}\n      </svg>\n    );\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const ContourViewer: new <T extends Contour>() => ContourViewerBase<T> = styled(ContourViewerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  user-select: none;\n\n  --color: #ffffff;\n  --focused-color: rgb(255, 194, 17);\n  --stroke-width: 3px;\n  --focused-stroke-width: 6px;\n  --fill-color: rgba(0, 0, 0, 0.2);\n  --focused-fill-color: rgba(0, 0, 0, 0.4);\n\n  > polygon {\n    stroke-width: var(--contour-viewer-stroke-width, var(--stroke-width));\n    stroke: var(--contour-viewer-color, var(--color));\n    fill: var(--contour-viewer-fill-color, var(--fill-color));\n    transition: stroke 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      stroke-width: var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width));\n      stroke: var(--contour-viewer-focused-color, var(--focused-color));\n      fill: var(--contour-viewer-focused-fill-color, var(--focused-fill-color));\n    }\n\n    &[data-border] {\n      stroke-width: calc(var(--contour-viewer-stroke-width, var(--stroke-width)) + 2px);\n      stroke: #000000;\n      fill: transparent;\n\n      &[data-focused] {\n        stroke-width: calc(var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width)) + 2px);\n        stroke: #000000;\n      }\n    }\n  }\n\n  > text {\n    fill: var(--contour-viewer-color, var(--color));\n    font-family: proximanova, noto_sans, sans-serif;\n    font-weight: 600;\n    text-anchor: middle;\n    dominant-baseline: central;\n    transition: fill 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      fill: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: 4px;\n      stroke: #000000;\n      fill: transparent;\n    }\n  }\n` as any;\n\n/**\n * @deprecated use ContourViewer instead\n */\nexport const UserContourViewer = ContourViewer;\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { FrameConsumer } from '../context/frame';\nimport { hitTestContours } from '../geom/hitTestContours';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\n\nexport interface ContourHoverProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /**\n   * Hover 기능 활성화 여부\n   * HTMLElement로 입력할 경우 MouseEvent를 해당 HTMLElement를 사용해서 처리한다.\n   */\n  hover: boolean | HTMLElement | null;\n\n  /**\n   * 특정 Contour에 Mouse Over 되었을 때\n   * focusedContour를 결정하는데 필요하다\n   */\n  onFocus: (contour: T | null) => void;\n\n  className?: string;\n}\n\ninterface ContourHoverState {\n  polygon: Point[];\n}\n\nexport class ContourHoverBase<T extends Contour> extends Component<ContourHoverProps<T>, ContourHoverState> {\n  private svg: SVGSVGElement | null = null;\n  private element: HTMLElement | null = null;\n  private focused: T | null = null;\n  private contentWindow: Window = window;\n\n  constructor(props: ContourHoverProps<T>) {\n    super(props);\n\n    this.state = {\n      polygon: [],\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <svg\n          ref={this.svgRef}\n          role=\"figure\"\n          width={this.props.width}\n          height={this.props.height}\n          className={this.props.className}\n        ></svg>\n      </>\n    );\n  }\n\n  svgRef = (svg: SVGSVGElement) => {\n    if (svg && this.svg && this.element) {\n      this.deactivateInitialEvents();\n\n      if (this.canActivate(this.props)) {\n        this.svg = svg;\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n\n    this.svg = svg;\n  };\n\n  componentDidMount() {\n    if (!this.svg) throw new Error('<svg> is not initialized');\n\n    if (this.canActivate(this.props)) {\n      this.element = this.getElement(this.props);\n      this.activateInitialEvents();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<ContourHoverProps<T>>) {\n    if (prevProps.hover !== this.props.hover) {\n      if (this.element) this.deactivateInitialEvents();\n\n      if (this.canActivate(this.props)) {\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.element) this.deactivateInitialEvents();\n  }\n\n  getElement = ({ hover }: Readonly<ContourHoverProps<T>>): HTMLElement => {\n    //@ts-ignore\n    return hover instanceof this.contentWindow['HTMLElement'] ? (hover as HTMLElement) : (this.svg as HTMLElement);\n  };\n\n  canActivate = ({ hover }: Readonly<ContourHoverProps<T>>) => {\n    return hover instanceof this.contentWindow['HTMLElement'] || hover === true;\n  };\n\n  // ---------------------------------------------\n  // initial events\n  // ---------------------------------------------\n  activateInitialEvents = () => {\n    if (this.element) this.element.addEventListener('mousemove', this.onMouseMoveToFindFocus);\n  };\n\n  deactivateInitialEvents = () => {\n    if (this.element) this.element.removeEventListener('mousemove', this.onMouseMoveToFindFocus);\n  };\n\n  onMouseMoveToFindFocus = (event: MouseEvent) => {\n    this.findFocus(event.pageX, event.pageY);\n  };\n\n  findFocus = (pageX: number, pageY: number) => {\n    if (!this.props.contours || this.props.contours.length === 0 || !this.props.cornerstoneRenderData) return;\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, pageX, pageY);\n\n    this.focused = hitTestContours<T>(this.props.contours, [x, y]);\n\n    this.props.onFocus(this.focused);\n  };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const ContourHover: new <T extends Contour>() => ContourHoverBase<T> = styled(ContourHoverBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n` as any;\n","import styled from 'styled-components';\n\nexport const InsightViewerContainer = styled.div<{ width: number; height: number }>`\n  background-color: #000000;\n  position: relative;\n  width: ${({ width }) => width}px;\n  height: ${({ height }) => height}px;\n`;\n\nexport const LeftTopHolder = styled.div`\n  position: absolute;\n  left: 5px;\n  top: 5px;\n`;\n\nexport const LeftBottomHolder = styled.div`\n  position: absolute;\n  left: 5px;\n  bottom: 5px;\n`;\n\nexport const RightTopHolder = styled.div`\n  position: absolute;\n  right: 5px;\n  top: 5px;\n`;\n\nexport const RightBottomHolder = styled.div`\n  position: absolute;\n  right: 5px;\n  bottom: 5px;\n`;\n","import { CircularProgress } from '@material-ui/core';\nimport React, {\n  Context,\n  createContext,\n  CSSProperties,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport styled from 'styled-components';\nimport { useImageProgress } from '../hooks/useImageProgress';\nimport { CornerstoneImage } from '../image/types';\n\nexport interface ProgressViewerProps {\n  width: number;\n  height: number;\n  inProgress?: boolean;\n  image?: CornerstoneImage | null | undefined;\n}\n\nlet count: number = 0;\n\nexport function ProgressViewer({ width, height, inProgress, image }: ProgressViewerProps) {\n  const id: number = useMemo(() => ++count, []);\n  const imageProgress = useImageProgress(image);\n  const { setProgress, unsetProgress } = useProgressCollection();\n\n  useEffect(() => {\n    if (inProgress === true || typeof imageProgress === 'number') {\n      setProgress(id, imageProgress || 0);\n    } else {\n      unsetProgress(id);\n    }\n  }, [id, imageProgress, inProgress, setProgress, unsetProgress]);\n\n  return (\n    <>\n      {(inProgress === true || typeof imageProgress === 'number') && (\n        <Div\n          style={{\n            width,\n            height,\n            backgroundColor: 'rgba(0, 0, 0, 0.3)',\n          }}\n        >\n          <CircularProgress size={120} />\n        </Div>\n      )}\n      {typeof imageProgress === 'number' && (\n        <Div\n          style={{\n            width,\n            height,\n          }}\n        >\n          <CircularProgress size={100} variant=\"static\" value={imageProgress * 100} />\n        </Div>\n      )}\n    </>\n  );\n}\n\ninterface ProgressCollectorProps {\n  children: ReactNode;\n}\n\ninterface ProgressCollection {\n  inProgress: boolean;\n  setProgress: (id: number, progress: number) => void;\n  unsetProgress: (id: number) => void;\n}\n\nconst ProgressCollectionContext: Context<ProgressCollection> = createContext<ProgressCollection>({\n  inProgress: false,\n\n  setProgress: () => {\n    // DO NOTHING\n  },\n  unsetProgress: () => {\n    // DO NOTHING\n  },\n});\n\nexport function ProgressCollector({ children }: ProgressCollectorProps) {\n  const [collection, setCollection] = useState<Map<number, number>>(() => new Map());\n\n  const setProgress = useCallback(\n    (id: number, progress: number) => {\n      setCollection(prevCollection => {\n        const nextCollection: Map<number, number> = new Map(prevCollection);\n        nextCollection.set(id, progress);\n        return nextCollection;\n      });\n    },\n    [setCollection],\n  );\n\n  const unsetProgress = useCallback(\n    (id: number) => {\n      setCollection(prevCollection => {\n        if (prevCollection.has(id)) {\n          const nextCollection: Map<number, number> = new Map(prevCollection);\n          nextCollection.delete(id);\n          return nextCollection;\n        }\n        return prevCollection;\n      });\n    },\n    [setCollection],\n  );\n\n  const inProgress: boolean = useMemo(() => {\n    return collection.size > 0;\n  }, [collection]);\n\n  const state: ProgressCollection = useMemo<ProgressCollection>(() => {\n    return {\n      inProgress,\n      setProgress,\n      unsetProgress,\n    };\n  }, [inProgress, setProgress, unsetProgress]);\n\n  return <ProgressCollectionContext.Provider value={state}>{children}</ProgressCollectionContext.Provider>;\n}\n\nfunction useProgressCollection(): ProgressCollection {\n  return useContext(ProgressCollectionContext);\n}\n\nexport function useProgressViewersActivity(): boolean {\n  return useContext(ProgressCollectionContext).inProgress;\n}\n\nexport function useContainerStyleOfProgressViewersInactivity(\n  style: CSSProperties = { pointerEvents: 'none' },\n): CSSProperties {\n  const { inProgress } = useContext(ProgressCollectionContext);\n  return inProgress ? style : {};\n}\n\nconst Div = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n","import React, { Component, createRef, CSSProperties, Fragment, RefObject } from 'react';\nimport styled from 'styled-components';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\n\nexport interface CircleViewerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /** Mouse Over 등 User Interaction에 의해서 Focus 된 Contour */\n  focusedContour: T | null;\n\n  /** <svg className={}> */\n  className?: string;\n\n  /** <svg style={}> */\n  style?: CSSProperties;\n\n  /**\n   * Line에 외곽을 그려준다\n   * Line을 두 개 그려서 border를 표현하기 때문에,성능에 민감한 상황인 경우 비활성 시킬 수 있다.\n   */\n  border?: boolean;\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): { cx: number; cy: number; r: number } {\n  const { x: x1, y: y1 } = cornerstone.pixelToCanvas(element, { x: polygon[0][0], y: polygon[0][1] });\n  const { x: x2, y: y2 } = cornerstone.pixelToCanvas(element, { x: polygon[1][0], y: polygon[1][1] });\n  const r: number = Math.sqrt(Math.pow(Math.abs(x2 - x1), 2) + Math.pow(Math.abs(y2 - y1), 2));\n\n  return {\n    cx: x1,\n    cy: y1,\n    r,\n  };\n}\n\nexport class CircleViewerBase<T extends Contour> extends Component<CircleViewerProps<T>, {}> {\n  static defaultProps: Pick<CircleViewerProps<Contour>, 'border'> = {\n    border: true,\n  };\n\n  private svgRef: RefObject<SVGSVGElement> = createRef();\n\n  render() {\n    const { cornerstoneRenderData, contours, focusedContour } = this.props;\n\n    return (\n      <svg\n        ref={this.svgRef}\n        className={this.props.className}\n        style={this.props.style}\n        width={this.props.width}\n        height={this.props.height}\n      >\n        {contours.length > 0 &&\n          cornerstoneRenderData &&\n          cornerstoneRenderData.element &&\n          contours.map(contour => {\n            const { cx, cy, r } = toLocal(cornerstoneRenderData.element, contour.polygon);\n            const focused: boolean = contour === focusedContour;\n            const dataAttrs: { [attr: string]: string } = contour.dataAttrs || {};\n\n            return (\n              <Fragment key={'circle' + contour.id}>\n                {this.props.border === true && (\n                  <circle\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    cx={cx}\n                    cy={cy}\n                    r={r}\n                  />\n                )}\n                <circle {...dataAttrs} data-id={contour.id} data-focused={focused || undefined} cx={cx} cy={cy} r={r} />\n                {this.props.border === true && (\n                  <text\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                    x={cx}\n                    y={cy}\n                  >\n                    {contour.label\n                      ? typeof contour.label === 'function'\n                        ? contour.label(contour)\n                        : contour.label\n                      : contour.id}\n                  </text>\n                )}\n                <text\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                  x={cx}\n                  y={cy}\n                >\n                  {contour.label\n                    ? typeof contour.label === 'function'\n                      ? contour.label(contour)\n                      : contour.label\n                    : contour.id}\n                </text>\n              </Fragment>\n            );\n          })}\n      </svg>\n    );\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const CircleViewer: new <T extends Contour>() => CircleViewerBase<T> = styled(CircleViewerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  user-select: none;\n\n  --color: #ffffff;\n  --focused-color: rgb(255, 194, 17);\n  --stroke-width: 3px;\n  --focused-stroke-width: 6px;\n  --fill-color: rgba(0, 0, 0, 0.2);\n  --focused-fill-color: rgba(0, 0, 0, 0.4);\n\n  > circle {\n    stroke-width: var(--contour-viewer-stroke-width, var(--stroke-width));\n    stroke: var(--contour-viewer-color, var(--color));\n    fill: var(--contour-viewer-fill-color, var(--fill-color));\n    transition: stroke 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      stroke-width: var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width));\n      stroke: var(--contour-viewer-focused-color, var(--focused-color));\n      fill: var(--contour-viewer-focused-fill-color, var(--focused-fill-color));\n    }\n\n    &[data-border] {\n      stroke-width: calc(var(--contour-viewer-stroke-width, var(--stroke-width)) + 2px);\n      stroke: #000000;\n      fill: transparent;\n\n      &[data-focused] {\n        stroke-width: calc(var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width)) + 2px);\n        stroke: #000000;\n      }\n    }\n  }\n\n  > text {\n    fill: var(--contour-viewer-color, var(--color));\n    font-family: proximanova, noto_sans, sans-serif;\n    font-weight: 600;\n    text-anchor: middle;\n    dominant-baseline: central;\n    transition: fill 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      fill: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: 4px;\n      stroke: #000000;\n      fill: transparent;\n    }\n  }\n` as any;\n\n/**\n * @deprecated use CircleViewer instead\n */\nexport const UserCircleViewer = CircleViewer;\n","import { isTouchDevice } from '@lunit/is-touch-device';\nimport React, { Component, CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { FrameConsumer } from '../context/frame';\nimport { hitTestCircles } from '../geom/hitTestCircles';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\nimport { dashStroke } from './animation/dashStroke';\n\nexport interface CircleDrawerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /**\n   * 그리기 기능 활성화 여부\n   *\n   * HTMLElement로 입력할 경우 MouseEvent를 해당 HTMLElement를 사용해서 처리한다\n   */\n  draw: boolean | HTMLElement | null;\n\n  /**\n   * 특정 Contour에 Mouse Over 되었을 때\n   * focusedContour를 결정하는데 필요하다\n   */\n  onFocus: (contour: T | null) => void;\n\n  /** 그리기가 완료되어 새로운 Contour가 발생했을 때 */\n  onAdd: (polygon: Point[], event: MouseEvent | TouchEvent) => void;\n\n  /** 특정 Contour를 Click 해서 지울때 필요하다 */\n  onRemove: (contour: T) => void;\n\n  className?: string;\n  style?: CSSProperties;\n\n  /** 그리는 과정에서 Line에 표현되는 Animation을 비활성 시킬 수 있다 */\n  animateStroke?: boolean;\n\n  /**\n   * 접근 Device 설정\n   */\n  device?: 'all' | 'mouse-only' | 'touch-only' | 'stylus-only' | 'mouse-and-stylus';\n}\n\ninterface CircleDrawerState {\n  p1: Point | null;\n  p2: Point | null;\n}\n\nexport class CircleDrawerBase<T extends Contour> extends Component<CircleDrawerProps<T>, CircleDrawerState> {\n  static defaultProps: Partial<CircleDrawerProps<Contour>> = {\n    device: 'all',\n  };\n\n  private svg: SVGSVGElement | null = null;\n  private element: HTMLElement | null = null;\n  private focused: T | null = null;\n  private preventClickEvent: boolean = false;\n  private startX: number = 0;\n  private startY: number = 0;\n\n  private contentWindow: Window = window;\n\n  constructor(props: CircleDrawerProps<T>) {\n    super(props);\n\n    this.state = {\n      p1: null,\n      p2: null,\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <svg\n          ref={this.svgRef}\n          role=\"figure\"\n          width={this.props.width}\n          height={this.props.height}\n          className={this.props.className}\n          style={this.props.style}\n        >\n          {this.props.cornerstoneRenderData &&\n            this.state.p1 &&\n            this.state.p2 &&\n            (() => {\n              const { x: x1, y: y1 } = cornerstone.pixelToCanvas(this.props.cornerstoneRenderData.element, {\n                x: this.state.p1[0],\n                y: this.state.p1[1],\n              });\n              const { x: x2, y: y2 } = cornerstone.pixelToCanvas(this.props.cornerstoneRenderData.element, {\n                x: this.state.p2[0],\n                y: this.state.p2[1],\n              });\n              const r: number = Math.sqrt(Math.pow(Math.abs(x2 - x1), 2) + Math.pow(Math.abs(y2 - y1), 2));\n\n              return (\n                <>\n                  <circle cx={x1} cy={y1} r={r} />\n                  {this.props.animateStroke !== false && <circle cx={x1} cy={y1} r={r} data-highlight=\"highlight\" />}\n                  <line x1={x1} y1={y1} x2={x2} y2={y2} />\n                </>\n              );\n            })()}\n        </svg>\n      </>\n    );\n  }\n\n  svgRef = (svg: SVGSVGElement) => {\n    if (svg && this.svg && this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n\n      if (this.canActivate(this.props)) {\n        this.svg = svg;\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n\n    this.svg = svg;\n  };\n\n  componentDidMount() {\n    if (!this.svg) throw new Error('<svg> is not initialized');\n\n    if (this.canActivate(this.props)) {\n      this.element = this.getElement(this.props);\n      this.activateInitialEvents();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<CircleDrawerProps<T>>) {\n    if (prevProps.draw !== this.props.draw) {\n      if (this.element) {\n        this.deactivateInitialEvents();\n        this.deactivateMouseDrawEvents();\n      }\n\n      if (this.canActivate(this.props)) {\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n    }\n  }\n\n  getElement = ({ draw }: Readonly<CircleDrawerProps<T>>): HTMLElement => {\n    //@ts-ignore\n    return draw instanceof this.contentWindow['HTMLElement'] ? (draw as HTMLElement) : (this.svg as HTMLElement);\n  };\n\n  canActivate = ({ draw }: Readonly<CircleDrawerProps<T>>) => {\n    return draw instanceof this.contentWindow['HTMLElement'] || draw === true;\n  };\n\n  // ---------------------------------------------\n  // initial events\n  // ---------------------------------------------\n  activateInitialEvents = () => {\n    if (!this.element) return;\n    if (this.props.device !== 'touch-only' && this.props.device !== 'stylus-only') {\n      this.element.addEventListener('mousemove', this.onMouseMoveToFindFocus);\n      this.element.addEventListener('mousedown', this.onMouseDownToStartDraw);\n    }\n    if (isTouchDevice() && this.props.device !== 'mouse-only') {\n      this.element.addEventListener('touchstart', this.onTouchStartToStartDraw);\n    }\n    this.element.addEventListener('click', this.onMouseClickToRemove);\n  };\n\n  deactivateInitialEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToFindFocus);\n    this.element.removeEventListener('mousedown', this.onMouseDownToStartDraw);\n    this.element.removeEventListener('touchstart', this.onTouchStartToStartDraw);\n    this.element.removeEventListener('click', this.onMouseClickToRemove);\n  };\n\n  onMouseMoveToFindFocus = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    this.findFocus(event.pageX, event.pageY);\n  };\n\n  findFocus = (pageX: number, pageY: number) => {\n    if (!this.props.contours || this.props.contours.length === 0 || !this.props.cornerstoneRenderData) return;\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, pageX, pageY);\n\n    this.focused = hitTestCircles(this.props.contours, [x, y]);\n\n    this.props.onFocus(this.focused);\n  };\n\n  onMouseClickToRemove = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    if (!this.focused || this.preventClickEvent) return;\n\n    this.props.onRemove(this.focused);\n  };\n\n  // ---------------------------------------------\n  // touch draw events\n  // ---------------------------------------------\n  onTouchStartToStartDraw = (event: TouchEvent) => {\n    if (\n      (this.props.device === 'stylus-only' || this.props.device === 'mouse-and-stylus') &&\n      event.targetTouches[0].touchType !== 'stylus'\n    ) {\n      return;\n    } else if (event.targetTouches.length > 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        p1: null,\n        p2: null,\n      }));\n      return;\n    } else if (event.targetTouches.length !== 1) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.targetTouches[0].pageX;\n    this.startY = event.targetTouches[0].pageY;\n\n    this.deactivateInitialEvents();\n    this.activateTouchDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: [x, y],\n    }));\n  };\n\n  activateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.addEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.addEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  deactivateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.removeEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.removeEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  onTouchMoveToDraw = (event: TouchEvent) => {\n    if (event.targetTouches.length !== 1 || event.changedTouches.length !== 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        p1: null,\n        p2: null,\n      }));\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(\n        Math.abs(event.targetTouches[0].pageX - this.startX),\n        Math.abs(event.targetTouches[0].pageY - this.startY),\n      ) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p2: [x, y],\n    }));\n  };\n\n  onTouchEndToEndDraw = (event: TouchEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    if (this.state.p1 && this.state.p2) {\n      this.props.onAdd([this.state.p1, this.state.p2], event);\n    }\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: null,\n      p2: null,\n    }));\n  };\n\n  onKeyDownToCancelTouchDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelTouchDraw();\n    }\n  };\n\n  cancelTouchDraw = () => {\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: null,\n      p2: null,\n    }));\n  };\n\n  // ---------------------------------------------\n  // mouse draw events\n  // ---------------------------------------------\n  onMouseDownToStartDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.pageX;\n    this.startY = event.pageY;\n\n    this.deactivateInitialEvents();\n    this.activateMouseDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: [x, y],\n    }));\n  };\n\n  activateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.addEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.addEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  deactivateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.removeEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.removeEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  onMouseMoveToDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData를 찾을 수 없다!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(Math.abs(event.pageX - this.startX), Math.abs(event.pageY - this.startY)) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p2: [x, y],\n    }));\n  };\n\n  onMouseUpToEndDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    if (this.state.p1 && this.state.p2) {\n      this.props.onAdd([this.state.p1, this.state.p2], event);\n    }\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: null,\n      p2: null,\n    }));\n  };\n\n  onMouseLeaveToCancelDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.cancelMouseDraw();\n  };\n\n  onKeyDownToCancelMouseDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelMouseDraw();\n    }\n  };\n\n  cancelMouseDraw = () => {\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      p1: null,\n      p2: null,\n    }));\n  };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const CircleDrawer: new <T extends Contour>() => CircleDrawerBase<T> = styled(CircleDrawerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  --color: rgb(255, 224, 0);\n  --stroke-width: 4px;\n  --fill-color: rgba(255, 224, 0, 0.2);\n\n  > circle:first-child {\n    stroke: var(--contour-drawer-color, var(--color));\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: var(--contour-drawer-fill-color, var(--fill-color));\n  }\n\n  > circle[data-highlight] {\n    stroke: #ffffff;\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: transparent;\n    ${dashStroke}\n  }\n\n  > line {\n    stroke: var(--contour-drawer-color, var(--color));\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n  }\n` as any;\n\n/**\n * @deprecated use CircleDrawer instead\n */\nexport const UserCircleDrawer = CircleDrawer;\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { FrameConsumer } from '../context/frame';\nimport { hitTestCircles } from '../geom/hitTestCircles';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\n\nexport interface CircleHoverProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /**\n   * Hover 기능 활성화 여부\n   * HTMLElement로 입력할 경우 MouseEvent를 해당 HTMLElement를 사용해서 처리한다\n   */\n  hover: boolean | HTMLElement | null;\n\n  /**\n   * 특정 Contour에 Mouse Over 되었을 때\n   * focusedContour를 결정하는데 필요하다\n   */\n  onFocus: (contour: T | null) => void;\n\n  className?: string;\n}\n\ninterface CircleHoverState {\n  p1: Point | null;\n  p2: Point | null;\n}\n\nexport class CircleHoverBase<T extends Contour> extends Component<CircleHoverProps<T>, CircleHoverState> {\n  private svg: SVGSVGElement | null = null;\n  private element: HTMLElement | null = null;\n  private focused: T | null = null;\n\n  private contentWindow: Window = window;\n\n  constructor(props: CircleHoverProps<T>) {\n    super(props);\n\n    this.state = {\n      p1: null,\n      p2: null,\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <svg\n          ref={this.svgRef}\n          role=\"figure\"\n          width={this.props.width}\n          height={this.props.height}\n          className={this.props.className}\n        ></svg>\n      </>\n    );\n  }\n\n  svgRef = (svg: SVGSVGElement) => {\n    if (svg && this.svg && this.element) {\n      this.deactivateInitialEvents();\n\n      if (this.canActivate(this.props)) {\n        this.svg = svg;\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n\n    this.svg = svg;\n  };\n\n  componentDidMount() {\n    if (!this.svg) throw new Error('<svg> is not initialized');\n\n    if (this.canActivate(this.props)) {\n      this.element = this.getElement(this.props);\n      this.activateInitialEvents();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<CircleHoverProps<T>>) {\n    if (prevProps.hover !== this.props.hover) {\n      if (this.element) this.deactivateInitialEvents();\n\n      if (this.canActivate(this.props)) {\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.element) this.deactivateInitialEvents();\n  }\n\n  getElement = ({ hover }: Readonly<CircleHoverProps<T>>): HTMLElement => {\n    //@ts-ignore\n    return hover instanceof this.contentWindow['HTMLElement'] ? (hover as HTMLElement) : (this.svg as HTMLElement);\n  };\n\n  canActivate = ({ hover }: Readonly<CircleHoverProps<T>>) => {\n    return hover instanceof this.contentWindow['HTMLElement'] || hover === true;\n  };\n\n  // ---------------------------------------------\n  // initial events\n  // ---------------------------------------------\n  activateInitialEvents = () => {\n    if (this.element) this.element.addEventListener('mousemove', this.onMouseMoveToFindFocus);\n  };\n\n  deactivateInitialEvents = () => {\n    if (this.element) this.element.removeEventListener('mousemove', this.onMouseMoveToFindFocus);\n  };\n\n  onMouseMoveToFindFocus = (event: MouseEvent) => {\n    this.findFocus(event.pageX, event.pageY);\n  };\n\n  findFocus = (pageX: number, pageY: number) => {\n    if (!this.props.contours || this.props.contours.length === 0 || !this.props.cornerstoneRenderData) return;\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, pageX, pageY);\n\n    this.focused = hitTestCircles(this.props.contours, [x, y]);\n\n    this.props.onFocus(this.focused);\n  };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const CircleHover: new <T extends Contour>() => CircleHoverBase<T> = styled(CircleHoverBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n` as any;\n","import React, { useEffect, useRef } from 'react';\nimport { CornerstoneImage } from '../image/types';\n\nexport interface DCMImageProps {\n  cornerstoneImage: CornerstoneImage;\n  width: number;\n  height: number;\n}\n\nexport function DCMImage({ cornerstoneImage, width, height }: DCMImageProps) {\n  const element = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const subscription = cornerstoneImage.image.subscribe(image => {\n      if (!element.current) return;\n\n      cornerstone.disable(element.current);\n      cornerstone.enable(element.current);\n\n      if (image) {\n        const defaultViewport = cornerstone.getDefaultViewportForImage(element.current, image);\n        cornerstone.displayImage(element.current, image, defaultViewport);\n      }\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [cornerstoneImage]);\n\n  return (\n    <div\n      ref={element}\n      style={{\n        width,\n        height,\n      }}\n    />\n  );\n}\n","import React from 'react';\nimport styled from 'styled-components';\n\nexport interface ThumbnailImageProps {\n  width: number;\n  height: number;\n  src: string;\n}\n\nexport function ThumbnailImage({ width, height, src }: ThumbnailImageProps) {\n  return (\n    <Thumbnail\n      style={{\n        width,\n        height,\n        backgroundImage: `url(${src})`,\n      }}\n    />\n  );\n}\n\nconst Thumbnail = styled.div`\n  display: inline-block;\n  background-color: #000000;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center center;\n`;\n","import { CornerstoneViewerInteractions, useViewerInteractions } from '@lunit/insight-viewer';\nimport { Control } from '@lunit/use-opt-control';\nimport { Box, Button, FormControlLabel, Radio, RadioGroup, Slider, Switch, Typography } from '@material-ui/core';\nimport React, { Fragment, ReactNode, useMemo, useState } from 'react';\nimport styled from 'styled-components';\n\nexport type Wheel = 'none' | 'zoom' | 'scroll';\n\nexport interface InsightViewerControllerOptions {\n  width: [number, number, number] | number;\n  height: [number, number, number] | number;\n  control: [Control, Control[]] | Control;\n  wheel: [Wheel, Wheel[]] | Wheel;\n  invert: [boolean] | boolean;\n  flip: [boolean] | boolean;\n}\n\nexport interface InsightViewerControllerProps {\n  children: (controllerState: InsightViewerControllerState) => ReactNode;\n  options: InsightViewerControllerOptions;\n}\n\nexport interface InsightViewerControllerState {\n  options: InsightViewerControllerOptions;\n\n  width: number;\n  height: number;\n  control: Control;\n  wheel: Wheel;\n  invert: boolean;\n  flip: boolean;\n  resetTime: number;\n\n  element: HTMLElement | null;\n  setElement: <E extends HTMLElement>(element: E | null) => void;\n  interactions: CornerstoneViewerInteractions;\n\n  updateWidth: (value: number) => void;\n  updateHeight: (value: number) => void;\n  updateControl: (value: Control) => void;\n  updateWheel: (value: Wheel) => void;\n  updateInvert: (value: boolean) => void;\n  updateFlip: (value: boolean) => void;\n  updateResetTime: (value: number) => void;\n}\n\nexport function InsightViewerTestController({ children, options }: InsightViewerControllerProps) {\n  const [width, setWidth] = useState<number>(() => (Array.isArray(options.width) ? options.width[0] : options.width));\n  const [height, setHeight] = useState<number>(() =>\n    Array.isArray(options.height) ? options.height[0] : options.height,\n  );\n  const [control, setControl] = useState<Control>(() =>\n    Array.isArray(options.control) ? options.control[0] : options.control,\n  );\n  const [wheel, setWheel] = useState<Wheel>(() => (Array.isArray(options.wheel) ? options.wheel[0] : options.wheel));\n  const [invert, setInvert] = useState(() => (Array.isArray(options.invert) ? options.invert[0] : options.invert));\n  const [flip, setFlip] = useState(() => (Array.isArray(options.flip) ? options.flip[0] : options.flip));\n  const [resetTime, setResetTime] = useState(Date.now());\n\n  const [element, setElement] = useState<HTMLElement | null>(null);\n  const interactions = useViewerInteractions([control, wheel], { element });\n\n  const state: InsightViewerControllerState = useMemo<InsightViewerControllerState>(\n    () => ({\n      options,\n      width,\n      height,\n      control,\n      wheel,\n      invert,\n      flip,\n      resetTime,\n      updateWidth: setWidth,\n      updateHeight: setHeight,\n      updateControl: setControl,\n      updateWheel: setWheel,\n      updateInvert: setInvert,\n      updateFlip: setFlip,\n      updateResetTime: setResetTime,\n\n      element,\n      setElement,\n      interactions,\n    }),\n    [options, width, height, control, wheel, invert, flip, resetTime, element, interactions],\n  );\n\n  return (\n    <Fragment>\n      {children(state)}\n      <Controller {...state} />\n    </Fragment>\n  );\n}\n\nfunction Controller({\n  options,\n  width,\n  height,\n  control,\n  wheel,\n  invert,\n  flip,\n  resetTime,\n  updateWidth,\n  updateHeight,\n  updateControl,\n  updateWheel,\n  updateInvert,\n  updateFlip,\n  updateResetTime,\n}: InsightViewerControllerState) {\n  return (\n    <FloatingBox>\n      {Array.isArray(options.width) && (\n        <>\n          <Typography gutterBottom>Width</Typography>\n          <Slider\n            color=\"primary\"\n            value={width}\n            min={options.width[1]}\n            max={options.width[2]}\n            onChange={(event, nextValue) => updateWidth(nextValue as number)}\n          />\n        </>\n      )}\n\n      {Array.isArray(options.height) && (\n        <>\n          <Typography gutterBottom>Height</Typography>\n          <Slider\n            color=\"primary\"\n            value={height}\n            min={options.height[1]}\n            max={options.height[2]}\n            onChange={(event, nextValue) => updateHeight(nextValue as number)}\n          />\n        </>\n      )}\n\n      {Array.isArray(options.control) && (\n        <>\n          <Typography gutterBottom>Control</Typography>\n          <RadioGroup value={control} onChange={(event, nextValue) => updateControl(nextValue as Control)}>\n            {options.control[1].map((value) => (\n              <FormControlLabel\n                color=\"primary\"\n                key={value}\n                value={value}\n                control={<Radio color=\"primary\" />}\n                label={value.toUpperCase()}\n              />\n            ))}\n          </RadioGroup>\n        </>\n      )}\n\n      {Array.isArray(options.wheel) && (\n        <>\n          <Typography gutterBottom>Wheel</Typography>\n          <RadioGroup value={wheel} onChange={(event, nextValue) => updateWheel(nextValue as Wheel)}>\n            {options.wheel[1].map((value) => (\n              <FormControlLabel\n                color=\"primary\"\n                key={value}\n                value={value}\n                control={<Radio color=\"primary\" />}\n                label={value.toUpperCase()}\n              />\n            ))}\n          </RadioGroup>\n        </>\n      )}\n\n      {Array.isArray(options.invert) && (\n        <>\n          <Typography gutterBottom>Invert</Typography>\n          <Switch checked={invert} color=\"primary\" onChange={(event, nextValue) => updateInvert(nextValue)} />\n        </>\n      )}\n\n      {Array.isArray(options.flip) && (\n        <>\n          <Typography gutterBottom>Flip</Typography>\n          <Switch checked={flip} color=\"primary\" onChange={(event, nextValue) => updateFlip(nextValue)} />\n        </>\n      )}\n\n      <Typography gutterBottom>Reset</Typography>\n      <Button variant=\"contained\" color=\"primary\" onClick={() => updateResetTime(Date.now())}>\n        Reset\n      </Button>\n    </FloatingBox>\n  );\n}\n\nconst FloatingBox = styled(Box)`\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  width: 200px;\n`;\n","import React, { cloneElement, ReactElement, SVGProps, useLayoutEffect, useMemo, useRef, useState } from 'react';\n\nexport interface StrokeTextProps {\n  fontFamily?: string;\n  fontSize?: number;\n  strokeWidth?: number;\n  strokeColor?: string;\n  children: ReactElement<SVGProps<SVGTextElement>>;\n}\n\nexport function StrokeText({\n  fontFamily = 'proximanova,noto_sanslight,sans-serif',\n  fontSize = 12,\n  strokeWidth = 6,\n  strokeColor = '#000000',\n  children,\n}: StrokeTextProps) {\n  const [width, setWidth] = useState<number>(100);\n  const height = useMemo<number>(() => fontSize + strokeWidth * 2, [fontSize, strokeWidth]);\n  const textRef = useRef<SVGTextElement>(null);\n\n  const text = useMemo(() => {\n    return (\n      <>\n        {cloneElement(children, {\n          ref: textRef,\n          x: strokeWidth,\n          y: strokeWidth,\n          stroke: strokeColor,\n          strokeWidth,\n          strokeLinejoin: 'round',\n          strokeLinecap: 'round',\n          dominantBaseline: 'mathematical',\n          fontFamily,\n        })}\n        {cloneElement(children, {\n          x: strokeWidth,\n          y: strokeWidth,\n          dominantBaseline: 'mathematical',\n          fontFamily,\n        })}\n      </>\n    );\n  }, [children, fontFamily, strokeColor, strokeWidth]);\n\n  useLayoutEffect(() => {\n    const rect = textRef.current?.getBoundingClientRect();\n    if (!rect) return;\n    setWidth(rect.width + strokeWidth * 2);\n  }, [strokeWidth, text]);\n\n  return (\n    <svg width={width} height={height} style={{ pointerEvents: 'none', userSelect: 'none', fontSize }}>\n      {text}\n    </svg>\n  );\n}\n","import React, { Component } from 'react';\nimport { Unsubscribable } from 'rxjs';\nimport { FrameConsumer } from '../context/frame';\nimport { InsightViewerHostProps } from '../hooks/useInsightViewerSync';\nimport { CornerstoneImage } from '../image/types';\nimport {\n  CornerstoneRenderData,\n  CornerstoneViewerLike,\n  Interaction,\n  ViewportTransform,\n  ViewportTransformParams,\n} from '../types';\n\nexport type CornerstoneViewerInteractions = (Interaction | false | null | undefined)[];\n\nexport interface CornerstoneViewerProps extends InsightViewerHostProps {\n  width: number;\n  height: number;\n\n  image: CornerstoneImage;\n\n  interactions?: CornerstoneViewerInteractions;\n\n  /** Invert Color Image */\n  invert: boolean;\n\n  /** Flip Image */\n  flip: boolean;\n\n  /**\n   * Date.now() 로 입력하면 된다.\n   * 값이 변경되는 경우 Pan, Adjust, Zoom 으로 변경된 상태들이 초기화 된다.\n   */\n  resetTime: number;\n\n  /**\n   * Image가 최초 그려지는 순간 변경한다\n   */\n  defaultViewportTransforms?: ViewportTransform[];\n}\n\nconst maxScale: number = 3;\n\nexport class CornerstoneViewer extends Component<CornerstoneViewerProps, {}> implements CornerstoneViewerLike {\n  // ref={}에 의해서 componentDidMount() 이전에 반드시 들어온다\n  private element!: HTMLDivElement;\n\n  // imageLoaded 이후 지연되어 들어오게 된다\n  // setViewport, updateViewport 에 의해서만 접근한다\n  private currentViewport: cornerstone.Viewport | null = null;\n  // props.image.subscribe()를 통해서 지연되어 들어오게 된다\n  private currentImage: cornerstone.Image | null = null;\n\n  // mouse interaction에서 사용한다\n  private teardownInteraction: (() => void)[] | null = null;\n\n  // rx subscriptions\n  private imageSubscription: Unsubscribable | null = null;\n\n  private needImageInitialize: boolean = true;\n\n  private contentWindow: Window = window;\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <div\n          ref={this.elementRef}\n          style={{\n            width: this.props.width,\n            height: this.props.height,\n          }}\n        />\n      </>\n    );\n  }\n\n  // ---------------------------------------------\n  // life cycle\n  // ---------------------------------------------\n  elementRef = (element: HTMLDivElement) => {\n    this.element = element;\n\n    if (!element) return;\n\n    this.startInteraction(this.props.interactions);\n  };\n\n  componentDidMount() {\n    // cornerstone의 imagernderered event를 받는다\n    // image가 render 될때마다 context로 enabledElement를 배포해주기 위해 필요하다\n    this.element.addEventListener(cornerstone.EVENTS.IMAGE_RENDERED, this.onImageRenderered);\n\n    this.setCornerstoneImage(this.props.image);\n  }\n\n  initImage = (image: cornerstone.Image) => {\n    cornerstone.disable(this.element);\n    cornerstone.enable(this.element, { renderer: 'webgl' });\n\n    let defaultViewport = this.getDefaultViewport(image, this.element);\n\n    if (!defaultViewport) {\n      throw new Error('defaultViewport는 null일 수 없다.');\n    }\n\n    if (Array.isArray(this.props.defaultViewportTransforms)) {\n      const minScale: number = defaultViewport.scale;\n\n      for (const transform of this.props.defaultViewportTransforms) {\n        const patch = transform({\n          element: this.element,\n          currentViewport: defaultViewport,\n          minScale,\n          maxScale,\n        });\n\n        defaultViewport = {\n          ...defaultViewport,\n          ...patch,\n        };\n      }\n    }\n\n    defaultViewport = {\n      ...defaultViewport,\n      hflip: this.props.flip,\n      invert: this.props.invert,\n    };\n\n    cornerstone.displayImage(this.element, image, defaultViewport);\n\n    this.setImage(image);\n    this.setViewport(defaultViewport);\n    this.startInteraction(this.props.interactions);\n  };\n\n  componentWillUnmount() {\n    this.element.removeEventListener(cornerstone.EVENTS.IMAGE_RENDERED, this.onImageRenderered);\n    cornerstone.disable(this.element);\n\n    if (this.imageSubscription) {\n      this.imageSubscription.unsubscribe();\n    }\n\n    if (this.teardownInteraction) {\n      this.teardownInteraction.forEach((teardown) => teardown());\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<CornerstoneViewerProps>) {\n    const { width, height, flip, invert, interactions, resetTime, image } = this.props;\n\n    const defaultViewport: cornerstone.Viewport | null = this.getDefaultViewport(this.currentImage, this.element);\n\n    // 선택된 control 상태에 따라 event를 해제/등록 해준다\n    if (prevProps.interactions !== interactions) {\n      this.startInteraction(interactions);\n    }\n\n    if (defaultViewport) {\n      if (prevProps.resetTime !== resetTime) {\n        // resetTime이 새로 갱신되면 viewport를 defaultViewport를 사용해서 초기화 해준다\n        this.updateCurrentViewport({\n          ...defaultViewport,\n          //...this.defaultViewport,\n          hflip: flip,\n          invert: defaultViewport.invert ? !invert : invert,\n        });\n      } else {\n        // flip, invert는 resetTime의 부분 집합이기 때문에\n        // resetTime에 의한 갱신이 없는 경우에만 적용한다\n        if (prevProps.flip !== flip || prevProps.invert !== invert) {\n          this.updateCurrentViewport({\n            hflip: flip,\n            invert: defaultViewport.invert ? !invert : invert,\n          });\n        }\n      }\n    }\n\n    if (prevProps.width !== width || prevProps.height !== height) {\n      if (this.currentImage) {\n        // container size가 변경되는 경우 cornerstone resize() 처리를 해준다\n        cornerstone.resize(this.element);\n\n        const viewport = cornerstone.getViewport(this.element);\n\n        if (viewport) {\n          this.setViewport(viewport);\n        } else {\n          throw new Error('getViewport() is returns not a Viewport');\n        }\n      }\n    }\n\n    if (prevProps.image !== image) {\n      this.setCornerstoneImage(image);\n    }\n  }\n\n  subscribeImage = (image: cornerstone.Image | null) => {\n    if (!image) return;\n\n    image.voiLUT = undefined; // remove VOI LUT for 'adjust' functionality\n\n    // props.image의 변경 또는 초기화로 인한 완전한 초기화가 필요할때\n    if (this.needImageInitialize) {\n      this.needImageInitialize = false;\n      this.initImage(image);\n    }\n    // 단순 series image의 변경일 경우에는 화면 표시만 바꿔준다\n    else if (this.currentViewport) {\n      cornerstone.displayImage(this.element, image, this.currentViewport);\n    }\n    // 이건 실행되면 안됨\n    else {\n      throw new Error('어떤 상황인지 확인 필요!!!');\n    }\n  };\n\n  onImageRenderered = (event: cornerstone.CornerstoneEvent) => {\n    const eventData: cornerstone.CornerstoneEventData | undefined = event.detail;\n    if (\n      eventData &&\n      eventData.canvasContext &&\n      eventData.element &&\n      eventData.enabledElement &&\n      eventData.image &&\n      typeof eventData.renderTimeInMs === 'number' &&\n      eventData.viewport\n    ) {\n      this.currentViewport = eventData.viewport;\n      this.props.updateCornerstoneRenderData(eventData as CornerstoneRenderData);\n    } else {\n      console.error('CornerstoneEventData에 없는 정보가 있다???', eventData);\n    }\n  };\n\n  // ---------------------------------------------\n  // event handlers\n  // ---------------------------------------------\n  startInteraction = (interactions: CornerstoneViewerInteractions | undefined) => {\n    if (this.teardownInteraction) {\n      this.teardownInteraction.forEach((teardown) => teardown());\n    }\n\n    if (Array.isArray(interactions) && interactions.length > 0) {\n      this.teardownInteraction = interactions\n        .filter((interaction): interaction is Interaction => typeof interaction === 'function')\n        .map((interaction) => interaction(this));\n    }\n  };\n\n  // ---------------------------------------------\n  // getters\n  // ---------------------------------------------\n  getElement = () => this.element;\n\n  getContentWindow = () => this.contentWindow;\n\n  getCurrentViewport = () => this.currentViewport!;\n\n  getDefaultViewport = (image: cornerstone.Image | null, element: HTMLElement | null): cornerstone.Viewport | null => {\n    if (!image || !element) return null;\n    return cornerstone.getDefaultViewportForImage(element, image);\n  };\n\n  getMinScale = () => {\n    const viewport = this.getDefaultViewport(this.currentImage, this.element);\n\n    if (!viewport) {\n      throw new Error('viewport가 정상적으로 와야만 한다');\n    }\n\n    return viewport.scale;\n  };\n\n  getMaxScale = () => {\n    return maxScale;\n  };\n\n  // ---------------------------------------------\n  // setters\n  // ---------------------------------------------\n  updateViewport = (patch: Partial<cornerstone.Viewport>) => {\n    if (this.currentViewport) {\n      this.updateCurrentViewport(patch);\n    }\n  };\n\n  getViewportTransformParams = (): ViewportTransformParams => {\n    return {\n      element: this.element,\n      minScale: this.getMinScale(),\n      maxScale: this.getMaxScale(),\n      currentViewport: this.currentViewport,\n    };\n  };\n\n  private setCornerstoneImage = (image: CornerstoneImage) => {\n    this.needImageInitialize = true;\n\n    this.setImage(null);\n\n    if (this.imageSubscription) {\n      this.imageSubscription.unsubscribe();\n      this.imageSubscription = null;\n    }\n\n    this.imageSubscription = image.image.subscribe(this.subscribeImage);\n  };\n\n  private setImage = (image: cornerstone.Image | null) => {\n    this.currentImage = image;\n  };\n\n  private setViewport = (viewport: cornerstone.Viewport) => {\n    this.currentViewport = viewport;\n    cornerstone.setViewport(this.element, this.currentViewport);\n  };\n\n  private updateCurrentViewport = (\n    update: Partial<cornerstone.Viewport> | ((viewport: cornerstone.Viewport) => Partial<cornerstone.Viewport>),\n  ) => {\n    if (!this.currentViewport) {\n      throw new Error('viewport가 없는 상태에서 실행되면 안된다');\n    }\n\n    const patch: Partial<cornerstone.Viewport> = typeof update === 'function' ? update(this.currentViewport) : update;\n\n    this.currentViewport = {\n      ...this.currentViewport,\n      ...patch,\n    };\n\n    cornerstone.setViewport(this.element, this.currentViewport);\n  };\n}\n","import styled from 'styled-components';\nimport { Contour } from '../types';\nimport { dashStroke } from './animation/dashStroke';\nimport { ContourDrawerBase } from './ContourDrawer';\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const LineDrawer: new <T extends Contour>() => ContourDrawerBase<T> = styled(ContourDrawerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  --color: rgb(255, 224, 0);\n  --stroke-width: 4px;\n\n  > polyline:first-child {\n    stroke: var(--contour-drawer-color, var(--color));\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: transparent;\n  }\n\n  > polyline[data-highlight] {\n    stroke: #ffffff;\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: transparent;\n    ${dashStroke}\n  }\n` as any;\n","import polylabel from 'polylabel';\nimport React, { Component, createRef, CSSProperties, Fragment, RefObject } from 'react';\nimport styled from 'styled-components';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\n\nexport interface LineViewerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /** Mouse Over 등 User Interaction에 의해서 Focus 된 Contour */\n  focusedContour: T | null;\n\n  /** <svg className={}> */\n  className?: string;\n\n  /** <svg style={}> */\n  style?: CSSProperties;\n\n  /**\n   * Line에 외곽을 그려준다\n   * Line을 두 개 그려서 border를 표현하기 때문에,성능에 민감한 상황인 경우 비활성 시킬 수 있다.\n   */\n  border?: boolean;\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): Point[] {\n  return polygon.map(([x, y]) => {\n    const p = cornerstone.pixelToCanvas(element, { x, y });\n    return [p.x, p.y];\n  });\n}\n\nexport class LineViewerBase<T extends Contour> extends Component<LineViewerProps<T>, {}> {\n  static defaultProps: Pick<LineViewerProps<Contour>, 'border'> = {\n    border: true,\n  };\n\n  private svgRef: RefObject<SVGSVGElement> = createRef();\n\n  render() {\n    const { cornerstoneRenderData, contours, focusedContour } = this.props;\n\n    return (\n      <svg\n        ref={this.svgRef}\n        className={this.props.className}\n        style={this.props.style}\n        width={this.props.width}\n        height={this.props.height}\n      >\n        {contours.length > 0 &&\n          cornerstoneRenderData &&\n          cornerstoneRenderData.element &&\n          contours.map((contour) => {\n            const polygon: number[][] = toLocal(cornerstoneRenderData.element, contour.polygon);\n            const labelCenter: number[] = polylabel([polygon], 1);\n            const focused: boolean = contour === focusedContour;\n            const dataAttrs: { [attr: string]: string } = contour.dataAttrs || {};\n\n            return (\n              <Fragment key={'polygon' + contour.id}>\n                {this.props.border === true && (\n                  <polyline\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                  />\n                )}\n                <polyline\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                />\n                {this.props.border === true && (\n                  <text\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                    x={labelCenter[0]}\n                    y={labelCenter[1]}\n                  >\n                    {contour.label\n                      ? typeof contour.label === 'function'\n                        ? contour.label(contour)\n                        : contour.label\n                      : contour.id}\n                  </text>\n                )}\n                <text\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  fontSize={14 * Math.max(1, cornerstoneRenderData.viewport.scale)}\n                  x={labelCenter[0]}\n                  y={labelCenter[1]}\n                >\n                  {contour.label\n                    ? typeof contour.label === 'function'\n                      ? contour.label(contour)\n                      : contour.label\n                    : contour.id}\n                </text>\n              </Fragment>\n            );\n          })}\n      </svg>\n    );\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const LineViewer: new <T extends Contour>() => LineViewerBase<T> = styled(LineViewerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  user-select: none;\n\n  --color: #ffffff;\n  --focused-color: rgb(255, 194, 17);\n  --stroke-width: 3px;\n  --focused-stroke-width: 6px;\n\n  > polyline {\n    stroke-width: var(--contour-viewer-stroke-width, var(--stroke-width));\n    stroke: var(--contour-viewer-color, var(--color));\n    transition: stroke 120ms ease-out, stroke-width 120ms ease-out;\n    fill: transparent;\n\n    &[data-focused] {\n      stroke-width: var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width));\n      stroke: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: calc(var(--contour-viewer-stroke-width, var(--stroke-width)) + 2px);\n      stroke: #000000;\n\n      &[data-focused] {\n        stroke-width: calc(var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width)) + 2px);\n        stroke: #000000;\n      }\n    }\n  }\n\n  > text {\n    fill: var(--contour-viewer-color, var(--color));\n    font-family: proximanova, noto_sans, sans-serif;\n    font-weight: 600;\n    text-anchor: middle;\n    dominant-baseline: central;\n    transition: fill 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      fill: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: 4px;\n      stroke: #000000;\n      fill: transparent;\n    }\n  }\n` as any;\n","import { useMemo } from 'react';\nimport { adjust } from './adjust';\nimport { pan } from './pan';\nimport { zoom } from './zoom';\n\nexport function useViewerInteractions(\n  interactions: ('pan' | 'adjust' | 'zoom' | string)[],\n  { element }: { element?: HTMLElement | null } = {},\n) {\n  return useMemo(\n    () => {\n      return interactions.map((interactionName) => {\n        switch (interactionName) {\n          case 'pan':\n            return pan({ element });\n          case 'adjust':\n            return adjust({ element });\n          case 'zoom':\n            return zoom({ element });\n          default:\n            return undefined;\n        }\n      });\n    },\n    //eslint-disable-next-line react-hooks/exhaustive-deps\n    [element, ...interactions],\n  );\n}\n","import { CornerstoneSequenceImage } from '@lunit/insight-viewer';\nimport { useEffect, useState } from 'react';\n\ninterface SeriesImagePosition {\n  /** 현재 Image 위치 */\n  current: number;\n\n  /** 총 Image 갯수 */\n  end: number;\n}\n\nexport function useSeriesImagePosition(image: CornerstoneSequenceImage): SeriesImagePosition {\n  const [result, setResult] = useState<{ current: number; end: number }>(() => ({\n    current: image.getIndex(),\n    end: image.length() - 1,\n  }));\n\n  useEffect(() => {\n    const subscription = image.index.subscribe((current: number) => {\n      setResult(prevResult => {\n        return {\n          ...prevResult,\n          current,\n          end: image.length() - 1,\n        };\n      });\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [image]);\n\n  return result;\n}\n\n/** @deprecated use useSeriesImagePosition() */\nexport const useBulkImagePosition = useSeriesImagePosition;\n","import { CornerstoneSequenceImage } from '@lunit/insight-viewer';\nimport { isTouchDevice } from '@lunit/is-touch-device';\nimport { useEffect } from 'react';\n\ninterface SeriesImageScrollParams {\n  image: CornerstoneSequenceImage;\n\n  /** Wheel Event를 처리할 EventTarget */\n  element: HTMLElement | null;\n\n  /** User Interaction 활성화 여부 */\n  enabled?: boolean;\n\n  /** Touch Direction */\n  touchDirection?: 'horizontal' | 'vertical';\n}\n\nexport function useSeriesImageScroll({\n  image,\n  element,\n  enabled = true,\n  touchDirection = 'vertical',\n}: SeriesImageScrollParams) {\n  useEffect(() => {\n    if (!element || enabled !== true) {\n      return () => {};\n    }\n\n    // ---------------------------------------------\n    // wheel handler\n    // ---------------------------------------------\n    function wheel(event: WheelEvent) {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      if (event.deltaY > 0) {\n        image.prev();\n      } else if (event.deltaY < 0) {\n        image.next();\n      }\n    }\n\n    // ---------------------------------------------\n    // touch handler\n    // ---------------------------------------------\n    let startIndex: number = -1;\n    let startPoint: { x: number; y: number } | null = null;\n\n    function touchStart(event: TouchEvent) {\n      if (event.targetTouches.length !== 2) return;\n\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n\n      startIndex = image.getIndex();\n\n      startPoint = {\n        x: event.targetTouches[0].pageX,\n        y: event.targetTouches[0].pageY,\n      };\n\n      if (!element) {\n        throw new Error(`undefined element!!!`);\n      }\n\n      element.removeEventListener('touchstart', touchStart);\n\n      element.addEventListener('touchmove', touchMove);\n      element.addEventListener('touchend', touchEnd);\n      element.addEventListener('touchcancel', touchEnd);\n    }\n\n    function touchMove(event: TouchEvent) {\n      if (event.targetTouches.length !== 2 || event.changedTouches.length !== 2 || !startPoint) return;\n\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n\n      const dx: number = event.targetTouches[0].pageX - startPoint.x;\n      const dy: number = event.targetTouches[0].pageY - startPoint.y;\n      const d: number = touchDirection === 'vertical' ? dy : dx;\n\n      image.goto(startIndex + Math.floor(d / 10));\n    }\n\n    function touchEnd(event: TouchEvent) {\n      if (!element) {\n        throw new Error(`undefined element!!!`);\n      }\n\n      element.removeEventListener('touchmove', touchMove);\n      element.removeEventListener('touchend', touchEnd);\n      element.removeEventListener('touchcancel', touchEnd);\n\n      element.addEventListener('touchstart', touchStart);\n    }\n\n    // ---------------------------------------------\n    // start\n    // ---------------------------------------------\n    element.addEventListener('wheel', wheel);\n\n    if (isTouchDevice()) {\n      element.addEventListener('touchstart', touchStart);\n    }\n\n    // ---------------------------------------------\n    // end\n    // ---------------------------------------------\n    return () => {\n      element.removeEventListener('wheel', wheel);\n\n      element.removeEventListener('touchstart', touchStart);\n\n      element.removeEventListener('touchmove', touchMove);\n      element.removeEventListener('touchend', touchEnd);\n      element.removeEventListener('touchcancel', touchEnd);\n    };\n  }, [image, element, enabled, touchDirection]);\n}\n\n/** @deprecated use useSeriesImageScroll */\nexport const useBulkImageScroll = useSeriesImageScroll;\n","import { useState } from 'react';\nimport { CornerstoneRenderData } from '../types';\n\nexport interface InsightViewerHostProps {\n  updateCornerstoneRenderData: (renderData: CornerstoneRenderData) => void;\n}\n\nexport interface InsightViewerGuestProps {\n  cornerstoneRenderData: CornerstoneRenderData | null;\n}\n\ninterface InsightViewerSyncProps {\n  cornerstoneRenderData: CornerstoneRenderData | null;\n  updateCornerstoneRenderData: (eventData: CornerstoneRenderData) => void;\n}\n\nexport function useInsightViewerSync(): InsightViewerSyncProps {\n  const [cornerstoneRenderData, setCornerstoneRenderData] = useState<CornerstoneRenderData | null>(null);\n\n  return {\n    cornerstoneRenderData,\n    updateCornerstoneRenderData: setCornerstoneRenderData,\n  };\n}\n","import { RefObject, useCallback, useMemo } from 'react';\nimport { InsightViewer } from '../components/InsightViewer';\nimport { CornerstoneRenderData, CornerstoneViewerLike } from '../types';\n\ninterface ViewportMirroring {\n  /** <CornerstoneViewer updateCornerstoneRenderData={}> 에 사용한다 */\n  updateMasterRenderData: (renderData: CornerstoneRenderData) => void;\n}\n\n/**\n * 여러개의 <CornerstoneViewer>를 동기화 시키기 위해 사용된다\n */\nexport function useViewportMirroring(\n  ...destinations: (\n    | InsightViewer\n    | RefObject<InsightViewer>\n    | CornerstoneViewerLike\n    | RefObject<CornerstoneViewerLike>\n  )[]\n): ViewportMirroring {\n  const updateMasterRenderData = useCallback(\n    ({ viewport }: CornerstoneRenderData) => {\n      const { hflip, vfilip, translation, scale } = viewport;\n\n      for (const dest of destinations) {\n        if ('updateViewport' in dest) {\n          dest.updateViewport({\n            hflip,\n            vfilip,\n            translation,\n            scale,\n          });\n        } else if ('current' in dest && dest.current) {\n          dest.current.updateViewport({\n            hflip,\n            vfilip,\n            translation,\n            scale,\n          });\n        }\n      }\n    },\n    //eslint-disable-next-line react-hooks/exhaustive-deps\n    [...destinations],\n  );\n\n  return useMemo<ViewportMirroring>(\n    () => ({\n      updateMasterRenderData,\n    }),\n    [updateMasterRenderData],\n  );\n}\n","import { useEffect, useState } from 'react';\nimport { combineLatest, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\n/**\n * Progress가 완료된 시간을 찾기 위해 사용된다.\n *\n * (A. Task 시작)\n * → User가 행동할 수 없는 Image Loading 시간\n * → (B. Image가 로딩되어 Task가 시작된 시간)\n * → Task 진행\n * → (C. Task 완료 시점)\n *\n * User가 Task를 진행한 시간을 좀 더 정확하게 계산하기 위해 사용된다.\n *\n * C - A = User가 행동할 수 없는 Image Loading 시간 때문에 부정확\n * B - A = C - A 보다 좀 더 User가 행동할 수 있는 시간을 기준으로 계산\n *\n * ```ts\n * const progress = useMemo(() => [image.progress], [image]);\n * const imageLoadedTime = useImageLoadedTime(progress);\n * ```\n *\n * 여기서 `imageLoadedTime`은 Image가 최종적으로 Load된 시간이다.\n */\nexport function useImageLoadedTime(progresses: Observable<number>[] | null): Date | null {\n  const [time, setTime] = useState<Date | null>(null);\n\n  useEffect(() => {\n    if (progresses) {\n      const subscription = combineLatest(progresses)\n        .pipe(map((numbers: number[]) => numbers.reduce((t, x) => t + x, 0) / numbers.length))\n        .subscribe(value => {\n          if (value >= 1) {\n            setTime(new Date());\n            subscription.unsubscribe();\n          }\n        });\n\n      return () => {\n        subscription.unsubscribe();\n      };\n    }\n  }, [progresses]);\n\n  return time;\n}\n","import React, {\n  Consumer,\n  Context,\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\nimport { CornerstoneSingleImage } from '../image/CornerstoneSingleImage';\nimport { CornerstoneImage } from '../image/types';\n\nexport interface ImageStoreProviderProps {\n  children: ReactNode;\n\n  /** 최대 Cache 갯수 - 높을수록 Memory에 영향을 미치게 된다. */\n  cacheImages?: number;\n\n  /** CornerstoneImage factory */\n  factory?: (imageId: string) => CornerstoneImage;\n}\n\nexport interface ImageStoreState {\n  /** CornerstoneImage를 Load 한다 */\n  fetch: (imageId: string) => CornerstoneImage;\n\n  /** Cache를 지운다 */\n  purge: (imageId: string) => void;\n}\n\n// @ts-ignore\nconst ImageStoreContext: Context<ImageStoreState> = createContext<ImageStoreState>();\n\nfunction defaultFactory(imageId: string): CornerstoneImage {\n  return new CornerstoneSingleImage(imageId);\n}\n\nexport function ImageStoreProvider({ cacheImages = 10, factory = defaultFactory, children }: ImageStoreProviderProps) {\n  const [cache] = useState<[string, CornerstoneImage][]>(() => []);\n\n  const fetch = useCallback(\n    (imageId: string) => {\n      let item = cache.find(([itemImageId]) => itemImageId === imageId);\n\n      if (!item) {\n        item = [imageId, factory(imageId)];\n        cache.push(item);\n\n        if (cache.length > cacheImages) {\n          const deleteCount: number = cache.length - cacheImages;\n          const deleteItems = cache.splice(0, deleteCount);\n\n          for (const deleteItem of deleteItems) {\n            deleteItem[1].destroy();\n          }\n        }\n      }\n\n      return item[1];\n    },\n    [cache, cacheImages, factory],\n  );\n\n  const purge = useCallback(\n    (imageId: string) => {\n      const index = cache.findIndex(([itemImageId]) => itemImageId === imageId);\n\n      if (index > -1) {\n        const deleteItems = cache.splice(index, 1);\n\n        for (const deleteItem of deleteItems) {\n          deleteItem[1].destroy();\n        }\n      }\n    },\n    [cache],\n  );\n\n  useEffect(() => {\n    return () => {\n      for (const deleteItem of cache) {\n        deleteItem[1].destroy();\n      }\n    };\n  }, [cache]);\n\n  return <ImageStoreContext.Provider value={{ fetch, purge }}>{children}</ImageStoreContext.Provider>;\n}\n\nexport function useImageStore(): ImageStoreState {\n  return useContext(ImageStoreContext);\n}\n\nexport const ImageStoreConsumer: Consumer<ImageStoreState> = ImageStoreContext.Consumer;\n","import { BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ParallelImageLoader } from './ParallelImageLoader';\nimport { CornerstoneSequenceImage, getProgressEventDetail, ImageLoader, ProgressEventDetail } from './types';\nimport { wadoImageLoaderXHRLoader } from './wadoImageLoaderXHRLoader';\n\nfunction isImage(image: cornerstone.Image | null): image is cornerstone.Image {\n  return image !== null;\n}\n\ninterface Options {\n  unload?: (imageIds: string[]) => void;\n  initialIndex?: number;\n  cancelTokenName?: string;\n  timeout?: number;\n  loader?: ImageLoader;\n}\n\nconst defaultLoader: ImageLoader = new ParallelImageLoader();\n\nexport class CornerstoneSeriesImage implements CornerstoneSequenceImage {\n  private readonly _images: (cornerstone.Image | null)[];\n  private readonly _imageSubject: BehaviorSubject<cornerstone.Image | null>;\n  private readonly _progressSubject: BehaviorSubject<number[]>;\n  private readonly _indexSubject: BehaviorSubject<number>;\n  private readonly _cancel: (() => void)[] = [];\n  private readonly _loader: ImageLoader;\n  private _destoyed: boolean = false;\n\n  constructor(private readonly imageIds: string[], private readonly options: Options = {}) {\n    this._images = imageIds.map(() => null);\n\n    const { initialIndex = 0 } = options;\n\n    this._imageSubject = new BehaviorSubject<cornerstone.Image | null>(null);\n    this._indexSubject = new BehaviorSubject<number>(initialIndex);\n    this._progressSubject = new BehaviorSubject(imageIds.map(() => 0));\n    this._loader = options.loader || defaultLoader;\n\n    cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onProgress);\n\n    this.loadImage(imageIds[initialIndex], initialIndex).then(() => {\n      // 최초 image를 next로 보내준다\n      this.change(this._indexSubject.getValue());\n\n      imageIds.forEach((imageId, i) => {\n        // initialDisplayIndex는 이미 로딩했으므로 pass한다\n        if (i !== initialIndex) {\n          this.loadImage(imageId, i).then(() => {\n            // 현재 시점의 displayIndex이면 (displayIndex의 교체 -> loadImage의 순서로 실행되었다면)\n            // next로 보내준다\n            if (i === this._indexSubject.getValue()) {\n              this.change(this._indexSubject.getValue());\n            }\n          });\n        }\n      });\n    });\n  }\n\n  get image(): Observable<cornerstone.Image | null> {\n    return this._imageSubject.asObservable();\n  }\n\n  get progress(): Observable<number> {\n    return this._progressSubject.pipe<number>(\n      map<number[], number>(progress => progress.reduce((t, x) => t + x, 0) / progress.length),\n    );\n  }\n\n  get index(): Observable<number> {\n    return this._indexSubject.asObservable();\n  }\n\n  onProgress = (event: Event) => {\n    const eventDetail: ProgressEventDetail | undefined = getProgressEventDetail(event);\n\n    if (eventDetail) {\n      const imageIndex: number = this.imageIds.indexOf(eventDetail.imageId);\n\n      if (imageIndex > -1) {\n        const nextProgress: number[] = [...this._progressSubject.getValue()];\n        nextProgress[imageIndex] = eventDetail.loaded / eventDetail.total;\n        this._progressSubject.next(nextProgress);\n      }\n    }\n  };\n\n  destroy = () => {\n    if (this.options && typeof this.options.unload === 'function') {\n      this.options.unload(this.imageIds);\n    }\n\n    this._imageSubject.unsubscribe();\n\n    cornerstone.events.removeEventListener('cornerstoneimageloadprogress', this.onProgress);\n\n    this._cancel.forEach(cancel => cancel());\n\n    this._destoyed = true;\n  };\n\n  length = (): number => {\n    return this._images.length;\n  };\n\n  getIndex = (): number => {\n    return this._indexSubject.getValue();\n  };\n\n  goto = (value: number) => {\n    this.change(Math.max(0, Math.min(this._images.length - 1, value)));\n  };\n\n  next = (delta: number = 1) => {\n    this.change(Math.min(this._images.length - 1, this._indexSubject.getValue() + delta));\n  };\n\n  prev = (delta: number = 1) => {\n    this.change(Math.max(0, this._indexSubject.getValue() - delta));\n  };\n\n  private change = (index: number) => {\n    this._indexSubject.next(index);\n\n    // 해당 image가 load 되었으면 보여준다\n    if (this._images[index]) {\n      this._imageSubject.next(this._images[index]);\n      return;\n    }\n\n    // load되지 않은 image를 보려하는 경우 가까운 index의 이미지를 먼저 보여준다\n\n    const before: cornerstone.Image[] = this._images\n      .slice(0, index - 1)\n      .filter<cornerstone.Image>(isImage)\n      .reverse();\n\n    if (before.length > 0) {\n      this._imageSubject.next(before[0]);\n      return;\n    }\n\n    const after: cornerstone.Image[] = this._images.slice(index + 1).filter<cornerstone.Image>(isImage);\n\n    if (after.length > 0) {\n      this._imageSubject.next(after[0]);\n      return;\n    }\n\n    console.warn('대체할 Image를 찾을 수 없음');\n  };\n\n  private loadImage = async (imageId: string, index: number) => {\n    try {\n      this._images[index] = await this._loader.loadImage({\n        imageId: imageId,\n        options: { loader: wadoImageLoaderXHRLoader(cancel => this._cancel.push(cancel)) },\n      });\n\n      const nextProgress: number[] = [...this._progressSubject.getValue()];\n      nextProgress[index] = 1;\n\n      const total: number = nextProgress.reduce((t, n) => t + n, 0);\n      if (total >= 1) {\n        cornerstone.events.removeEventListener('cornerstoneimageloadprogress', this.onProgress);\n      }\n\n      if (!this._destoyed) {\n        this._progressSubject.next(nextProgress);\n      }\n    } catch (error) {\n      if (!this._destoyed) {\n        console.warn(`It will retry loadImage(${imageId}):`, error);\n        this.loadImage(imageId, index);\n      }\n    }\n  };\n}\n","import { BehaviorSubject, Observable } from 'rxjs';\n\ninterface Params {\n  url: string;\n  signal?: AbortSignal;\n  headers?: Headers | [string, string][] | { [key: string]: string };\n}\n\nexport function fetchBuffer({ url, signal, headers }: Params): Observable<number | ArrayBuffer> {\n  const subject = new BehaviorSubject<number | ArrayBuffer>(0);\n\n  const xhr: XMLHttpRequest = new XMLHttpRequest();\n\n  xhr.open('get', url, true);\n  xhr.responseType = 'arraybuffer';\n\n  if (headers instanceof Headers || Array.isArray(headers)) {\n    for (const [k, v] of headers) {\n      xhr.setRequestHeader(k, v);\n    }\n  } else if (headers) {\n    Object.keys(headers).forEach(key => {\n      xhr.setRequestHeader(key, headers[key]);\n    });\n  }\n\n  const abort = () => {\n    try {\n      xhr.abort();\n    } catch (error) {}\n\n    signal?.removeEventListener('abort', abort);\n  };\n\n  signal?.addEventListener('abort', abort);\n\n  xhr.onloadstart = () => {\n    subject.next(0);\n  };\n\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState === 4 && xhr.status === 200) {\n      subject.next(xhr.response);\n\n      signal?.removeEventListener('abort', abort);\n    }\n  };\n\n  xhr.onprogress = ({ loaded, lengthComputable, total }: ProgressEvent) => {\n    if (lengthComputable) {\n      subject.next(loaded / total);\n    }\n  };\n\n  xhr.send();\n\n  return subject.asObservable();\n}\n","import { BehaviorSubject, Observable } from 'rxjs';\n\ninterface Params {\n  blob: Blob;\n  signal?: AbortSignal;\n}\n\nexport function fileToBuffer({ blob, signal }: Params): Observable<number | ArrayBufferLike> {\n  const subject = new BehaviorSubject<number | ArrayBufferLike>(0);\n\n  const reader = new FileReader();\n\n  const abort = () => {\n    try {\n      reader.abort();\n    } catch (error) {}\n\n    signal?.removeEventListener('abort', abort);\n  };\n\n  signal?.addEventListener('abort', abort);\n\n  reader.onloadstart = () => {\n    subject.next(0);\n  };\n\n  reader.onloadend = () => {\n    subject.next(reader.result as ArrayBufferLike);\n\n    signal?.removeEventListener('abort', abort);\n  };\n\n  reader.onprogress = ({ loaded, lengthComputable, total }: ProgressEvent) => {\n    if (lengthComputable) {\n      subject.next(loaded / total);\n    }\n  };\n\n  reader.readAsArrayBuffer(blob);\n\n  return subject.asObservable();\n}\n","import { BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ParallelImageLoader } from './ParallelImageLoader';\nimport { CornerstoneImage, ImageLoader } from './types';\n\ninterface Options {\n  unload?: (imageId: string) => void;\n  loader?: ImageLoader;\n}\n\nconst defaultLoader: ImageLoader = new ParallelImageLoader();\n\nexport class CornerstoneFileSingleImage implements CornerstoneImage {\n  private readonly _imageSubject: BehaviorSubject<cornerstone.Image | null>;\n  private readonly _imageId: string;\n  private readonly _loader: ImageLoader;\n  private _destoyed: boolean = false;\n\n  constructor(private file: File, private readonly options: Options = {}) {\n    this._imageSubject = new BehaviorSubject<cornerstone.Image | null>(null);\n    this._loader = options.loader || defaultLoader;\n\n    this._imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\n\n    this.loadImage();\n  }\n\n  get image(): Observable<cornerstone.Image | null> {\n    return this._imageSubject.asObservable();\n  }\n\n  get progress(): Observable<number> {\n    return this._imageSubject.pipe(map(image => (image ? 1 : 0)));\n  }\n\n  destroy = () => {\n    if (this.options && typeof this.options.unload === 'function') {\n      this.options.unload(this._imageId);\n    }\n\n    this._destoyed = true;\n  };\n\n  private loadImage = async () => {\n    try {\n      const image = await this._loader.loadImage({\n        imageId: this._imageId,\n      });\n\n      if (!this._destoyed) {\n        this._imageSubject.next(image);\n      }\n    } catch (error) {\n      if (!this._destoyed) {\n        console.warn(`It will retry loadImage(${this._imageId}):`, error);\n        this.loadImage();\n      }\n    }\n  };\n}\n","import { CornerstoneSequenceImage } from '@lunit/insight-viewer';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nexport class CornerstoneStaticSeriesImage implements CornerstoneSequenceImage {\n  private readonly _imageSubject: BehaviorSubject<cornerstone.Image | null>;\n  private readonly _indexSubject: BehaviorSubject<number>;\n  private readonly _imagesSubscription: Subscription;\n  private readonly _progress: Observable<number>;\n  private _images: cornerstone.Image[] | null = null;\n\n  constructor({\n    progress,\n    images,\n    initialIndex = 'center',\n  }: {\n    progress: Observable<number>;\n    images: Observable<cornerstone.Image[]>;\n    initialIndex?: number | 'start' | 'center' | 'end';\n  }) {\n    this._imagesSubscription = images.subscribe(images => {\n      this._images = images;\n\n      let index: number;\n\n      if (initialIndex === 'start') {\n        index = 0;\n      } else if (initialIndex === 'center') {\n        index = Math.round(images.length / 2);\n      } else if (initialIndex === 'end') {\n        index = images.length - 1;\n      } else {\n        index = initialIndex;\n      }\n\n      this._imageSubject.next(images[index]);\n      this._indexSubject.next(index);\n\n      // subscribe once\n      this._imagesSubscription.unsubscribe();\n    });\n\n    this._progress = progress;\n    this._imageSubject = new BehaviorSubject<cornerstone.Image | null>(null);\n    this._indexSubject = new BehaviorSubject<number>(0);\n  }\n\n  get image(): Observable<cornerstone.Image | null> {\n    return this._imageSubject.asObservable();\n  }\n\n  get progress(): Observable<number> {\n    return this._progress;\n  }\n\n  get index(): Observable<number> {\n    return this._indexSubject.asObservable();\n  }\n\n  length = (): number => {\n    return this._images?.length || 0;\n  };\n\n  getIndex = (): number => {\n    return this._indexSubject.getValue();\n  };\n\n  goto = (value: number) => {\n    if (!this._images) return;\n    const index: number = Math.max(0, Math.min(this._images.length - 1, value));\n    this._imageSubject.next(this._images[index]);\n    this._indexSubject.next(index);\n  };\n\n  next = (delta: number = 1) => {\n    if (!this._images) return;\n    const index: number = Math.min(this._images.length - 1, this._indexSubject.getValue() + delta);\n    this._imageSubject.next(this._images[index]);\n    this._indexSubject.next(index);\n  };\n\n  prev = (delta: number = 1) => {\n    if (!this._images) return;\n    const index: number = Math.max(0, this._indexSubject.getValue() - delta);\n    this._imageSubject.next(this._images[index]);\n    this._indexSubject.next(index);\n  };\n\n  destroy = () => {\n    this._imagesSubscription.unsubscribe();\n    this._imageSubject.unsubscribe();\n    this._indexSubject.unsubscribe();\n  };\n}\n","import { DecoratorFunction } from '@storybook/addons';\nimport React, { createElement, isValidElement } from 'react';\nimport { createGlobalStyle } from 'styled-components';\nimport { globalStyle } from './style';\n\nconst StorybookGlobalStyle = createGlobalStyle`\n  html {\n    font-size: 14px;\n    box-sizing: border-box;\n  }\n  \n  ${globalStyle}\n`;\n\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const withInsightViewerStorybookGlobalStyle: DecoratorFunction<any> = storyFn => {\n  const story = storyFn();\n\n  return (\n    <>\n      <StorybookGlobalStyle />\n      {typeof story === 'function' ? (\n        createElement(story)\n      ) : isValidElement(story) ? (\n        story\n      ) : (\n        <div>story is not valid element</div>\n      )}\n    </>\n  );\n};\n","import { posMapToImageData } from '@lunit/heatmap';\nimport React, { Component, createRef, RefObject } from 'react';\nimport styled from 'styled-components';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { cleanCanvas } from './draw/cleanCanvas';\n\nexport interface HeatmapViewerProps extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** AI 결과로 나오는 Heatmap 데이터 형식 */\n  posMap: number[][];\n\n  /** Threshold 값 (CXR = 0.15, MMG = 0.1) */\n  threshold: number;\n}\n\nexport class HeatmapViewer extends Component<HeatmapViewerProps, {}> {\n  private canvasRef: RefObject<HTMLCanvasElement> = createRef();\n  private ctx: CanvasRenderingContext2D | null = null;\n  private imageData: ImageData | null = null;\n  private imageResourceCanvas: HTMLCanvasElement | null = null;\n\n  render() {\n    return (\n      <Canvas\n        ref={this.canvasRef}\n        width={this.props.width}\n        height={this.props.height}\n        style={{\n          width: this.props.width,\n          height: this.props.height,\n        }}\n      />\n    );\n  }\n\n  componentDidMount() {\n    this.imageResourceCanvas = document.createElement('canvas');\n\n    if (!this.canvasRef.current) throw new Error('<canvas> is not initialized');\n\n    this.ctx = this.canvasRef.current.getContext('2d');\n\n    if (!this.ctx) throw new Error('<canvas> context 2d is not initialized');\n\n    this.imageData = posMapToImageData(this.props.posMap, this.props.threshold);\n\n    this.drawHeatmap(this.props);\n  }\n\n  componentDidUpdate(prevProps: Readonly<HeatmapViewerProps>) {\n    const { width, height, posMap, threshold, cornerstoneRenderData } = this.props;\n\n    if (prevProps.posMap !== posMap || prevProps.threshold !== threshold) {\n      this.imageData = posMapToImageData(posMap, threshold);\n    }\n\n    if (\n      prevProps.posMap !== posMap ||\n      prevProps.threshold !== threshold ||\n      prevProps.cornerstoneRenderData !== cornerstoneRenderData\n    ) {\n      cleanCanvas(this.ctx!, width, height);\n\n      this.drawHeatmap(this.props);\n    }\n  }\n\n  drawHeatmap = ({ cornerstoneRenderData }: Readonly<HeatmapViewerProps>) => {\n    if (!this.imageData || !this.imageResourceCanvas || !this.ctx || !cornerstoneRenderData) {\n      return;\n    }\n\n    try {\n      this.ctx.save();\n\n      this.imageResourceCanvas.width = this.imageData.width;\n      this.imageResourceCanvas.height = this.imageData.height;\n      this.imageResourceCanvas.getContext('2d')!.putImageData(this.imageData, 0, 0);\n\n      cornerstone.setToPixelCoordinateSystem(cornerstoneRenderData.enabledElement, this.ctx);\n\n      const imageWidth: number = cornerstoneRenderData.image.width;\n      const imageHeight: number = cornerstoneRenderData.image.height;\n\n      this.ctx.drawImage(\n        this.imageResourceCanvas,\n        0,\n        0,\n        this.imageResourceCanvas.width,\n        this.imageResourceCanvas.height,\n        0,\n        0,\n        imageWidth,\n        imageHeight,\n      );\n\n      this.ctx.restore();\n    } catch (error) {\n      console.error(error);\n    }\n  };\n}\n\nconst Canvas = styled.canvas`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n`;\n\n/**\n * @deprecated use HeatmapViewer instead\n */\nexport const MachineHeatmapViewer = HeatmapViewer;\n","import { rad360 } from './rad360';\n\nexport function radToDirection(rad: number): 'south' | 'north' | 'east' | 'west' {\n  const deg: number = (rad360(rad) * 180) / Math.PI;\n\n  if (deg < 45) {\n    return 'east';\n  } else if (deg < 45 * 3) {\n    return 'south';\n  } else if (deg < 45 * 5) {\n    return 'west';\n  } else if (deg < 45 * 7) {\n    return 'north';\n  } else {\n    return 'east';\n  }\n}\n","export function rad360(atan2: number): number {\n  return atan2 < 0 ? Math.PI * 2 + atan2 : atan2;\n}\n","import { DominantBaselineProperty, TextAnchorProperty } from 'csstype';\nimport { radToDirection } from './radToDirection';\n\nconst dominantBaselineMap = {\n  east: 'middle',\n  south: 'text-after-edge',\n  west: 'middle',\n  north: 'text-before-edge',\n} as const;\n\nconst textAnchorMap = {\n  east: 'start',\n  south: 'middle',\n  west: 'end',\n  north: 'middle',\n} as const;\n\nexport interface GetAngledTextPositionParams {\n  start: [number, number];\n  end: [number, number];\n  fontSize: number;\n}\n\nexport function getAngledTextPosition({\n  start,\n  end,\n  fontSize,\n}: GetAngledTextPositionParams): {\n  x: number;\n  y: number;\n  textAnchor: TextAnchorProperty;\n  dominantBaseline: DominantBaselineProperty;\n  'data-direction': 'south' | 'north' | 'east' | 'west';\n} {\n  const rad: number = Math.atan2(start[1] - end[1], start[0] - end[0]);\n  const direction = radToDirection(rad + Math.PI);\n  const x: number = fontSize * Math.cos(rad + Math.PI) + end[0];\n  const y: number = fontSize * Math.sin(rad + Math.PI) + end[1];\n\n  return {\n    x,\n    y: direction === 'north' ? y - fontSize : direction === 'south' ? y + fontSize : y,\n    textAnchor: textAnchorMap[direction],\n    dominantBaseline: dominantBaselineMap[direction],\n    'data-direction': direction,\n  };\n}\n","import { drawArrow, getAngledTextPosition } from '@lunit/insight-draw';\nimport { ArrowedContour, InsightViewerGuestProps, Point } from '@lunit/insight-viewer';\nimport React, { Component, createRef, CSSProperties, Fragment, RefObject } from 'react';\nimport styled from 'styled-components';\n\nexport interface ArrowedContourViewerProps<T extends ArrowedContour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /** Mouse Over 등 User Interaction에 의해서 Focus 된 Contour */\n  focusedContour: T | null;\n\n  /** <svg className={}> */\n  className?: string;\n\n  /** <svg style={}> */\n  style?: CSSProperties;\n\n  /**\n   * Line에 외곽을 그려준다\n   * Line을 두 개 그려서 border를 표현하기 때문에,성능에 민감한 상황인 경우 비활성 시킬 수 있다.\n   */\n  border?: boolean;\n\n  /**\n   * Arrow Styles\n   */\n  arrowWidth?: number;\n  arrowDepth?: number;\n  lineWidth?: number;\n\n  baseFontSize?: number;\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): Point[] {\n  return polygon.map(([x, y]) => {\n    const p = cornerstone.pixelToCanvas(element, { x, y });\n    return [p.x, p.y];\n  });\n}\n\nexport class ArrowedContourViewerBase<T extends ArrowedContour> extends Component<ArrowedContourViewerProps<T>, {}> {\n  static defaultProps: Partial<ArrowedContourViewerProps<ArrowedContour>> = {\n    border: true,\n    arrowDepth: 7,\n    arrowWidth: 10,\n    lineWidth: 3,\n    baseFontSize: 18,\n  };\n\n  private svgRef: RefObject<SVGSVGElement> = createRef();\n\n  render() {\n    const { cornerstoneRenderData, contours, focusedContour } = this.props;\n\n    return (\n      <svg\n        ref={this.svgRef}\n        className={this.props.className}\n        style={this.props.style}\n        width={this.props.width}\n        height={this.props.height}\n      >\n        {contours.length > 0 &&\n          cornerstoneRenderData &&\n          cornerstoneRenderData.element &&\n          contours.map((contour) => {\n            const polygon: number[][] = toLocal(cornerstoneRenderData.element, contour.polygon);\n            const arrowPolygon: number[][] = toLocal(\n              cornerstoneRenderData.element,\n              drawArrow({\n                start: contour.arrowStart,\n                end: contour.arrowEnd,\n                lineWidth: this.props.lineWidth!,\n                arrowDepth: this.props.arrowDepth!,\n                arrowWidth: this.props.arrowWidth!,\n              }),\n            );\n            const focused: boolean = contour === focusedContour;\n            const dataAttrs: { [attr: string]: string } = contour.dataAttrs || {};\n\n            const fontSize: number = Math.floor(\n              this.props.baseFontSize! * Math.max(1, cornerstoneRenderData.viewport.scale),\n            );\n\n            const [start, end] = toLocal(cornerstoneRenderData.element, [contour.arrowStart, contour.arrowEnd]);\n\n            const labelPosition = getAngledTextPosition({\n              start,\n              end,\n              fontSize,\n            });\n\n            return (\n              <Fragment key={'polygon' + contour.id}>\n                {this.props.border === true && (\n                  <polygon\n                    {...dataAttrs}\n                    data-polygon=\"contour\"\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                  />\n                )}\n                <polygon\n                  {...dataAttrs}\n                  data-polygon=\"contour\"\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  points={polygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                />\n                {this.props.border === true && (\n                  <polygon\n                    {...dataAttrs}\n                    data-polygon=\"arrow\"\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    points={arrowPolygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                  />\n                )}\n                <polygon\n                  {...dataAttrs}\n                  data-polygon=\"arrow\"\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  points={arrowPolygon.map(([x, y]) => `${x},${y}`).join(' ')}\n                />\n                {this.props.border === true && (\n                  <text\n                    {...dataAttrs}\n                    data-border=\"border\"\n                    data-id={contour.id}\n                    data-focused={focused || undefined}\n                    fontSize={fontSize}\n                    {...labelPosition}\n                  >\n                    {contour.label\n                      ? typeof contour.label === 'function'\n                        ? contour.label(contour)\n                        : contour.label\n                      : contour.id}\n                  </text>\n                )}\n                <text\n                  {...dataAttrs}\n                  data-id={contour.id}\n                  data-focused={focused || undefined}\n                  fontSize={fontSize}\n                  {...labelPosition}\n                >\n                  {contour.label\n                    ? typeof contour.label === 'function'\n                      ? contour.label(contour)\n                      : contour.label\n                    : contour.id}\n                </text>\n              </Fragment>\n            );\n          })}\n      </svg>\n    );\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const ArrowedContourViewer: new <T extends ArrowedContour>() => ArrowedContourViewerBase<T> = styled(\n  ArrowedContourViewerBase,\n)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  user-select: none;\n\n  --color: #ffffff;\n  --focused-color: rgb(255, 194, 17);\n  --stroke-width: 3px;\n  --focused-stroke-width: 6px;\n  --fill-color: rgba(0, 0, 0, 0.2);\n  --focused-fill-color: rgba(0, 0, 0, 0.4);\n\n  > polygon[data-polygon='contour'] {\n    stroke-width: var(--contour-viewer-stroke-width, var(--stroke-width));\n    stroke: var(--contour-viewer-color, var(--color));\n    fill: var(--contour-viewer-fill-color, var(--fill-color));\n    transition: stroke 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      stroke-width: var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width));\n      stroke: var(--contour-viewer-focused-color, var(--focused-color));\n      fill: var(--contour-viewer-focused-fill-color, var(--focused-fill-color));\n    }\n\n    &[data-border] {\n      stroke-width: calc(var(--contour-viewer-stroke-width, var(--stroke-width)) + 2px);\n      stroke: #000000;\n      fill: transparent;\n\n      &[data-focused] {\n        stroke-width: calc(var(--contour-viewer-focused-stroke-width, var(--focused-stroke-width)) + 2px);\n        stroke: #000000;\n      }\n    }\n  }\n\n  > polygon[data-polygon='arrow'] {\n    fill: var(--contour-viewer-color, var(--color));\n    transition: fill 120ms ease-out;\n\n    &[data-focused] {\n      fill: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: calc(var(--contour-viewer-stroke-width, var(--stroke-width)));\n      stroke: #000000;\n      fill: transparent;\n    }\n  }\n\n  > text {\n    fill: var(--contour-viewer-color, var(--color));\n    font-family: proximanova, noto_sans, sans-serif;\n    font-weight: 600;\n    transition: fill 120ms ease-out, stroke-width 120ms ease-out;\n\n    &[data-focused] {\n      fill: var(--contour-viewer-focused-color, var(--focused-color));\n    }\n\n    &[data-border] {\n      stroke-width: 4px;\n      stroke: #000000;\n      fill: transparent;\n    }\n  }\n` as any;\n","export interface DrawArrowParams {\n  /** start 화살표 시작점 */\n  start: [number, number];\n\n  /** end 막대 끝점 */\n  end: [number, number];\n\n  /** lineWidth 막대의 굵기 */\n  lineWidth: number;\n\n  /** arrowWidth 화살의 넓이 (양옆으로) */\n  arrowDepth: number;\n\n  /** arrowDepth 화살의 깊이 (길이) */\n  arrowWidth: number;\n}\n\nexport function drawArrow({ start, end, lineWidth, arrowWidth, arrowDepth }: DrawArrowParams): [number, number][] {\n  const south: number = Math.atan2(start[1] - end[1], start[0] - end[0]);\n  const angle: { south: number; north: number; east: number; west: number } = {\n    south,\n    north: south + Math.PI,\n    east: south + Math.PI * 1.5,\n    west: south + Math.PI * 0.5,\n  };\n\n  const arrowEnd = [arrowDepth * Math.cos(angle.north) + start[0], arrowDepth * Math.sin(angle.north) + start[1]];\n\n  return [\n    start,\n    [\n      (arrowWidth / 2) * Math.cos(angle.east) + arrowEnd[0], // arrow east\n      (arrowWidth / 2) * Math.sin(angle.east) + arrowEnd[1],\n    ],\n    [\n      (lineWidth / 2) * Math.cos(angle.east) + arrowEnd[0], // arrow line east\n      (lineWidth / 2) * Math.sin(angle.east) + arrowEnd[1],\n    ],\n    [\n      (lineWidth / 2) * Math.cos(angle.east) + end[0], // line end east\n      (lineWidth / 2) * Math.sin(angle.east) + end[1],\n    ],\n    [\n      (lineWidth / 2) * Math.cos(angle.west) + end[0], // line end west\n      (lineWidth / 2) * Math.sin(angle.west) + end[1],\n    ],\n    [\n      (lineWidth / 2) * Math.cos(angle.west) + arrowEnd[0], // arrow line west\n      (lineWidth / 2) * Math.sin(angle.west) + arrowEnd[1],\n    ],\n    [\n      (arrowWidth / 2) * Math.cos(angle.west) + arrowEnd[0], // arrow west\n      (arrowWidth / 2) * Math.sin(angle.west) + arrowEnd[1],\n    ],\n  ];\n}\n","import React, { ComponentType, MouseEvent, SVGProps, useCallback } from 'react';\nimport styled from 'styled-components';\n\nexport interface PointPinProps extends SVGProps<SVGGElement> {\n  x: number;\n  y: number;\n  label: string | null;\n  onEnter: () => void;\n  onLeave: () => void;\n  onRemove: () => void;\n}\n\nfunction PointPinBase({ x, y, label, onEnter, onLeave, onRemove, ...gProps }: PointPinProps) {\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      event.stopPropagation();\n      event.nativeEvent.stopImmediatePropagation();\n      event.preventDefault();\n\n      onRemove();\n    },\n    [onRemove],\n  );\n\n  return (\n    <g {...gProps} transform={`translate(${x} ${y})`} onMouseEnter={onEnter} onMouseLeave={onLeave} onClick={onClick}>\n      <circle cx={0} cy={0} r={4} />\n\n      <path\n        d=\"M8,16c0,0,6-5.582,6-10s-2.686-6-6-6S2,1.582,2,6S8,16,8,16z M5,5c0-1.657,1.343-3,3-3s3,1.343,3,3S9.657,8,8,8S5,6.657,5,5  z\"\n        transform=\"translate(-8 -16)\"\n        data-border=\"border\"\n      />\n\n      <path\n        d=\"M8,16c0,0,6-5.582,6-10s-2.686-6-6-6S2,1.582,2,6S8,16,8,16z M5,5c0-1.657,1.343-3,3-3s3,1.343,3,3S9.657,8,8,8S5,6.657,5,5  z\"\n        transform=\"translate(-8 -16)\"\n      />\n\n      {label && (\n        <g transform=\"translate(0 -25)\">\n          <text>{label}</text>\n          <text>{label}</text>\n        </g>\n      )}\n    </g>\n  );\n}\n\nexport const PointPin: ComponentType<PointPinProps> = styled(PointPinBase)`\n  cursor: pointer;\n\n  color: var(--pin-color, #ffffff);\n\n  &[data-focused] {\n    color: var(--pin-focused-color, rgb(255, 194, 17));\n  }\n\n  > circle {\n    fill: #000000;\n  }\n\n  > path {\n    fill: currentColor;\n\n    &[data-border] {\n      stroke-width: 4px;\n      stroke: #000000;\n    }\n  }\n\n  > g {\n    text {\n      text-anchor: middle;\n      font-size: 14px;\n      font-weight: bold;\n    }\n\n    text:first-child {\n      stroke-width: 4px;\n      stroke: #000000;\n    }\n\n    text:last-child {\n      fill: currentColor;\n    }\n  }\n` as ComponentType<PointPinProps>;\n","import React, { Component, ComponentType, MouseEvent } from 'react';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\nimport { PointPin, PointPinProps } from './PointPin';\n\nexport interface PointDrawerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour 데이터를 상속받은 Annotation 데이터 */\n  contours: T[];\n\n  /** Mouse Over 등 User Interaction에 의해서 Focus 된 Contour */\n  focusedContour: T | null;\n\n  /** Draw / Focus / Remove 와 같은 User Interaction을 활성 / 비활성 한다 */\n  interact?: boolean;\n\n  /**\n   * 특정 Contour에 Mouse Over 되었을 때\n   * focusedContour를 결정하는데 필요하다\n   */\n  onFocus?: (contour: T | null) => void;\n\n  /** 그리기가 완료되어 새로운 Contour가 발생했을 때 */\n  onAdd?: (polygon: Point[], event: MouseEvent) => void;\n\n  /** 특정 Contour를 Click 해서 지울때 필요하다 */\n  onRemove?: (contour: T) => void;\n\n  className?: string;\n\n  /** Pin의 모양을 변경하는데 사용할 수 있다 */\n  pointPinComponent?: ComponentType<PointPinProps>;\n\n  /** Contour 데이터에 따라 Pin을 다르게 하고 싶은 경우 사용할 수 있다 */\n  pointPinFunction?: (contour: T) => ComponentType<PointPinProps>;\n}\n\nfunction toLocal(element: HTMLElement, point: Point): { x: number; y: number } {\n  return cornerstone.pixelToCanvas(element, { x: point[0], y: point[1] });\n}\n\nexport class PointViewer<T extends Contour> extends Component<PointDrawerProps<T>, {}> {\n  render() {\n    return (\n      <svg\n        role=\"figure\"\n        width={this.props.width}\n        height={this.props.height}\n        className={this.props.className}\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: this.props.width,\n          height: this.props.height,\n          userSelect: 'none',\n          pointerEvents: this.props.interact === true ? 'auto' : 'none',\n        }}\n        onClick={this.onPointAdd}\n      >\n        {this.props.cornerstoneRenderData &&\n          this.props.contours &&\n          this.props.contours.length > 0 &&\n          this.props.contours.map(contour => {\n            const { id, polygon, dataAttrs = {}, label } = contour;\n\n            const Pin: ComponentType<PointPinProps> =\n              typeof this.props.pointPinFunction === 'function'\n                ? this.props.pointPinFunction(contour)\n                : this.props.pointPinComponent || PointPin;\n\n            const text: string =\n              typeof label === 'function' ? label(contour) : typeof label === 'string' ? label : id.toString();\n\n            return (\n              <Pin\n                key={id}\n                {...toLocal(this.props.cornerstoneRenderData!.element, polygon[0])}\n                {...dataAttrs}\n                data-id={id}\n                data-focused={contour === this.props.focusedContour || undefined}\n                label={text}\n                onEnter={() => this.onPointEnter(contour)}\n                onLeave={() => this.onPointLeave()}\n                onRemove={() => this.onPointRemove(contour)}\n              />\n            );\n          })}\n      </svg>\n    );\n  }\n\n  private onPointAdd = (event: MouseEvent<SVGSVGElement>) => {\n    if (\n      typeof this.props.onAdd === 'function' &&\n      this.props.cornerstoneRenderData &&\n      this.props.cornerstoneRenderData.element\n    ) {\n      const element: HTMLElement = this.props.cornerstoneRenderData.element;\n      const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n      this.props.onAdd([[x, y]], event);\n    }\n  };\n\n  private onPointEnter = (contour: T) => {\n    if (typeof this.props.onFocus === 'function') {\n      this.props.onFocus(contour);\n    }\n  };\n\n  private onPointLeave = () => {\n    if (typeof this.props.onFocus === 'function') {\n      this.props.onFocus(null);\n    }\n  };\n\n  private onPointRemove = (contour: T) => {\n    if (typeof this.props.onRemove === 'function') {\n      this.props.onRemove(contour);\n    }\n  };\n}\n\n/**\n * @deprecated use PointViewer instead\n */\nexport const UserPointViewer = PointViewer;\n","import { ColorProperty } from 'csstype';\nimport { createGlobalStyle, css } from 'styled-components';\n\nexport interface OPTComponentsCSSProperties {\n  '--button-background-color'?: ColorProperty;\n  '--button-label-color'?: ColorProperty;\n  '--button-background-color-hover'?: ColorProperty;\n  '--button-label-color-hover'?: ColorProperty;\n  '--button-background-color-selected'?: ColorProperty;\n  '--button-label-color-selected'?: ColorProperty;\n  '--button-background-color-disabled'?: ColorProperty;\n  '--button-label-color-disabled'?: ColorProperty;\n\n  '--panel-background-color'?: ColorProperty;\n  '--panel-header-background-color'?: ColorProperty;\n  '--panel-icon-color'?: ColorProperty;\n  '--panel-icon-color-hover'?: ColorProperty;\n  '--panel-title-color'?: ColorProperty;\n\n  '--slider-rail-color'?: ColorProperty;\n  '--slider-thumb-color'?: ColorProperty;\n  '--slider-track-color'?: ColorProperty;\n  '--slider-value-label-color'?: ColorProperty;\n\n  '--tooltip-background-color'?: ColorProperty;\n  '--tooltip-color'?: ColorProperty;\n}\n\nexport const blockStyle = css`\n  --button-background-color: rgba(255, 255, 255, 0.2);\n  --button-label-color: rgba(255, 255, 255, 0.7);\n  --button-background-color-hover: rgba(255, 255, 255, 0.35);\n  --button-label-color-hover: rgba(255, 255, 255, 0.9);\n  --button-background-color-selected: #00a4c8;\n  --button-label-color-selected: #ffffff;\n  --button-background-color-disabled: rgba(255, 255, 255, 0.12);\n  --button-label-color-disabled: rgba(255, 255, 255, 0.2);\n\n  --panel-background-color: #242e3e;\n  --panel-header-background-color: rgba(255, 255, 255, 0.03);\n  --panel-icon-color: #8694b1;\n  --panel-icon-color-hover: #c5d8f8;\n  --panel-title-color: #ffffff;\n\n  --slider-rail-color: rgba(255, 255, 255, 0.4);\n  --slider-thumb-color: #ffffff;\n  --slider-track-color: rgba(255, 255, 255, 0.6);\n  --slider-value-label-color: rgba(0, 0, 0, 0.4);\n\n  --tooltip-background-color: rgba(0, 0, 0, 0.7);\n  --tooltip-label-color: #ffffff;\n\n  --snackbar-background-color: rgba(0, 0, 0, 0.7);\n  --snackbar-label-color: #ffffff;\n\n  --switch-color: #eeeeee;\n  --switch-track-color: rgba(255, 255, 255, 0.2);\n  --switch-color-checked: #00a5c8;\n  --switch-track-color-checked: rgba(255, 255, 255, 0.2);\n`;\n\nexport const globalStyle = css`\n  :root {\n    ${blockStyle};\n  }\n\n  body {\n    color: white;\n    background-color: #222232;\n  }\n\n  body,\n  button,\n  input,\n  optgroup,\n  select,\n  textarea,\n  pre {\n    font-family: proximanova, noto_sanslight, sans-serif;\n    font-weight: 400;\n    font-size: 14px;\n    letter-spacing: 0.6px;\n  }\n`;\n\nexport const GlobalStyle = createGlobalStyle`\n  ${globalStyle}\n`;\n","import { createMuiTheme, Theme as MuiTheme } from '@material-ui/core/styles';\n\nconst muiTheme: MuiTheme = createMuiTheme({\n  palette: {\n    type: 'dark',\n  },\n  typography: {\n    fontFamily: 'proximanova,noto_sanslight,sans-serif',\n    fontWeightLight: 200,\n    fontWeightRegular: 400,\n    fontWeightMedium: 600,\n    fontWeightBold: 700,\n  },\n  overrides: {\n    MuiTooltip: {\n      tooltip: {\n        fontSize: 13,\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      },\n    },\n  },\n});\n\nexport const theme = {\n  ...muiTheme,\n  app: {\n    backgroundColor: '#222232',\n  },\n};\n\nexport type Theme = typeof theme;\n","import { DecoratorFunction } from '@storybook/addons';\nimport React, { createElement, isValidElement } from 'react';\nimport { createGlobalStyle } from 'styled-components';\nimport { ThemeProvider } from './context';\nimport { globalStyle } from './style';\n\nconst StorybookGlobalStyle = createGlobalStyle`\n  html {\n    font-size: 14px;\n    box-sizing: border-box;\n  }\n  \n  ${globalStyle}\n`;\n\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const withOPTComponentsStorybookGlobalStyle: DecoratorFunction<any> = storyFn => {\n  const story = storyFn();\n\n  return (\n    <ThemeProvider>\n      <StorybookGlobalStyle />\n      {typeof story === 'function' ? (\n        createElement(story)\n      ) : isValidElement(story) ? (\n        story\n      ) : (\n        <div>story is not valid element</div>\n      )}\n    </ThemeProvider>\n  );\n};\n","import { ButtonBase as MuiButtonBase } from '@material-ui/core';\nimport { ButtonBaseProps as MuiButtonBaseProps } from '@material-ui/core/ButtonBase';\nimport CheckIcon from '@material-ui/icons/Done';\nimport React, { ComponentType, MouseEvent, ReactElement, useCallback } from 'react';\nimport styled, { css } from 'styled-components';\n\nexport interface ButtonProps extends Omit<MuiButtonBaseProps, 'onChange'> {\n  label?: ReactElement | string;\n  icon?: ReactElement | string;\n  check?: ReactElement;\n  layout?: 'left' | 'center';\n  hideCheck?: boolean;\n  selected?: boolean;\n  onChange?: (nextSelected: boolean) => void;\n}\n\nexport const checkIcon = <CheckIcon />;\n\nexport const buttonClasses = {\n  label: 'LunitButton-label',\n  icon: 'LunitButton-icon',\n  check: 'LunitButton-check',\n} as const;\n\nexport function ButtonBase({\n  label,\n  icon,\n  check = checkIcon,\n  className = '',\n  selected,\n  onChange,\n  onClick,\n  hideCheck,\n  style = {},\n  disabled = false,\n  ...muiButtonProps\n}: ButtonProps) {\n  const click = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      if (typeof selected === 'boolean' && typeof onChange === 'function') {\n        onChange(!selected);\n      }\n\n      if (typeof onClick === 'function') {\n        onClick(event);\n      }\n    },\n    [selected, onChange, onClick],\n  );\n\n  return (\n    <MuiButtonBase\n      {...muiButtonProps}\n      className={className}\n      aria-selected={selected === true}\n      style={style}\n      onClick={click}\n      disabled={disabled}\n    >\n      {icon && <span className={buttonClasses.icon}>{icon}</span>}\n      {label && <span className={buttonClasses.label}>{label}</span>}\n      {hideCheck !== true && selected === true && <span className={buttonClasses.check}>{check}</span>}\n    </MuiButtonBase>\n  );\n}\n\nexport const IconAndLabelButton: ComponentType<ButtonProps> = styled(ButtonBase).attrs(props => {\n  if (!props.label || !props.icon) {\n    throw new Error(`the props label and icon are required to <IconAndLabelButton>`);\n  }\n\n  if (props.layout === 'left') {\n    console.warn(`<IconAndLabelButton> layout prop is only support 'center'`);\n  }\n\n  if (props.hideCheck === false) {\n    console.warn(`<IconAndLabelButton> hideCheck prop is only support 'true'`);\n  }\n\n  return {\n    ...props,\n    hideCheck: true,\n    layout: 'center',\n  };\n})`\n  && {\n    flex: 1;\n    justify-content: center;\n\n    height: 54px;\n\n    font-size: 13px;\n    color: var(--button-label-color);\n    background-color: var(--button-background-color);\n    flex-direction: column;\n\n    .${buttonClasses.icon} {\n      font-size: 21px;\n      display: block;\n      text-align: center;\n\n      .MuiSvgIcon-root {\n        font-size: 1em;\n      }\n    }\n\n    .${buttonClasses.label} {\n      display: block;\n      text-align: center;\n      margin-bottom: -2px;\n    }\n\n    &:hover {\n      background-color: var(--button-background-color-hover);\n      color: var(--button-label-color-hover);\n    }\n\n    &[aria-selected='true'] {\n      background-color: var(--button-background-color-selected);\n      color: var(--button-label-color-selected);\n    }\n\n    &:disabled {\n      background-color: var(--button-background-color-disabled);\n      color: var(--button-label-color-disabled);\n    }\n  }\n`;\n\nexport const Button: ComponentType<ButtonProps> = styled(ButtonBase)`\n  && {\n    justify-content: ${({ layout }) => layout};\n    padding-left: ${({ layout }) => (layout === 'left' ? '13px' : 0)};\n\n    height: 40px;\n\n    font-size: 13px;\n    color: var(--button-label-color);\n    background-color: var(--button-background-color);\n\n    .${buttonClasses.icon} {\n      font-size: 21px;\n      margin-right: ${({ label }) => (label ? '8px' : 0)};\n      transform: translateY(2px);\n\n      .MuiSvgIcon-root {\n        font-size: 1em;\n      }\n    }\n\n    .${buttonClasses.check} {\n      ${({ layout }) => (layout !== 'left' ? 'display: none' : '')};\n      position: absolute;\n      font-size: 21px;\n      right: 5px;\n      top: 8px;\n\n      .MuiSvgIcon-root {\n        font-size: 1em;\n      }\n    }\n\n    &:hover {\n      background-color: var(--button-background-color-hover);\n      color: var(--button-label-color-hover);\n    }\n\n    &[aria-selected='true'] {\n      background-color: var(--button-background-color-selected);\n      color: var(--button-label-color-selected);\n    }\n\n    &:disabled {\n      background-color: var(--button-background-color-disabled);\n      color: var(--button-label-color-disabled);\n    }\n  }\n`;\n\nexport const buttonStyle = css`\n  font-size: 13px;\n  color: var(--button-label-color);\n  background-color: var(--button-background-color);\n\n  &:hover {\n    background-color: var(--button-background-color-hover);\n    color: var(--button-label-color-hover);\n  }\n\n  &[aria-selected='true'] {\n    background-color: var(--button-background-color-selected);\n    color: var(--button-label-color-selected);\n  }\n\n  &:disabled {\n    background-color: var(--button-background-color-disabled);\n    color: var(--button-label-color-disabled);\n  }\n`;\n","import { KeyboardArrowDown } from '@material-ui/icons';\nimport React, { ComponentType, CSSProperties, ReactNode, useCallback, useMemo, useState } from 'react';\nimport styled, { css } from 'styled-components';\n\nexport interface PanelProps {\n  children: ReactNode | ((expanded: boolean) => ReactNode);\n  expanded?: boolean;\n  onChange?: (nextExapnded: boolean) => void;\n  title: ReactNode | ((expanded: boolean) => ReactNode);\n  icon?: ReactNode | ((expanded: boolean) => ReactNode);\n  className?: string;\n  style?: CSSProperties;\n  disabled?: boolean;\n}\n\nexport const panelClasses = {\n  header: 'LunitPanel-header',\n  icon: 'LunitPanel-icon',\n  title: 'LunitPanel-title',\n  content: 'LunitPanel-content',\n} as const;\n\nfunction getIcon(value: ReactNode | ((expanded: boolean) => ReactNode), expanded: boolean | undefined) {\n  const icon: ReactNode | undefined = typeof value === 'function' ? value(expanded === true) : value;\n\n  if (icon) return icon;\n\n  return typeof expanded !== 'boolean' ? null : expanded ? (\n    <Arrow />\n  ) : (\n    <Arrow style={{ transform: 'rotate(180deg)' }} />\n  );\n}\n\nexport function PanelBase({\n  className = '',\n  expanded,\n  onChange,\n  style = {},\n  title,\n  icon,\n  children,\n  disabled,\n}: PanelProps) {\n  const expand = useCallback(() => {\n    if (typeof expanded === 'boolean' && typeof onChange === 'function') {\n      onChange(!expanded);\n    }\n  }, [expanded, onChange]);\n\n  const content = typeof children === 'function' ? children(expanded === true) : children;\n\n  const iconElement = getIcon(icon, expanded);\n\n  return (\n    <div className={className} aria-expanded={expanded === true} aria-disabled={disabled === true} style={style}>\n      <div className={panelClasses.header}>\n        {iconElement && (\n          <span className={panelClasses.icon} onClick={expand}>\n            {iconElement}\n          </span>\n        )}\n\n        <span className={panelClasses.title}>{typeof title === 'function' ? title(expanded === true) : title}</span>\n      </div>\n\n      {content && <div className={panelClasses.content}>{content}</div>}\n    </div>\n  );\n}\n\nexport interface SessionPanelProps extends Omit<PanelProps, 'expanded'> {\n  sessionId: string;\n  defaultExpanded?: boolean;\n}\n\nexport function SessionPanelBase({ sessionId, defaultExpanded = true, onChange, ...props }: SessionPanelProps) {\n  const id: string = useMemo(() => {\n    return `__sidebar_panel_${sessionId}__`;\n  }, [sessionId]);\n\n  const [expanded, setExpanded] = useState<boolean>(() => {\n    const sessionValue: string | null = localStorage.getItem(id);\n\n    return typeof sessionValue === 'string' ? sessionValue === 'open' : defaultExpanded;\n  });\n\n  const updateExpanded = useCallback(\n    (nextExpanded: boolean) => {\n      localStorage.setItem(id, nextExpanded ? 'open' : 'close');\n      setExpanded(nextExpanded);\n      if (typeof onChange === 'function') onChange(nextExpanded);\n    },\n    [id, onChange],\n  );\n\n  return <Panel {...props} expanded={expanded} onChange={updateExpanded} />;\n}\n\nconst Arrow = styled(KeyboardArrowDown)`\n  transition: transform 0.3s ease-out;\n`;\n\nexport const PANEL_HEADER_HEIGHT: number = 25;\n\nconst panelStyle = css`\n  background-color: var(--panel-background-color);\n  position: relative;\n\n  &[aria-disabled='true'] {\n  }\n\n  .${panelClasses.header} {\n    height: 25px;\n    background-color: var(--panel-header-background-color);\n    display: flex;\n    align-items: center;\n    font-size: 12px;\n    padding: 1px 14px 0 14px;\n\n    .${panelClasses.icon} {\n      color: var(--panel-icon-color);\n      margin-left: -8px;\n      margin-right: 6px;\n      transform: translateY(2px);\n    }\n\n    .${panelClasses.title} {\n      color: var(--panel-title-color);\n      letter-spacing: 0.2em;\n    }\n  }\n\n  .${panelClasses.content} {\n    padding: 14px;\n  }\n`;\n\nconst panelIconHoverStyle = css`\n  .${panelClasses.header} {\n    .${panelClasses.icon} {\n      cursor: pointer;\n\n      &:hover {\n        color: var(--panel-icon-color-hover);\n      }\n    }\n  }\n`;\n\nexport const panelDisabled = ({ disabled }: PanelProps) =>\n  disabled\n    ? css`\n        opacity: 0.4;\n        pointer-events: none;\n        user-select: none;\n      `\n    : css`\n        opacity: 1;\n      `;\n\nexport const Panel: ComponentType<PanelProps> = styled(PanelBase)`\n  ${panelDisabled}\n  ${panelStyle}\n  ${({ onChange }) => (typeof onChange === 'function' ? panelIconHoverStyle : '')}\n`;\n\nexport const SessionPanel: ComponentType<SessionPanelProps> = styled(SessionPanelBase)`\n  opacity: ${({ disabled }) => (disabled ? 0.4 : 1)};\n  ${panelStyle}\n  ${panelIconHoverStyle}s\n`;\n","import { ComponentType, DetailedHTMLProps, HTMLAttributes } from 'react';\nimport styled from 'styled-components';\n\nexport const PanelDescription: ComponentType<DetailedHTMLProps<\n  HTMLAttributes<HTMLParagraphElement>,\n  HTMLParagraphElement\n>> = styled.p`\n  font-size: 12px;\n  margin-top: 0;\n  color: #ffffff;\n\n  > .MuiSvgIcon-root {\n    font-size: 16px;\n    margin-bottom: 6px;\n    display: block;\n  }\n`;\n\nexport const PanelDescriptionTitle: ComponentType<DetailedHTMLProps<\n  HTMLAttributes<HTMLHeadingElement>,\n  HTMLHeadingElement\n>> = styled.h3`\n  font-size: 12px;\n  font-weight: normal;\n  margin: 5px 0 4px 0;\n  color: currentColor;\n\n  > .MuiSvgIcon-root {\n    font-size: 16px;\n    margin-right: 6px;\n    transform: translateY(3px);\n  }\n`;\n\nexport const PanelDescriptionColors = {\n  NORMAL: '#ffffff',\n  INFO: '#00a4c8',\n  WARNING: '#d6ae41',\n  ERROR: '#c9434b',\n};\n","import React, { ReactNode } from 'react';\nimport styled from 'styled-components';\nimport { PANEL_HEADER_HEIGHT } from './Panel';\n\nexport interface PanelToolbarProps {\n  children: ReactNode;\n  className?: string;\n}\n\nexport function PanelToolbarBase({ children, className = '' }: PanelToolbarProps) {\n  return <div className={className}>{children}</div>;\n}\n\nexport const PanelToolbar = styled(PanelToolbarBase)`\n  position: absolute;\n  height: ${PANEL_HEADER_HEIGHT}px;\n  display: flex;\n  align-items: center;\n  top: 0;\n  padding-top: 1px;\n  right: 12px;\n`;\n","import styled from 'styled-components';\n\nexport const PanelToolbarBadge = styled.span`\n  font-size: 11px;\n  color: #ffffff;\n  background-color: rgba(255, 255, 255, 0.2);\n  padding: 3px 11px;\n  border-radius: 10px;\n`;\n","import React, { ComponentType, CSSProperties, ReactNode } from 'react';\nimport styled, { css } from 'styled-components';\n\nexport interface ButtonLayoutProps {\n  gap?: number;\n  direction: 'horizontal' | 'vertical';\n  className?: string;\n  children: ReactNode;\n  style?: CSSProperties;\n}\n\nexport function ButtonLayoutBase({ className = '', children, style }: ButtonLayoutProps) {\n  return (\n    <div className={className} style={style}>\n      {children}\n    </div>\n  );\n}\n\nconst verticalLayout = ({ gap = 2 }: ButtonLayoutProps) => css`\n  display: flex;\n  flex-flow: column;\n\n  > :not(:last-child) {\n    margin-bottom: ${gap}px;\n  }\n`;\n\nconst horizontalLayout = ({ gap = 2 }: ButtonLayoutProps) => css`\n  display: flex;\n  width: 100%;\n\n  > * {\n    flex: 1;\n  }\n\n  > :not(:last-child) {\n    margin-right: ${gap}px;\n  }\n`;\n\nexport const ButtonLayout: ComponentType<ButtonLayoutProps> = styled(ButtonLayoutBase)`\n  ${({ direction }) => (direction === 'horizontal' ? horizontalLayout : verticalLayout)};\n`;\n","import { Slider as MuiSlider } from '@material-ui/core';\nimport styled from 'styled-components';\n\nexport const Slider = styled(MuiSlider).attrs({\n  valueLabelDisplay: 'on',\n})`\n  && {\n    color: var(--slider-rail-color);\n    height: 19px;\n\n    .MuiSlider-thumb {\n      width: 28px;\n      height: 19px;\n      background-color: var(--slider-thumb-color);\n      border-radius: 10px;\n      margin-top: -7px;\n      margin-left: -14px;\n    }\n\n    .MuiSlider-active {\n      cursor: none;\n    }\n\n    .MuiSlider-valueLabel {\n      left: 0;\n      top: -7px;\n      transform: none;\n\n      * {\n        text-align: center;\n        width: 28px;\n        margin: 0;\n        padding: 0;\n        transform: none;\n        background: transparent;\n        color: var(--slider-value-label-color);\n        font-size: 13px;\n      }\n    }\n\n    ,\n    .MuiSlider-rail {\n      height: 5px;\n      border-radius: 2px;\n    }\n\n    .MuiSlider-track {\n      background-color: var(--slider-track-color);\n      height: 5px;\n      border-radius: 2px;\n    }\n  }\n`;\n","import MuiTooltip, { TooltipProps as MuiTooltipProps } from '@material-ui/core/Tooltip';\nimport { Error, Help } from '@material-ui/icons';\nimport { makeStyles } from '@material-ui/styles';\nimport React, { Fragment } from 'react';\nimport styled, { DefaultTheme, keyframes } from 'styled-components';\n\nexport interface TooltipProps extends MuiTooltipProps {}\n\nexport function Tooltip({ className, ...props }: TooltipProps) {\n  const { arrow, popper, ...classes } = useTooltipStyle(props);\n  const [arrowRef, setArrowRef] = React.useState<HTMLSpanElement | null>(null);\n\n  return (\n    <MuiTooltip\n      classes={classes}\n      PopperProps={{\n        className: popper + ' ' + (className || ''),\n        popperOptions: {\n          modifiers: {\n            arrow: {\n              enabled: Boolean(arrowRef),\n              element: arrowRef,\n            },\n          },\n        },\n      }}\n      {...props}\n      title={\n        <Fragment>\n          {props.title}\n          <span className={arrow} ref={setArrowRef} />\n        </Fragment>\n      }\n    />\n  );\n}\n\nexport const useTooltipStyle = makeStyles<DefaultTheme, TooltipProps>({\n  tooltip: {\n    position: 'relative',\n    borderRadius: 0,\n    color: 'var(--tooltip-label-color)',\n    backgroundColor: 'var(--tooltip-background-color)',\n  },\n  arrow: {\n    position: 'absolute',\n    fontSize: 6,\n\n    '&::before': {\n      content: '\"\"',\n      margin: 'auto',\n      display: 'block',\n      width: 0,\n      height: 0,\n      borderStyle: 'solid',\n    },\n  },\n  popper: {\n    '&[x-placement*=\"bottom\"] $arrow': {\n      top: 0,\n      left: 0,\n      marginTop: '-1.45em',\n      width: '2em',\n      height: '1em',\n      '&::before': {\n        borderWidth: '0 1em 1.5em 1em',\n        borderColor: `transparent transparent var(--tooltip-background-color) transparent`,\n      },\n    },\n    '&[x-placement*=\"top\"] $arrow': {\n      bottom: 0,\n      left: 0,\n      marginBottom: '-0.95em',\n      width: '2em',\n      height: '1em',\n      '&::before': {\n        borderWidth: '1.5em 1em 0 1em',\n        borderColor: `var(--tooltip-background-color) transparent transparent transparent`,\n      },\n    },\n    '&[x-placement*=\"right\"] $arrow': {\n      left: 0,\n      marginLeft: '-1.45em',\n      height: '2em',\n      width: '1em',\n      '&::before': {\n        borderWidth: '1em 1.5em 1em 0',\n        borderColor: `transparent var(--tooltip-background-color) transparent transparent`,\n      },\n    },\n    '&[x-placement*=\"left\"] $arrow': {\n      right: 0,\n      marginRight: '-0.95em',\n      height: '2em',\n      width: '1em',\n      '&::before': {\n        borderWidth: '1em 0 1em 1.5em',\n        borderColor: `transparent transparent transparent var(--tooltip-background-color)`,\n      },\n    },\n  },\n});\n\nexport const NormalTooltip = styled(Tooltip).attrs({\n  children: <Help style={{ color: 'rgba(255, 255, 255, 0.6)' }} />,\n})`\n  --tooltip-background-color: rgba(255, 255, 255, 0.6);\n  --tooltip-label-color: #030a18;\n`;\n\nexport const InfoTooltip = styled(Tooltip).attrs({\n  children: <Help style={{ color: '#00a4c8' }} />,\n})`\n  --tooltip-background-color: #00a4c8;\n  --tooltip-label-color: #ffffff;\n`;\n\nconst blinkAnimation = keyframes`\n  0% {\n    opacity: 0.7;\n  }\n  \n  49% {\n    opacity: 0.7;\n  }\n  \n  50% {\n    opacity: 1;\n  }\n`;\n\nconst ErrorIcon = styled(Error)`\n  animation: ${blinkAnimation} 1s infinite;\n`;\n\nexport const WarningTooltip = styled(Tooltip).attrs({\n  children: <ErrorIcon style={{ color: '#d6ae41' }} />,\n})`\n  --tooltip-background-color: #d6ae41;\n  --tooltip-label-color: #ffffff;\n`;\n\nexport const ErrorTooltip = styled(Tooltip).attrs({\n  children: <ErrorIcon style={{ color: '#c9434b' }} />,\n})`\n  --tooltip-background-color: #c9434b;\n  --tooltip-label-color: #ffffff;\n`;\n","import { isTouchDevice } from '@lunit/is-touch-device';\nimport React, { Component, createRef, CSSProperties, DetailedHTMLProps, HTMLAttributes, RefObject } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nexport interface ScrollContainerProps extends DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  sessionId?: string;\n}\n\ninterface ScrollContainerState {}\n\nconst divStyle: CSSProperties = { overflow: 'hidden' };\n\nexport class ScrollContainer extends Component<ScrollContainerProps, ScrollContainerState> {\n  private resizeObserver: ResizeObserver;\n  private containerRef: RefObject<HTMLDivElement> = createRef();\n  private startPageY: number = -1;\n\n  constructor(props: ScrollContainerProps) {\n    super(props);\n\n    this.resizeObserver = new ResizeObserver(this.resizeHandler);\n  }\n\n  render() {\n    const { sessionId, ...divProps } = this.props;\n    return <div {...divProps} ref={this.containerRef} style={divStyle} />;\n  }\n\n  componentDidMount() {\n    const div: HTMLDivElement = this.containerRef.current!;\n    this.resizeObserver.observe(div);\n    div.addEventListener('wheel', this.wheelHandler);\n\n    if (isTouchDevice()) {\n      div.addEventListener('touchstart', this.touchStartHandler);\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<ScrollContainerProps>) {\n    if (prevProps.sessionId !== this.props.sessionId) {\n      this.scrollTo(0);\n    }\n  }\n\n  scrollTo = (top: number) => {\n    const div: HTMLDivElement | null = this.containerRef.current;\n    if (!div) return;\n    div.scrollTop = top;\n  };\n\n  // ---------------------------------------------\n  // wheel scroll\n  // ---------------------------------------------\n  private wheelHandler = (event: WheelEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    const div: HTMLDivElement | null = this.containerRef.current;\n    if (!div) return;\n    div.scrollTop = Math.min(Math.max(0, div.scrollTop + event.deltaY), div.scrollHeight - div.offsetHeight);\n  };\n\n  // ---------------------------------------------\n  // touch scroll\n  // ---------------------------------------------\n  private touchStartHandler = (event: TouchEvent) => {\n    if (event.touches.length !== 2) return;\n\n    const div: HTMLDivElement | null = this.containerRef.current;\n    if (!div) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    this.startPageY = event.targetTouches[0].pageY;\n\n    div.removeEventListener('touchstart', this.touchStartHandler);\n\n    div.addEventListener('touchmove', this.touchMoveHandler);\n    div.addEventListener('touchend', this.touchEndHandler);\n    div.addEventListener('touchcancel', this.touchEndHandler);\n  };\n\n  private touchMoveHandler = (event: TouchEvent) => {\n    if (event.touches.length !== 2 || this.startPageY === -1) return;\n\n    const div: HTMLDivElement | null = this.containerRef.current;\n    if (!div) return;\n\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    event.preventDefault();\n\n    const dy: number = event.targetTouches[0].pageY - this.startPageY;\n\n    div.scrollTop = Math.min(Math.max(0, div.scrollTop + dy), div.scrollHeight - div.offsetHeight);\n  };\n\n  private touchEndHandler = (event: TouchEvent) => {\n    const div: HTMLDivElement | null = this.containerRef.current;\n    if (!div) return;\n\n    this.startPageY = -1;\n\n    div.removeEventListener('touchmove', this.touchMoveHandler);\n    div.removeEventListener('touchend', this.touchEndHandler);\n    div.removeEventListener('touchcancel', this.touchEndHandler);\n\n    div.addEventListener('touchstart', this.touchStartHandler);\n  };\n\n  // ---------------------------------------------\n  // resize handler\n  // ---------------------------------------------\n  private resizeHandler = (entries: ResizeObserverEntry[]) => {\n    for (const entry of entries) {\n      if (entry.target === this.containerRef.current) {\n        const div: HTMLDivElement | null = this.containerRef.current;\n        if (!div) return;\n        div.scrollTop = Math.min(Math.max(0, div.scrollTop), div.scrollHeight - div.offsetHeight);\n      }\n    }\n  };\n}\n","import { Switch as MuiSwitch } from '@material-ui/core';\nimport styled from 'styled-components';\n\nexport const Switch = styled(MuiSwitch)`\n  && {\n    .MuiSwitch-track {\n      opacity: 1;\n      background-color: var(--switch-track-color);\n    }\n\n    .MuiSwitch-switchBase {\n      color: var(--switch-color);\n\n      &.Mui-checked {\n        color: var(--switch-color-checked);\n      }\n    }\n\n    .Mui-checked + .MuiSwitch-track {\n      opacity: 1;\n      background-color: var(--switch-track-color-checked);\n    }\n  }\n`;\n","import { createMuiTheme, Theme as MuiTheme } from '@material-ui/core/styles';\nimport { css } from 'styled-components';\n\nexport const lighten = css`\n  color: #242e3e;\n\n  --button-background-color: #00a4c8;\n  --button-label-color: rgba(255, 255, 255, 0.8);\n  --button-background-color-hover: #008cb0;\n  --button-label-color-hover: rgba(255, 255, 255, 1);\n  --button-background-color-selected: #007294;\n  --button-label-color-selected: rgba(255, 255, 255, 1);\n  --button-background-color-disabled: rgba(0, 164, 200, 0.65);\n  --button-label-color-disabled: rgba(255, 255, 255, 0.2);\n\n  --slider-rail-color: rgba(86, 81, 136, 0.4);\n  --slider-thumb-color: #6b6b9b;\n  --slider-track-color: rgba(86, 81, 136, 0.6);\n  --slider-value-label-color: #ffffff;\n`;\n\nexport const lightenTheme: MuiTheme = createMuiTheme({\n  palette: {\n    type: 'light',\n  },\n  typography: {\n    fontFamily: 'proximanova,noto_sanslight,sans-serif',\n    fontWeightLight: 200,\n    fontWeightRegular: 400,\n    fontWeightMedium: 600,\n    fontWeightBold: 700,\n  },\n  overrides: {\n    MuiTooltip: {\n      tooltip: {\n        fontSize: 13,\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      },\n    },\n  },\n});\n","import { Paper } from '@material-ui/core';\nimport styled from 'styled-components';\nimport { lighten } from '../theme/lighten';\n\nexport const DialogPaper = styled(Paper)`\n  ${lighten};\n\n  background-color: #ffffff;\n  width: fit-content;\n  height: fit-content;\n  padding: 30px 50px;\n  border-radius: 0;\n\n  > div {\n    text-align: center;\n  }\n`;\n","import { Dialog as MuiDialog, DialogProps } from '@material-ui/core';\nimport { ComponentType } from 'react';\nimport styled from 'styled-components';\nimport { lighten } from '../theme/lighten';\n\nexport { DialogActions, DialogContent, DialogContentText, DialogTitle } from '@material-ui/core';\n\nexport const Dialog: ComponentType<DialogProps> = styled(MuiDialog)`\n  && {\n    .MuiDialog-paper {\n      ${lighten};\n\n      background-color: #ffffff;\n\n      border-radius: 0;\n\n      padding: 30px 50px;\n\n      .MuiDialogTitle-root {\n        color: inherit;\n        padding: 0;\n        margin: 0 0 15px 0;\n      }\n\n      .MuiDialogContent-root {\n        color: inherit;\n        padding: 0;\n        margin: 0;\n        overflow: unset;\n      }\n\n      .MuiDialogActions-root {\n        padding: 0;\n        margin: 15px 0 0 0;\n        justify-content: center;\n      }\n\n      .MuiTypography-root {\n        color: inherit;\n      }\n    }\n  }\n`;\n","import { IconButton } from '@material-ui/core';\nimport { Fullscreen, FullscreenExit } from '@material-ui/icons';\nimport React, { Children, ReactNode, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport useResizeObserver from 'use-resize-observer/polyfilled';\n\nexport interface QuarterViewProps {\n  children: ReactNode;\n  className?: string;\n}\n\nexport function QuarterView({ children, className }: QuarterViewProps) {\n  const { ref: resizeRef, width = 500, height = 500 } = useResizeObserver<HTMLDivElement>({});\n  const [solo, setSolo] = useState<number>(-1);\n\n  const soloEnabled: boolean = solo > -1;\n\n  return (\n    <Container ref={resizeRef} soloEnabled={soloEnabled} width={width} height={height} className={className}>\n      {Children.map(children, (child, i) => {\n        return (\n          <div key={'quarter-' + i} data-solo={solo === i}>\n            {child}\n            <ExpandButton\n              onClick={(event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                event.nativeEvent.stopImmediatePropagation();\n                setSolo(soloEnabled ? -1 : i);\n              }}\n            >\n              {soloEnabled ? <FullscreenExit /> : <Fullscreen />}\n            </ExpandButton>\n          </div>\n        );\n      })}\n    </Container>\n  );\n}\n\nconst Container = styled.div<{ soloEnabled: boolean; width: number; height: number }>`\n  ${({ soloEnabled, width, height }) =>\n    soloEnabled ? soloContainerStyle : width / height < 1.2 ? gridContainerStyle : verticalContainerStyle};\n`;\n\nconst verticalContainerStyle = css`\n  display: flex;\n  background-color: #1c2331; // line color\n\n  > div {\n    flex: 1;\n\n    position: relative;\n    overflow: hidden;\n\n    &:not(:last-of-type) {\n      margin-right: 1px;\n    }\n  }\n`;\n\nconst gridContainerStyle = css`\n  display: grid;\n  background-color: #1c2331; // line color\n\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: 1fr 1fr;\n  grid-gap: 1px;\n\n  > div {\n    position: relative;\n    overflow: hidden;\n  }\n`;\n\nconst soloContainerStyle = css`\n  display: block;\n  position: relative;\n\n  > div[data-solo='true'] {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    overflow: hidden;\n  }\n\n  > div[data-solo='false'] {\n    position: absolute;\n    left: 100vw;\n    top: 0;\n    width: 200px;\n    height: 300px;\n  }\n`;\n\nconst ExpandButton = styled(IconButton)`\n  position: absolute;\n  top: 0;\n  left: 0;\n  border-radius: 0;\n  padding: 4px 6px;\n  color: #8694b1;\n  font-size: 18px;\n\n  .MuiSvgIcon-root {\n    font-size: 1em;\n  }\n`;\n","import styled from 'styled-components';\n\nexport const SwitchRow = styled.div`\n  display: flex;\n  align-items: center;\n\n  > :first-child {\n    margin-right: 10px;\n  }\n\n  > :last-child {\n    flex: 1;\n    text-align: right;\n  }\n`;\n","import { SnackbarContent as MuiSnackbarContent, SnackbarContentProps } from '@material-ui/core';\nimport { ComponentType } from 'react';\nimport styled from 'styled-components';\n\nexport const SnackbarContent: ComponentType<SnackbarContentProps> = styled(MuiSnackbarContent)`\n  && {\n    border-radius: 0;\n    background-color: var(--snackbar-background-color);\n    color: var(--snackbar-label-color);\n\n    .MuiButton-label,\n    .MuiIconButton-label {\n      opacity: 0.6;\n    }\n  }\n`;\n\nexport const NormalSnackbarContent: ComponentType<SnackbarContentProps> = styled(SnackbarContent)`\n  --snackbar-background-color: rgba(255, 255, 255, 0.6);\n  --snackbar-label-color: #030a18;\n`;\n\nexport const InfoSnackbarContent: ComponentType<SnackbarContentProps> = styled(SnackbarContent)`\n  --snackbar-background-color: #00a4c8;\n  --snackbar-label-color: #ffffff;\n`;\n\nexport const WarningSnackbarContent: ComponentType<SnackbarContentProps> = styled(SnackbarContent)`\n  --snackbar-background-color: #d6ae41;\n  --snackbar-label-color: #ffffff;\n`;\n\nexport const ErrorSnackbarContent: ComponentType<SnackbarContentProps> = styled(SnackbarContent)`\n  --snackbar-background-color: #c9434b;\n  --snackbar-label-color: #ffffff;\n`;\n","import React, { DetailedHTMLProps, HTMLAttributes, ReactElement, SourceHTMLAttributes } from 'react';\nimport styled, { keyframes } from 'styled-components';\n\nexport interface VideoBackgroundContainerProps\n  extends DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  source: ReactElement<DetailedHTMLProps<SourceHTMLAttributes<HTMLSourceElement>, HTMLSourceElement>>;\n}\n\nfunction VideoBackgroundContainerBase({ source, children, ...divProps }: VideoBackgroundContainerProps) {\n  return (\n    <div {...divProps}>\n      <video autoPlay loop muted>\n        {source}\n      </video>\n\n      {children}\n    </div>\n  );\n}\n\nconst enter = keyframes`\n  0% {\n    opacity: 0;\n  }\n  \n  100% {\n    opacity: 1;\n  }\n`;\n\nexport const VideoBackgroundContainer = styled(VideoBackgroundContainerBase)`\n  position: relative;\n  overflow: hidden;\n\n  > * {\n    position: relative;\n  }\n\n  > video {\n    top: 50%;\n    left: 50%;\n    position: absolute;\n    object-fit: cover;\n    min-width: 100%;\n    min-height: 100%;\n    transform: translate3d(-50%, -50%, 0);\n\n    animation: ${enter} 1s ease-out;\n  }\n`;\n","import { globalStyle as componentsGlobalStyle } from '@lunit/opt-components';\nimport { globalStyle as insightViewerGlobalStyle } from '@lunit/insight-viewer';\nimport { createGlobalStyle } from 'styled-components';\n\nexport const GlobalStyle = createGlobalStyle`\n  ${componentsGlobalStyle}\n  ${insightViewerGlobalStyle}\n  \n  html {\n    font-size: 14px;\n    box-sizing: border-box;\n  }\n  \n  html, body {\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n  }\n  \n  #app {\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n  }\n`;\n","import {\n  CornerstoneImage,\n  CornerstoneSingleImage,\n  InsightViewer,\n  installWADOImageLoader,\n  unloadImage,\n} from '@lunit/insight-viewer';\nimport React, { useMemo } from 'react';\nimport { render } from 'react-dom';\nimport { GlobalStyle } from './components/GlobalStyle';\n\ninstallWADOImageLoader();\n\nfunction App() {\n  const image: CornerstoneImage = useMemo(\n    () =>\n      new CornerstoneSingleImage(`wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm`, {\n        unload: unloadImage,\n      }),\n    [],\n  );\n\n  return (\n    <div>\n      <GlobalStyle />\n      <InsightViewer\n        width={700}\n        height={600}\n        invert={false} // 색상을 반전한다\n        flip={false} // 이미지를 좌우로 뒤집는다\n        pan={true} // Pan Interaction을 활성화 한다\n        adjust={false} // Adjust Interaction을 활성화 한다 (Pan과 동시에 사용할 수 없다)\n        zoom={true} // Zoom Interaction을 활성화 한다\n        resetTime={Date.now()} // 이 값이 변경되면 Pan, Adjust, Zoom 상태가 초기화 된다\n        image={image}\n        updateCornerstoneRenderData={() => {}}\n      />\n    </div>\n  );\n}\n\nrender(<App />, document.querySelector('#app'));\n\n// Hot Module Replacement\nif (process.env.NODE_ENV === 'development' && module.hot) {\n  module.hot.accept();\n}\n"],"sourceRoot":""}